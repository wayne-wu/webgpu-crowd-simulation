(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[3],{"+1Zu":function(e,t){e.exports=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},"+dQi":function(e,t,n){!function(e){"use strict";e.defineMode("javascript",(function(t,n){var r,i,a=t.indentUnit,o=n.statementIndent,s=n.jsonld,u=n.json||s,c=n.typescript,l=n.wordCharacters||/[\w$\xa1-\uffff]/,d=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("keyword d"),a=e("operator"),o={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:n,do:n,try:n,finally:n,return:i,break:i,continue:i,new:e("new"),delete:r,void:r,throw:r,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:a,typeof:a,instanceof:a,true:o,false:o,null:o,undefined:o,NaN:o,Infinity:o,this:e("this"),class:e("class"),super:e("atom"),yield:r,export:e("export"),import:e("import"),extends:r,await:r}}(),f=/[+\-*&%=<>!?|~^@]/,h=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function p(e){for(var t,n=!1,r=!1;null!=(t=e.next());){if(!n){if("/"==t&&!r)return;"["==t?r=!0:r&&"]"==t&&(r=!1)}n=!n&&"\\"==t}}function m(e,t,n){return r=e,i=n,t}function g(e,t){var n=e.next();if('"'==n||"'"==n)return t.tokenize=v(n),t.tokenize(e,t);if("."==n&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return m("number","number");if("."==n&&e.match(".."))return m("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(n))return m(n);if("="==n&&e.eat(">"))return m("=>","operator");if("0"==n&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return m("number","number");if(/\d/.test(n))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),m("number","number");if("/"==n)return e.eat("*")?(t.tokenize=b,b(e,t)):e.eat("/")?(e.skipToEnd(),m("comment","comment")):et(e,t,1)?(p(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),m("regexp","string-2")):(e.eat("="),m("operator","operator",e.current()));if("`"==n)return t.tokenize=_,_(e,t);if("#"==n&&"!"==e.peek())return e.skipToEnd(),m("meta","meta");if("#"==n&&e.eatWhile(l))return m("variable","property");if("<"==n&&e.match("!--")||"-"==n&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),m("comment","comment");if(f.test(n))return">"==n&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=n&&"="!=n||e.eat("="):/[<>*+\-|&?]/.test(n)&&(e.eat(n),">"==n&&e.eat(n))),"?"==n&&e.eat(".")?m("."):m("operator","operator",e.current());if(l.test(n)){e.eatWhile(l);var r=e.current();if("."!=t.lastType){if(d.propertyIsEnumerable(r)){var i=d[r];return m(i.type,i.style,r)}if("async"==r&&e.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return m("async","keyword",r)}return m("variable","variable",r)}}function v(e){return function(t,n){var r,i=!1;if(s&&"@"==t.peek()&&t.match(h))return n.tokenize=g,m("jsonld-keyword","meta");for(;null!=(r=t.next())&&(r!=e||i);)i=!i&&"\\"==r;return i||(n.tokenize=g),m("string","string")}}function b(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=g;break}r="*"==n}return m("comment","comment")}function _(e,t){for(var n,r=!1;null!=(n=e.next());){if(!r&&("`"==n||"$"==n&&e.eat("{"))){t.tokenize=g;break}r=!r&&"\\"==n}return m("quasi","string-2",e.current())}var y="([{}])";function x(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(!(n<0)){if(c){var r=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,n));r&&(n=r.index)}for(var i=0,a=!1,o=n-1;o>=0;--o){var s=e.string.charAt(o),u=y.indexOf(s);if(u>=0&&u<3){if(!i){++o;break}if(0==--i){"("==s&&(a=!0);break}}else if(u>=3&&u<6)++i;else if(l.test(s))a=!0;else if(/["'\/`]/.test(s))for(;;--o){if(0==o)return;if(e.string.charAt(o-1)==s&&"\\"!=e.string.charAt(o-2)){o--;break}}else if(a&&!i){++o;break}}a&&!i&&(t.fatArrowAt=o)}}var w={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,"jsonld-keyword":!0};function M(e,t,n,r,i,a){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=a,null!=r&&(this.align=r)}function A(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0;for(var r=e.context;r;r=r.prev)for(n=r.vars;n;n=n.next)if(n.name==t)return!0}function S(e,t,n,r,i){var a=e.cc;for(E.state=e,E.stream=i,E.marked=null,E.cc=a,E.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((a.length?a.pop():u?z:N)(n,r)){for(;a.length&&a[a.length-1].lex;)a.pop()();return E.marked?E.marked:"variable"==n&&A(e,r)?"variable-2":t}}var E={state:null,column:null,marked:null,cc:null};function P(){for(var e=arguments.length-1;e>=0;e--)E.cc.push(arguments[e])}function C(){return P.apply(null,arguments),!0}function T(e,t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}function O(e){var t=E.state;if(E.marked="def",t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var r=k(e,t.context);if(null!=r)return void(t.context=r)}else if(!T(e,t.localVars))return void(t.localVars=new L(e,t.localVars));n.globalVars&&!T(e,t.globalVars)&&(t.globalVars=new L(e,t.globalVars))}function k(e,t){if(t){if(t.block){var n=k(e,t.prev);return n?n==t.prev?t:new B(n,t.vars,!0):null}return T(e,t.vars)?t:new B(t.prev,new L(e,t.vars),!1)}return null}function R(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function B(e,t,n){this.prev=e,this.vars=t,this.block=n}function L(e,t){this.name=e,this.next=t}var j=new L("this",new L("arguments",null));function I(){E.state.context=new B(E.state.context,E.state.localVars,!1),E.state.localVars=j}function D(){E.state.context=new B(E.state.context,E.state.localVars,!0),E.state.localVars=null}function G(){E.state.localVars=E.state.context.vars,E.state.context=E.state.context.prev}function U(e,t){var n=function(){var n=E.state,r=n.indented;if("stat"==n.lexical.type)r=n.lexical.indented;else for(var i=n.lexical;i&&")"==i.type&&i.align;i=i.prev)r=i.indented;n.lexical=new M(r,E.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function V(){var e=E.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function F(e){function t(n){return n==e?C():";"==e||"}"==n||")"==n||"]"==n?P():C(t)}return t}function N(e,t){return"var"==e?C(U("vardef",t),Ae,F(";"),V):"keyword a"==e?C(U("form"),q,N,V):"keyword b"==e?C(U("form"),N,V):"keyword d"==e?E.stream.match(/^\s*$/,!1)?C():C(U("stat"),Y,F(";"),V):"debugger"==e?C(F(";")):"{"==e?C(U("}"),D,de,V,G):";"==e?C():"if"==e?("else"==E.state.lexical.info&&E.state.cc[E.state.cc.length-1]==V&&E.state.cc.pop()(),C(U("form"),q,N,V,Oe)):"function"==e?C(Le):"for"==e?C(U("form"),ke,N,V):"class"==e||c&&"interface"==t?(E.marked="keyword",C(U("form","class"==e?e:t),Ue,V)):"variable"==e?c&&"declare"==t?(E.marked="keyword",C(N)):c&&("module"==t||"enum"==t||"type"==t)&&E.stream.match(/^\s*\w/,!1)?(E.marked="keyword","enum"==t?C(Qe):"type"==t?C(Ie,F("operator"),ge,F(";")):C(U("form"),Se,F("{"),U("}"),de,V,V)):c&&"namespace"==t?(E.marked="keyword",C(U("form"),z,N,V)):c&&"abstract"==t?(E.marked="keyword",C(N)):C(U("stat"),ie):"switch"==e?C(U("form"),q,F("{"),U("}","switch"),D,de,V,V,G):"case"==e?C(z,F(":")):"default"==e?C(F(":")):"catch"==e?C(U("form"),I,H,N,V,G):"export"==e?C(U("stat"),He,V):"import"==e?C(U("stat"),We,V):"async"==e?C(N):"@"==t?C(z,N):P(U("stat"),z,F(";"),V)}function H(e){if("("==e)return C(De,F(")"))}function z(e,t){return K(e,t,!1)}function W(e,t){return K(e,t,!0)}function q(e){return"("!=e?P():C(U(")"),Y,F(")"),V)}function K(e,t,n){if(E.state.fatArrowAt==E.stream.start){var r=n?ee:$;if("("==e)return C(I,U(")"),ce(De,")"),V,F("=>"),r,G);if("variable"==e)return P(I,Se,F("=>"),r,G)}var i=n?J:X;return w.hasOwnProperty(e)?C(i):"function"==e?C(Le,i):"class"==e||c&&"interface"==t?(E.marked="keyword",C(U("form"),Ge,V)):"keyword c"==e||"async"==e?C(n?W:z):"("==e?C(U(")"),Y,F(")"),V,i):"operator"==e||"spread"==e?C(n?W:z):"["==e?C(U("]"),Je,V,i):"{"==e?le(oe,"}",null,i):"quasi"==e?P(Q,i):"new"==e?C(te(n)):"import"==e?C(z):C()}function Y(e){return e.match(/[;\}\)\],]/)?P():P(z)}function X(e,t){return","==e?C(Y):J(e,t,!1)}function J(e,t,n){var r=0==n?X:J,i=0==n?z:W;return"=>"==e?C(I,n?ee:$,G):"operator"==e?/\+\+|--/.test(t)||c&&"!"==t?C(r):c&&"<"==t&&E.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?C(U(">"),ce(ge,">"),V,r):"?"==t?C(z,F(":"),i):C(i):"quasi"==e?P(Q,r):";"!=e?"("==e?le(W,")","call",r):"."==e?C(ae,r):"["==e?C(U("]"),Y,F("]"),V,r):c&&"as"==t?(E.marked="keyword",C(ge,r)):"regexp"==e?(E.state.lastType=E.marked="operator",E.stream.backUp(E.stream.pos-E.stream.start-1),C(i)):void 0:void 0}function Q(e,t){return"quasi"!=e?P():"${"!=t.slice(t.length-2)?C(Q):C(z,Z)}function Z(e){if("}"==e)return E.marked="string-2",E.state.tokenize=_,C(Q)}function $(e){return x(E.stream,E.state),P("{"==e?N:z)}function ee(e){return x(E.stream,E.state),P("{"==e?N:W)}function te(e){return function(t){return"."==t?C(e?re:ne):"variable"==t&&c?C(xe,e?J:X):P(e?W:z)}}function ne(e,t){if("target"==t)return E.marked="keyword",C(X)}function re(e,t){if("target"==t)return E.marked="keyword",C(J)}function ie(e){return":"==e?C(V,N):P(X,F(";"),V)}function ae(e){if("variable"==e)return E.marked="property",C()}function oe(e,t){return"async"==e?(E.marked="property",C(oe)):"variable"==e||"keyword"==E.style?(E.marked="property","get"==t||"set"==t?C(se):(c&&E.state.fatArrowAt==E.stream.start&&(n=E.stream.match(/^\s*:\s*/,!1))&&(E.state.fatArrowAt=E.stream.pos+n[0].length),C(ue))):"number"==e||"string"==e?(E.marked=s?"property":E.style+" property",C(ue)):"jsonld-keyword"==e?C(ue):c&&R(t)?(E.marked="keyword",C(oe)):"["==e?C(z,fe,F("]"),ue):"spread"==e?C(W,ue):"*"==t?(E.marked="keyword",C(oe)):":"==e?P(ue):void 0;var n}function se(e){return"variable"!=e?P(ue):(E.marked="property",C(Le))}function ue(e){return":"==e?C(W):"("==e?P(Le):void 0}function ce(e,t,n){function r(i,a){if(n?n.indexOf(i)>-1:","==i){var o=E.state.lexical;return"call"==o.info&&(o.pos=(o.pos||0)+1),C((function(n,r){return n==t||r==t?P():P(e)}),r)}return i==t||a==t?C():n&&n.indexOf(";")>-1?P(e):C(F(t))}return function(n,i){return n==t||i==t?C():P(e,r)}}function le(e,t,n){for(var r=3;r<arguments.length;r++)E.cc.push(arguments[r]);return C(U(t,n),ce(e,t),V)}function de(e){return"}"==e?C():P(N,de)}function fe(e,t){if(c){if(":"==e)return C(ge);if("?"==t)return C(fe)}}function he(e,t){if(c&&(":"==e||"in"==t))return C(ge)}function pe(e){if(c&&":"==e)return E.stream.match(/^\s*\w+\s+is\b/,!1)?C(z,me,ge):C(ge)}function me(e,t){if("is"==t)return E.marked="keyword",C()}function ge(e,t){return"keyof"==t||"typeof"==t||"infer"==t?(E.marked="keyword",C("typeof"==t?W:ge)):"variable"==e||"void"==t?(E.marked="type",C(ye)):"|"==t||"&"==t?C(ge):"string"==e||"number"==e||"atom"==e?C(ye):"["==e?C(U("]"),ce(ge,"]",","),V,ye):"{"==e?C(U("}"),ce(be,"}",",;"),V,ye):"("==e?C(ce(_e,")"),ve,ye):"<"==e?C(ce(ge,">"),ge):void 0}function ve(e){if("=>"==e)return C(ge)}function be(e,t){return"variable"==e||"keyword"==E.style?(E.marked="property",C(be)):"?"==t||"number"==e||"string"==e?C(be):":"==e?C(ge):"["==e?C(F("variable"),he,F("]"),be):"("==e?P(je,be):void 0}function _e(e,t){return"variable"==e&&E.stream.match(/^\s*[?:]/,!1)||"?"==t?C(_e):":"==e?C(ge):"spread"==e?C(_e):P(ge)}function ye(e,t){return"<"==t?C(U(">"),ce(ge,">"),V,ye):"|"==t||"."==e||"&"==t?C(ge):"["==e?C(ge,F("]"),ye):"extends"==t||"implements"==t?(E.marked="keyword",C(ge)):"?"==t?C(ge,F(":"),ge):void 0}function xe(e,t){if("<"==t)return C(U(">"),ce(ge,">"),V,ye)}function we(){return P(ge,Me)}function Me(e,t){if("="==t)return C(ge)}function Ae(e,t){return"enum"==t?(E.marked="keyword",C(Qe)):P(Se,fe,Ce,Te)}function Se(e,t){return c&&R(t)?(E.marked="keyword",C(Se)):"variable"==e?(O(t),C()):"spread"==e?C(Se):"["==e?le(Pe,"]"):"{"==e?le(Ee,"}"):void 0}function Ee(e,t){return"variable"!=e||E.stream.match(/^\s*:/,!1)?("variable"==e&&(E.marked="property"),"spread"==e?C(Se):"}"==e?P():"["==e?C(z,F("]"),F(":"),Ee):C(F(":"),Se,Ce)):(O(t),C(Ce))}function Pe(){return P(Se,Ce)}function Ce(e,t){if("="==t)return C(W)}function Te(e){if(","==e)return C(Ae)}function Oe(e,t){if("keyword b"==e&&"else"==t)return C(U("form","else"),N,V)}function ke(e,t){return"await"==t?C(ke):"("==e?C(U(")"),Re,V):void 0}function Re(e){return"var"==e?C(Ae,Be):"variable"==e?C(Be):P(Be)}function Be(e,t){return")"==e?C():";"==e?C(Be):"in"==t||"of"==t?(E.marked="keyword",C(z,Be)):P(z,Be)}function Le(e,t){return"*"==t?(E.marked="keyword",C(Le)):"variable"==e?(O(t),C(Le)):"("==e?C(I,U(")"),ce(De,")"),V,pe,N,G):c&&"<"==t?C(U(">"),ce(we,">"),V,Le):void 0}function je(e,t){return"*"==t?(E.marked="keyword",C(je)):"variable"==e?(O(t),C(je)):"("==e?C(I,U(")"),ce(De,")"),V,pe,G):c&&"<"==t?C(U(">"),ce(we,">"),V,je):void 0}function Ie(e,t){return"keyword"==e||"variable"==e?(E.marked="type",C(Ie)):"<"==t?C(U(">"),ce(we,">"),V):void 0}function De(e,t){return"@"==t&&C(z,De),"spread"==e?C(De):c&&R(t)?(E.marked="keyword",C(De)):c&&"this"==e?C(fe,Ce):P(Se,fe,Ce)}function Ge(e,t){return"variable"==e?Ue(e,t):Ve(e,t)}function Ue(e,t){if("variable"==e)return O(t),C(Ve)}function Ve(e,t){return"<"==t?C(U(">"),ce(we,">"),V,Ve):"extends"==t||"implements"==t||c&&","==e?("implements"==t&&(E.marked="keyword"),C(c?ge:z,Ve)):"{"==e?C(U("}"),Fe,V):void 0}function Fe(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||c&&R(t))&&E.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(E.marked="keyword",C(Fe)):"variable"==e||"keyword"==E.style?(E.marked="property",C(Ne,Fe)):"number"==e||"string"==e?C(Ne,Fe):"["==e?C(z,fe,F("]"),Ne,Fe):"*"==t?(E.marked="keyword",C(Fe)):c&&"("==e?P(je,Fe):";"==e||","==e?C(Fe):"}"==e?C():"@"==t?C(z,Fe):void 0}function Ne(e,t){if("?"==t)return C(Ne);if(":"==e)return C(ge,Ce);if("="==t)return C(W);var n=E.state.lexical.prev;return P(n&&"interface"==n.info?je:Le)}function He(e,t){return"*"==t?(E.marked="keyword",C(Xe,F(";"))):"default"==t?(E.marked="keyword",C(z,F(";"))):"{"==e?C(ce(ze,"}"),Xe,F(";")):P(N)}function ze(e,t){return"as"==t?(E.marked="keyword",C(F("variable"))):"variable"==e?P(W,ze):void 0}function We(e){return"string"==e?C():"("==e?P(z):P(qe,Ke,Xe)}function qe(e,t){return"{"==e?le(qe,"}"):("variable"==e&&O(t),"*"==t&&(E.marked="keyword"),C(Ye))}function Ke(e){if(","==e)return C(qe,Ke)}function Ye(e,t){if("as"==t)return E.marked="keyword",C(qe)}function Xe(e,t){if("from"==t)return E.marked="keyword",C(z)}function Je(e){return"]"==e?C():P(ce(W,"]"))}function Qe(){return P(U("form"),Se,F("{"),U("}"),ce(Ze,"}"),V,V)}function Ze(){return P(Se,Ce)}function $e(e,t){return"operator"==e.lastType||","==e.lastType||f.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}function et(e,t,n){return t.tokenize==g&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(n||0)))}return G.lex=!0,V.lex=!0,{startState:function(e){var t={tokenize:g,lastType:"sof",cc:[],lexical:new M((e||0)-a,0,"block",!1),localVars:n.localVars,context:n.localVars&&new B(null,null,!1),indented:e||0};return n.globalVars&&"object"==typeof n.globalVars&&(t.globalVars=n.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),x(e,t)),t.tokenize!=b&&e.eatSpace())return null;var n=t.tokenize(e,t);return"comment"==r?n:(t.lastType="operator"!=r||"++"!=i&&"--"!=i?r:"incdec",S(t,n,r,i,e))},indent:function(t,r){if(t.tokenize==b||t.tokenize==_)return e.Pass;if(t.tokenize!=g)return 0;var i,s=r&&r.charAt(0),u=t.lexical;if(!/^\s*else\b/.test(r))for(var c=t.cc.length-1;c>=0;--c){var l=t.cc[c];if(l==V)u=u.prev;else if(l!=Oe)break}for(;("stat"==u.type||"form"==u.type)&&("}"==s||(i=t.cc[t.cc.length-1])&&(i==X||i==J)&&!/^[,\.=+\-*:?[\(]/.test(r));)u=u.prev;o&&")"==u.type&&"stat"==u.prev.type&&(u=u.prev);var d=u.type,f=s==d;return"vardef"==d?u.indented+("operator"==t.lastType||","==t.lastType?u.info.length+1:0):"form"==d&&"{"==s?u.indented:"form"==d?u.indented+a:"stat"==d?u.indented+($e(t,r)?o||a:0):"switch"!=u.info||f||0==n.doubleIndentSwitch?u.align?u.column+(f?0:1):u.indented+(f?0:a):u.indented+(/^(?:case|default)\b/.test(r)?a:2*a)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:u?null:"/*",blockCommentEnd:u?null:"*/",blockCommentContinue:u?null:" * ",lineComment:u?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:u?"json":"javascript",jsonldMode:s,jsonMode:u,expressionAllowed:et,skipExpression:function(e){var t=e.cc[e.cc.length-1];t!=z&&t!=W||e.cc.pop()}}})),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}(n("VrN/"))},"/BFQ":function(e,t){e.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],d=t[6],f=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i+c*r,e[1]=o*i+l*r,e[2]=s*i+d*r,e[3]=u*i+f*r,e[4]=c*i-a*r,e[5]=l*i-o*r,e[6]=d*i-s*r,e[7]=f*i-u*r,e}},"/sWY":function(e,t){e.exports=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},"08IH":function(e,t,n){"use strict";e.exports=function(e,t,n,r,i,a){var o=i-1,s=i*i,u=o*o,c=(1+2*i)*u,l=i*u,d=s*(3-2*i),f=s*o;if(e.length){a||(a=new Array(e.length));for(var h=e.length-1;h>=0;--h)a[h]=c*e[h]+l*t[h]+d*n[h]+f*r[h];return a}return c*e+l*t+d*n+f*r},e.exports.derivative=function(e,t,n,r,i,a){var o=6*i*i-6*i,s=3*i*i-4*i+1,u=-6*i*i+6*i,c=3*i*i-2*i;if(e.length){a||(a=new Array(e.length));for(var l=e.length-1;l>=0;--l)a[l]=o*e[l]+s*t[l]+u*n[l]+c*r[l];return a}return o*e+s*t+u*n[l]+c*r}},"0xYO":function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// Utilities\n////////////////////////////////////////////////////////////////////////////////\nvar<private> rand_seed : vec2<f32>;\n\nfn rand() -> f32 {\n    rand_seed.x = fract(cos(dot(rand_seed, vec2<f32>(23.14077926, 232.61690225))) * 136.8168);\n    rand_seed.y = fract(cos(dot(rand_seed, vec2<f32>(54.47856553, 345.84153136))) * 534.7645);\n    return rand_seed.y;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Vertex shader\n////////////////////////////////////////////////////////////////////////////////\n[[block]] struct RenderParams {\n  modelViewProjectionMatrix : mat4x4<f32>;\n  cameraPos : vec3<f32>;\n  agentScale : f32;\n};\n\n[[binding(0), group(0)]] var<uniform> render_params : RenderParams;\n\nstruct VertexInput {\n  [[location(0)]] position : vec3<f32>;  // agent position (world space)\n  [[location(1)]] color    : vec4<f32>;  // agent color\n  [[location(2)]] velocity : vec3<f32>;  // agent velocity\n  [[location(3)]] mesh_pos : vec4<f32>;  // mesh vertex position (model space)\n  [[location(4)]] mesh_uv  : vec2<f32>;  // mesh vertex uv\n  [[location(5)]] mesh_nor : vec4<f32>;  // mesh vertex normal\n  [[location(6)]] mesh_col : vec3<f32>;  // mesh vertex color\n};\n\nstruct VertexOutput {\n  [[builtin(position)]] position : vec4<f32>;\n  [[location(0)]]       color    : vec4<f32>;\n  [[location(1)]]       mesh_pos : vec4<f32>;\n  [[location(2)]]       mesh_uv  : vec2<f32>;\n  [[location(3)]]       mesh_nor : vec4<f32>;\n  [[location(4)]]       mesh_col : vec3<f32>;\n};\n\n[[stage(vertex)]]\nfn vs_main(in : VertexInput) -> VertexOutput {\n\n  var vel = normalize(in.velocity);\n\n  var model = mat4x4<f32>();\n  var scale = mat4x4<f32>();\n  scale[0] = vec4<f32>(render_params.agentScale, 0.0, 0.0, 0.0);\n  scale[1] = vec4<f32>(0.0, render_params.agentScale, 0.0, 0.0);\n  scale[2] = vec4<f32>(0.0, 0.0, render_params.agentScale, 0.0);\n  scale[3] = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n\n  var rot = mat4x4<f32>();\n  var forward = vel;\n  var up = vec3<f32>(0.0, 1.0, 0.0);\n  var right = normalize(cross(forward.xyz, up.xyz));\n  rot[0] = vec4<f32>(right, 0.0);\n  rot[1] = vec4<f32>(up, 0.0);\n  rot[2] = vec4<f32>(forward, 0.0);\n  rot[3] = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n\n  var trans = mat4x4<f32>();\n  trans[0] = vec4<f32>(1.0, 0.0, 0.0, 0.0);\n  trans[1] = vec4<f32>(0.0, 1.0, 0.0, 0.0);\n  trans[2] = vec4<f32>(0.0, 0.0, 1.0, 0.0);\n  trans[3] = vec4<f32>(in.position, 1.0);\n\n  model = trans * rot * scale;\n\n  var out : VertexOutput;  \n  out.position = render_params.modelViewProjectionMatrix * model * in.mesh_pos;\n  out.color = in.color;\n  out.mesh_uv = in.mesh_uv;\n  out.mesh_pos = in.mesh_pos;\n  out.mesh_nor = rot * in.mesh_nor;\n  out.mesh_col = in.mesh_col;\n  return out;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Fragment shader\n////////////////////////////////////////////////////////////////////////////////\n[[stage(fragment)]]\nfn fs_main(in : VertexOutput) -> [[location(0)]] vec4<f32> {\n  var cameraDir = in.position.xyz - render_params.cameraPos;\n  var lightDir = vec4<f32>(1.0, 1.0, 1.0, 0.0);\n  var lambertTerm = dot(normalize(lightDir), normalize(in.mesh_nor));\n\n  var meshCol = vec4<f32>(in.mesh_col, 1.0);\n  if (meshCol.r > 0.99 && meshCol.g > 0.99 && meshCol.b > 0.99){\n    meshCol = in.color;\n  }\n  var albedo = in.color * 0.3 + meshCol * 0.7;\n  return albedo + 0.5 * lambertTerm * vec4<f32>(1.0, 1.0, 1.0, 1.0);\n}\n"},"1OyB":function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},"1uVF":function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return u}));var r=52,i=0,a=16,o=24,s=36,u=new Float32Array([1,-1,1,1,1,1,0,-1,0,0,1,1,1,-1,-1,1,1,0,1,0,-1,0,0,1,1,1,-1,-1,-1,1,0,0,0,-1,0,0,1,1,1,1,-1,-1,1,1,0,0,-1,0,0,1,1,1,1,-1,1,1,1,1,0,-1,0,0,1,1,1,-1,-1,-1,1,0,0,0,-1,0,0,1,1,1,1,1,1,1,1,1,0,0,-1,0,1,1,1,1,-1,1,1,0,1,0,0,-1,0,1,1,1,1,-1,-1,1,0,0,0,0,-1,0,1,1,1,1,1,-1,1,1,0,0,0,-1,0,1,1,1,1,1,1,1,1,1,0,0,-1,0,1,1,1,1,-1,-1,1,0,0,0,0,-1,0,1,1,1,-1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,1,0,1,0,1,0,0,1,1,1,1,1,-1,1,0,0,0,1,0,0,1,1,1,-1,1,-1,1,1,0,0,1,0,0,1,1,1,-1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,-1,1,0,0,0,1,0,0,1,1,1,-1,-1,1,1,1,1,0,0,1,0,1,1,1,-1,1,1,1,0,1,0,0,1,0,1,1,1,-1,1,-1,1,0,0,0,0,1,0,1,1,1,-1,-1,-1,1,1,0,0,0,1,0,1,1,1,-1,-1,1,1,1,1,0,0,1,0,1,1,1,-1,1,-1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,-1,0,0,0,1,1,1,-1,1,1,1,0,1,-1,0,0,0,1,1,1,-1,-1,1,1,0,0,-1,0,0,0,1,1,1,-1,-1,1,1,0,0,-1,0,0,0,1,1,1,1,-1,1,1,1,0,-1,0,0,0,1,1,1,1,1,1,1,1,1,-1,0,0,0,1,1,1,1,-1,-1,1,1,1,1,0,0,0,1,1,1,-1,-1,-1,1,0,1,1,0,0,0,1,1,1,-1,1,-1,1,0,0,1,0,0,0,1,1,1,1,1,-1,1,1,0,1,0,0,0,1,1,1,1,-1,-1,1,1,1,1,0,0,0,1,1,1,-1,1,-1,1,0,0,1,0,0,0,1,1,1])},"20a2":function(e,t,n){e.exports=n("nOHt")},"39+4":function(e,t,n){"use strict";e.exports=function(e){var t=(e=e||{}).eye||[0,0,1],n=e.center||[0,0,0],s=e.up||[0,1,0],u=e.distanceLimits||[0,1/0],c=e.mode||"turntable",l=r(),d=i(),f=a();return l.setDistanceLimits(u[0],u[1]),l.lookAt(0,t,n,s),d.setDistanceLimits(u[0],u[1]),d.lookAt(0,t,n,s),f.setDistanceLimits(u[0],u[1]),f.lookAt(0,t,n,s),new o({turntable:l,orbit:d,matrix:f},c)};var r=n("7HaW"),i=n("YeY6"),a=n("QWga");function o(e,t){this._controllerNames=Object.keys(e),this._controllerList=this._controllerNames.map((function(t){return e[t]})),this._mode=t,this._active=e[t],this._active||(this._mode="turntable",this._active=e.turntable),this.modes=this._controllerNames,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}var s=o.prototype;s.flush=function(e){for(var t=this._controllerList,n=0;n<t.length;++n)t[n].flush(e)},s.idle=function(e){for(var t=this._controllerList,n=0;n<t.length;++n)t[n].idle(e)},s.lookAt=function(e,t,n,r){for(var i=this._controllerList,a=0;a<i.length;++a)i[a].lookAt(e,t,n,r)},s.rotate=function(e,t,n,r){for(var i=this._controllerList,a=0;a<i.length;++a)i[a].rotate(e,t,n,r)},s.pan=function(e,t,n,r){for(var i=this._controllerList,a=0;a<i.length;++a)i[a].pan(e,t,n,r)},s.translate=function(e,t,n,r){for(var i=this._controllerList,a=0;a<i.length;++a)i[a].translate(e,t,n,r)},s.setMatrix=function(e,t){for(var n=this._controllerList,r=0;r<n.length;++r)n[r].setMatrix(e,t)},s.setDistanceLimits=function(e,t){for(var n=this._controllerList,r=0;r<n.length;++r)n[r].setDistanceLimits(e,t)},s.setDistance=function(e,t){for(var n=this._controllerList,r=0;r<n.length;++r)n[r].setDistance(e,t)},s.recalcMatrix=function(e){this._active.recalcMatrix(e)},s.getDistance=function(e){return this._active.getDistance(e)},s.getDistanceLimits=function(e){return this._active.getDistanceLimits(e)},s.lastT=function(){return this._active.lastT()},s.setMode=function(e){if(e!==this._mode){var t=this._controllerNames.indexOf(e);if(!(t<0)){var n=this._active,r=this._controllerList[t],i=Math.max(n.lastT(),r.lastT());n.recalcMatrix(i),r.setMatrix(i,n.computedMatrix),this._active=r,this._mode=e,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}}},s.getMode=function(){return this._mode}},"3Mjd":function(e,t){e.exports=function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},"3PNt":function(e,t){e.exports=!0},"4DRx":function(e,t){e.exports=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,c=a+a,l=r*s,d=r*u,f=r*c,h=i*u,p=i*c,m=a*c,g=o*s,v=o*u,b=o*c;return e[0]=1-(h+m),e[1]=d+b,e[2]=f-v,e[3]=0,e[4]=d-b,e[5]=1-(l+m),e[6]=p+g,e[7]=0,e[8]=f+v,e[9]=p-g,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}},"4NOg":function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// Finalize Velocity Compute Shader\n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read> agentData_r : Agents;\n[[binding(2), group(0)]] var<storage, write> agentData_w : Agents;\n[[binding(3), group(0)]] var<storage, read> grid : Grid;\n[[binding(4), group(0)]] var<storage, read> obstacleData : Obstacles;\n\n\nfn intersect_line(p0: vec2<f32>, p1: vec2<f32>, p2: vec2<f32>, p3: vec2<f32>, n: ptr<function, vec2<f32>>) -> f32\n{\n  let s1 = p1 - p0;\n  let s2 = p3 - p2;\n\n  var den = (-s2.x * s1.y + s1.x * s2.y);\n  if (den < eps) { return -1.0; }  // colinear\n\n  den = 1.0/den;\n  let s = (-s1.y * (p0.x - p2.x) + s1.x * (p0.y - p2.y)) * den;\n  let t = ( s2.x * (p0.y - p2.y) - s2.y * (p0.x - p2.x)) * den;\n\n  if (s > 0.0 && s < 1.0 && t > 0.0 && t < 1.0)\n  {\n    (*n).x = -s2.y;\n    (*n).y = s2.x;\n    return t;\n  }\n\n  return -1.0;\n}\n\nfn obstacle_avoidance(agent: Agent, obstacle: Obstacle) -> vec3<f32>\n{\n  // Create Model Matrix\n  let c = cos(obstacle.rot);\n  let s = sin(obstacle.rot);\n  var m = mat4x4<f32>();\n  m[0] = vec4<f32>(obstacle.scale.x*c, 0.0, -obstacle.scale.x*s, 0.0);\n  m[1] = vec4<f32>(0.0, obstacle.scale.y, 0.0, 0.0);\n  m[2] = vec4<f32>(obstacle.scale.z*s, 0.0, obstacle.scale.z*c, 0.0);\n  m[3] = vec4<f32>(obstacle.pos, 1.0);\n\n  // Get Corner Points in World Position (Cube)\n  let l = 1.05;\n  var p1 = (m * vec4<f32>(l,0.0,l,1.0)).xz;\n  var p2 = (m * vec4<f32>(l,0.0,-l,1.0)).xz;\n  var p3 = (m * vec4<f32>(-l,0.0,-l,1.0)).xz;\n  var p4 = (m * vec4<f32>(-l,0.0,l,1.0)).xz;\n\n  var v = agent.v;\n  var a0 = agent.xp.xz;\n  var a1 = (agent.xp + tObstacle * v).xz;  // max look-ahead\n  \n  // Intersection test with the four edges\n  var n_tmp : vec2<f32>;\n  var n_min : vec2<f32>;\n  var t_tmp : f32;\n  var t_min : f32 = tObstacle;\n  t_tmp = intersect_line(a0, a1, p1, p2, &n_tmp);\n  if (t_tmp > eps && t_tmp < t_min) { t_min = t_tmp; n_min = n_tmp; }\n  t_tmp = intersect_line(a0, a1, p2, p3, &n_tmp);\n  if (t_tmp > eps && t_tmp < t_min) { t_min = t_tmp; n_min = n_tmp; }\n  t_tmp = intersect_line(a0, a1, p3, p4, &n_tmp);\n  if (t_tmp > eps && t_tmp < t_min) { t_min = t_tmp; n_min = n_tmp; }\n  t_tmp = intersect_line(a0, a1, p4, p1, &n_tmp);\n  if (t_tmp > eps && t_tmp < t_min) { t_min = t_tmp; n_min = n_tmp; }\n\n  if (t_min < 1.0) { \n    t_min = t_min * tObstacle;  // remap t_min to 0 to tObstacle\n    \n    //if(dot(v.xz, n_min) > 0.0) { n_min = -n_min; }  // flip the normal direction\n    //var n = vec3<f32>(n_min.x, 0.0, n_min.y);  // contact normal\n\n    // Use the radial normal as the contact normal so that there's some tangential velocity\n    var n = normalize((agent.xp + t_min * v) - obstacle.pos);\n  \n    return k_avoid * n;\n  }\n\n  return vec3<f32>(0.0);\n}\n\nfn getW(r : f32) -> f32 {\n    var w = 0.0; // poly6 smoothing kernel\n\n    if (eps <= r && r <= xsph_h) {\n        w = 315.0 / (64.0 * 3.14159 * pow(xsph_h, 9.0));\n        let hmr = xsph_h * xsph_h - r * r;\n        w = w * hmr * hmr * hmr;\n    }\n    return w;\n}\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n  let idx = GlobalInvocationID.x;\n  var agent = agentData_r.agents[idx];\n\n  // PBD: Get new velocity from corrected position\n  agent.v = (agent.xp - agent.x)/sim_params.deltaTime;\n\n  // 4.3 Cohesion\n  // update velocity to factor in viscosity\n  var velAvg = vec3<f32>(0.0); // weighted average of all the velocity differences\n\n  if (agent.cell < 0){\n    // ignore invalid cells\n    agent.c = vec4<f32>(0.5, 0.5, 0.5, 1.0);\n    agentData_w.agents[idx] = agent;\n    return;\n  }\n\n  let gridWidth = i32(sim_params.gridWidth);\n  let gridHeight = i32(sim_params.gridWidth);\n  // compute neighbors\n  var nearCount = 0u;\n  var farCount = 0u;\n  //// TODO don't hardcode 9 cells \n  let cellsToCheck = 9u;\n  var nearCellNums = array<i32, 9u>(\n    agent.cell + gridWidth - 1, agent.cell + gridWidth, agent.cell + gridWidth + 1,\n    agent.cell - 1, agent.cell, agent.cell+1, \n    agent.cell - gridWidth - 1, agent.cell - gridWidth, agent.cell - gridWidth + 1);\n\n  for (var c : u32 = 0u; c < cellsToCheck; c = c + 1u ){\n    let cellIdx = nearCellNums[c];\n    if (cellIdx < 0 || cellIdx >= gridWidth * gridHeight){\n      continue;\n    }\n    let cell : CellIndices = grid.cells[cellIdx];\n    for (var i : u32 = cell.start; i <= cell.end; i = i + 1u) {\n\n      if (idx == i) { \n        // ignore ourselves\n        continue; \n      }\n\n      var neighbor = agentData_r.agents[i];\n      \n      // Only look at neighbor in the same crowd group\n      if(agent.group != neighbor.group){\n        continue;\n      }\n      \n      var d = distance(agent.xp, neighbor.xp);  // Should this be xp or x?\n      if (d >= nearRadius){\n        continue;\n      }\n      var w = getW(d*d);\n      velAvg = velAvg + (agent.v - neighbor.v) * w;\n    }\n  }\n  agent.v = agent.v + xsph_c * velAvg;\n\n  // 4.7 Obstacle Avoidance (Open Steer)\n  for (var j : u32 = 0u; j < arrayLength(&obstacleData.obstacles); j = j + 1u){\n    var v_avoid = obstacle_avoidance(agent, obstacleData.obstacles[j]);\n    agent.v = agent.v + v_avoid;\n  }\n\n  // 4.6 Maximum Speed and Acceleration Limiting\n\n  let v_dir = normalize(agent.v);\n  let maxSpeed : f32 = 1.2*agent.speed;\n  if(length(agent.v) > maxSpeed){\n    agent.v = maxSpeed * v_dir;\n  }\n\n  // Set new position to be the corrected position\n  // Reintegrate here so that the position doesn't jump between frames\n  agent.x = agent.x + agent.v * sim_params.deltaTime;\n\n  agent.dir = dir_blending * normalize(agent.dir) + (1.0 - dir_blending) * v_dir;\n\n  // Store the new agent value\n  agentData_w.agents[idx] = agent;\n}\n"},"4knM":function(e,t,n){"use strict";var r=n("1OyB"),i=n("vuIU"),a=n("rePB"),o=n("IOcx"),s=n("A54A"),u=function(){function e(t,n){Object(r.a)(this,e),Object(a.a)(this,"controls",void 0),Object(a.a)(this,"projectionMatrix",o.a.create()),Object(a.a)(this,"viewMatrix",o.a.create()),Object(a.a)(this,"fovy",45),Object(a.a)(this,"aspectRatio",1),Object(a.a)(this,"near",.1),Object(a.a)(this,"far",1e3),Object(a.a)(this,"position",o.c.create()),Object(a.a)(this,"direction",o.c.create()),Object(a.a)(this,"target",o.c.create()),Object(a.a)(this,"up",o.c.create()),this.controls=s(document.getElementById("canvas"),{eye:t,center:n,mode:"turntable"}),o.c.add(this.target,this.position,this.direction),o.a.lookAt(this.viewMatrix,this.controls.eye,this.controls.center,this.controls.up)}return Object(i.a)(e,[{key:"setAspectRatio",value:function(e){this.aspectRatio=e}},{key:"updateProjectionMatrix",value:function(){o.a.perspective(this.projectionMatrix,this.fovy,this.aspectRatio,this.near,this.far)}},{key:"update",value:function(){this.controls.tick(),o.c.add(this.target,this.position,this.direction),o.a.lookAt(this.viewMatrix,this.controls.eye,this.controls.center,this.controls.up)}}]),e}();t.a=u},"5Eg2":function(e,t){e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},"5YEP":function(e,t,n){var r=n("/sWY");e.exports=function(e,t,n,i){var a,o,s,u,c,l,d,f,h,p,m=t[0],g=t[1],v=t[2],b=i[0],_=i[1],y=i[2],x=n[0],w=n[1],M=n[2];if(Math.abs(m-x)<1e-6&&Math.abs(g-w)<1e-6&&Math.abs(v-M)<1e-6)return r(e);d=m-x,f=g-w,h=v-M,p=1/Math.sqrt(d*d+f*f+h*h),a=_*(h*=p)-y*(f*=p),o=y*(d*=p)-b*h,s=b*f-_*d,(p=Math.sqrt(a*a+o*o+s*s))?(a*=p=1/p,o*=p,s*=p):(a=0,o=0,s=0);u=f*s-h*o,c=h*a-d*s,l=d*o-f*a,(p=Math.sqrt(u*u+c*c+l*l))?(u*=p=1/p,c*=p,l*=p):(u=0,c=0,l=0);return e[0]=a,e[1]=u,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=l,e[10]=h,e[11]=0,e[12]=-(a*m+o*g+s*v),e[13]=-(u*m+c*g+l*v),e[14]=-(d*m+f*g+h*v),e[15]=1,e}},"5cX8":function(e,t){e.exports=function(e,t,n,r){var i,a,o,s,u,c=t[0],l=t[1],d=t[2],f=t[3],h=n[0],p=n[1],m=n[2],g=n[3];(a=c*h+l*p+d*m+f*g)<0&&(a=-a,h=-h,p=-p,m=-m,g=-g);1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-r)*i)/o,u=Math.sin(r*i)/o):(s=1-r,u=r);return e[0]=s*c+u*h,e[1]=s*l+u*p,e[2]=s*d+u*m,e[3]=s*f+u*g,e}},"6eGt":function(e,t){e.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],d=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=a*i+c*r,e[5]=o*i+l*r,e[6]=s*i+d*r,e[7]=u*i+f*r,e[8]=c*i-a*r,e[9]=l*i-o*r,e[10]=d*i-s*r,e[11]=f*i-u*r,e}},"7HaW":function(e,t,n){"use strict";e.exports=function(e){var t=(e=e||{}).center||[0,0,0],n=e.up||[0,1,0],r=e.right||d(n),i=e.radius||1,a=e.theta||0,l=e.phi||0;if(t=[].slice.call(t,0,3),n=[].slice.call(n,0,3),s(n,n),r=[].slice.call(r,0,3),s(r,r),"eye"in e){var h=e.eye,p=[h[0]-t[0],h[1]-t[1],h[2]-t[2]];o(r,p,n),c(r[0],r[1],r[2])<1e-6?r=d(n):s(r,r),i=c(p[0],p[1],p[2]);var m=u(n,p)/i,g=u(r,p)/i;l=Math.acos(m),a=Math.acos(g)}return i=Math.log(i),new f(e.zoomMin,e.zoomMax,t,n,r,i,a,l)};var r=n("j5xS"),i=n("k0P+"),a=n("mWlC"),o=n("J6RW"),s=n("kTsV"),u=n("5Eg2");function c(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))}function l(e){return Math.min(1,Math.max(-1,e))}function d(e){var t=Math.abs(e[0]),n=Math.abs(e[1]),r=Math.abs(e[2]),i=[0,0,0];t>Math.max(n,r)?i[2]=1:n>Math.max(t,r)?i[0]=1:i[1]=1;for(var a=0,o=0,u=0;u<3;++u)a+=e[u]*e[u],o+=i[u]*e[u];for(u=0;u<3;++u)i[u]-=o/a*e[u];return s(i,i),i}function f(e,t,n,i,a,o,s,u){this.center=r(n),this.up=r(i),this.right=r(a),this.radius=r([o]),this.angle=r([s,u]),this.angle.bounds=[[-1/0,-Math.PI/2],[1/0,Math.PI/2]],this.setDistanceLimits(e,t),this.computedCenter=this.center.curve(0),this.computedUp=this.up.curve(0),this.computedRight=this.right.curve(0),this.computedRadius=this.radius.curve(0),this.computedAngle=this.angle.curve(0),this.computedToward=[0,0,0],this.computedEye=[0,0,0],this.computedMatrix=new Array(16);for(var c=0;c<16;++c)this.computedMatrix[c]=.5;this.recalcMatrix(0)}var h=f.prototype;h.setDistanceLimits=function(e,t){e=e>0?Math.log(e):-1/0,t=t>0?Math.log(t):1/0,t=Math.max(t,e),this.radius.bounds[0][0]=e,this.radius.bounds[1][0]=t},h.getDistanceLimits=function(e){var t=this.radius.bounds[0];return e?(e[0]=Math.exp(t[0][0]),e[1]=Math.exp(t[1][0]),e):[Math.exp(t[0][0]),Math.exp(t[1][0])]},h.recalcMatrix=function(e){this.center.curve(e),this.up.curve(e),this.right.curve(e),this.radius.curve(e),this.angle.curve(e);for(var t=this.computedUp,n=this.computedRight,r=0,i=0,a=0;a<3;++a)i+=t[a]*n[a],r+=t[a]*t[a];var u=Math.sqrt(r),l=0;for(a=0;a<3;++a)n[a]-=t[a]*i/r,l+=n[a]*n[a],t[a]/=u;var d=Math.sqrt(l);for(a=0;a<3;++a)n[a]/=d;var f=this.computedToward;o(f,t,n),s(f,f);var h=Math.exp(this.computedRadius[0]),p=this.computedAngle[0],m=this.computedAngle[1],g=Math.cos(p),v=Math.sin(p),b=Math.cos(m),_=Math.sin(m),y=this.computedCenter,x=g*b,w=v*b,M=_,A=-g*_,S=-v*_,E=b,P=this.computedEye,C=this.computedMatrix;for(a=0;a<3;++a){var T=x*n[a]+w*f[a]+M*t[a];C[4*a+1]=A*n[a]+S*f[a]+E*t[a],C[4*a+2]=T,C[4*a+3]=0}var O=C[1],k=C[5],R=C[9],B=C[2],L=C[6],j=C[10],I=k*j-R*L,D=R*B-O*j,G=O*L-k*B,U=c(I,D,G);I/=U,D/=U,G/=U,C[0]=I,C[4]=D,C[8]=G;for(a=0;a<3;++a)P[a]=y[a]+C[2+4*a]*h;for(a=0;a<3;++a){l=0;for(var V=0;V<3;++V)l+=C[a+4*V]*P[V];C[12+a]=-l}C[15]=1},h.getMatrix=function(e,t){this.recalcMatrix(e);var n=this.computedMatrix;if(t){for(var r=0;r<16;++r)t[r]=n[r];return t}return n};var p=[0,0,0];h.rotate=function(e,t,n,r){if(this.angle.move(e,t,n),r){this.recalcMatrix(e);var i=this.computedMatrix;p[0]=i[2],p[1]=i[6],p[2]=i[10];for(var o=this.computedUp,s=this.computedRight,u=this.computedToward,c=0;c<3;++c)i[4*c]=o[c],i[4*c+1]=s[c],i[4*c+2]=u[c];a(i,i,r,p);for(c=0;c<3;++c)o[c]=i[4*c],s[c]=i[4*c+1];this.up.set(e,o[0],o[1],o[2]),this.right.set(e,s[0],s[1],s[2])}},h.pan=function(e,t,n,r){t=t||0,n=n||0,r=r||0,this.recalcMatrix(e);var i=this.computedMatrix,a=(Math.exp(this.computedRadius[0]),i[1]),o=i[5],s=i[9],u=c(a,o,s);a/=u,o/=u,s/=u;var l=i[0],d=i[4],f=i[8],h=l*a+d*o+f*s,p=c(l-=a*h,d-=o*h,f-=s*h),m=(l/=p)*t+a*n,g=(d/=p)*t+o*n,v=(f/=p)*t+s*n;this.center.move(e,m,g,v);var b=Math.exp(this.computedRadius[0]);b=Math.max(1e-4,b+r),this.radius.set(e,Math.log(b))},h.translate=function(e,t,n,r){this.center.move(e,t||0,n||0,r||0)},h.setMatrix=function(e,t,n,r){var a=1;"number"===typeof n&&(a=0|n),(a<0||a>3)&&(a=1);var o=(a+2)%3;t||(this.recalcMatrix(e),t=this.computedMatrix);var s=t[a],u=t[a+4],d=t[a+8];if(r){var f=Math.abs(s),h=Math.abs(u),p=Math.abs(d),m=Math.max(f,h,p);f===m?(s=s<0?-1:1,u=d=0):p===m?(d=d<0?-1:1,s=u=0):(u=u<0?-1:1,s=d=0)}else{var g=c(s,u,d);s/=g,u/=g,d/=g}var v,b,_=t[o],y=t[o+4],x=t[o+8],w=_*s+y*u+x*d,M=c(_-=s*w,y-=u*w,x-=d*w),A=u*(x/=M)-d*(y/=M),S=d*(_/=M)-s*x,E=s*y-u*_,P=c(A,S,E);if(A/=P,S/=P,E/=P,this.center.jump(e,z,W,q),this.radius.idle(e),this.up.jump(e,s,u,d),this.right.jump(e,_,y,x),2===a){var C=t[1],T=t[5],O=t[9],k=C*_+T*y+O*x,R=C*A+T*S+O*E;v=I<0?-Math.PI/2:Math.PI/2,b=Math.atan2(R,k)}else{var B=t[2],L=t[6],j=t[10],I=B*s+L*u+j*d,D=B*_+L*y+j*x,G=B*A+L*S+j*E;v=Math.asin(l(I)),b=Math.atan2(G,D)}this.angle.jump(e,b,v),this.recalcMatrix(e);var U=t[2],V=t[6],F=t[10],N=this.computedMatrix;i(N,t);var H=N[15],z=N[12]/H,W=N[13]/H,q=N[14]/H,K=Math.exp(this.computedRadius[0]);this.center.jump(e,z-U*K,W-V*K,q-F*K)},h.lastT=function(){return Math.max(this.center.lastT(),this.up.lastT(),this.right.lastT(),this.radius.lastT(),this.angle.lastT())},h.idle=function(e){this.center.idle(e),this.up.idle(e),this.right.idle(e),this.radius.idle(e),this.angle.idle(e)},h.flush=function(e){this.center.flush(e),this.up.flush(e),this.right.flush(e),this.radius.flush(e),this.angle.flush(e)},h.setDistance=function(e,t){t>0&&this.radius.set(e,Math.log(t))},h.lookAt=function(e,t,n,r){this.recalcMatrix(e),t=t||this.computedEye,n=n||this.computedCenter;var i=(r=r||this.computedUp)[0],a=r[1],o=r[2],s=c(i,a,o);if(!(s<1e-6)){i/=s,a/=s,o/=s;var u=t[0]-n[0],d=t[1]-n[1],f=t[2]-n[2],h=c(u,d,f);if(!(h<1e-6)){u/=h,d/=h,f/=h;var p=this.computedRight,m=p[0],g=p[1],v=p[2],b=i*m+a*g+o*v,_=c(m-=b*i,g-=b*a,v-=b*o);if(!(_<.01&&(_=c(m=a*f-o*d,g=o*u-i*f,v=i*d-a*u))<1e-6)){m/=_,g/=_,v/=_,this.up.set(e,i,a,o),this.right.set(e,m,g,v),this.center.set(e,n[0],n[1],n[2]),this.radius.set(e,Math.log(h));var y=a*v-o*g,x=o*m-i*v,w=i*g-a*m,M=c(y,x,w),A=i*u+a*d+o*f,S=m*u+g*d+v*f,E=(y/=M)*u+(x/=M)*d+(w/=M)*f,P=Math.asin(l(A)),C=Math.atan2(E,S),T=this.angle._state,O=T[T.length-1],k=T[T.length-2];O%=2*Math.PI;var R=Math.abs(O+2*Math.PI-C),B=Math.abs(O-C),L=Math.abs(O-2*Math.PI-C);R<B&&(O+=2*Math.PI),L<B&&(O-=2*Math.PI),this.angle.jump(this.angle.lastT(),O,k),this.angle.set(e,C,P)}}}}},"7QzT":function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){var n=Object.prototype.toString;function r(e){return"function"==typeof e.constructor?e.constructor.name:null}e.exports=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var t=typeof e;if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return"GeneratorFunction"===r(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){return!(!e.constructor||"function"!=typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(r(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(t=n.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")}},function(e,t,n){"use strict";const r=n(2),i=n(0),a=n(8);function o(e,t){switch(i(e)){case"object":return function(e,t){if("function"==typeof t)return t(e);if(t||a(e)){const n=new e.constructor;for(let r in e)n[r]=o(e[r],t);return n}return e}(e,t);case"array":return function(e,t){const n=new e.constructor(e.length);for(let r=0;r<e.length;r++)n[r]=o(e[r],t);return n}(e,t);default:return r(e)}}e.exports=o},function(e,t,n){"use strict";(function(t){const r=Symbol.prototype.valueOf,i=n(0);e.exports=function(e,n){switch(i(e)){case"array":return e.slice();case"object":return Object.assign({},e);case"date":return new e.constructor(Number(e));case"map":return new Map(e);case"set":return new Set(e);case"buffer":return function(e){const n=e.length,r=t.allocUnsafe?t.allocUnsafe(n):t.from(n);return e.copy(r),r}(e);case"symbol":return function(e){return r?Object(r.call(e)):{}}(e);case"arraybuffer":return function(e){const t=new e.constructor(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}(e);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return function(e,t){return new e.constructor(e.buffer,e.byteOffset,e.length)}(e);case"regexp":return function(e){const t=void 0!==e.flags?e.flags:/\w+$/.exec(e)||void 0,n=new e.constructor(e.source,t);return n.lastIndex=e.lastIndex,n}(e);case"error":return Object.create(e);default:return e}}}).call(this,n(3).Buffer)},function(e,t,n){"use strict";(function(e){var r=n(5),i=n(6),a=n(7);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|h(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&a(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=s(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return P(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var d=!0,f=0;f<u;f++)if(c(e,a+f)!==c(t,f)){d=!1;break}if(d)return a}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function y(e,t,n,r){return N(V(t,e.length-n),e,n,r)}function x(e,t,n,r){return N(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return x(e,t,n,r)}function M(e,t,n,r){return N(F(t),e,n,r)}function A(e,t,n,r){return N(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=n)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=U(e[a]);return i}function O(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function B(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function I(e,t,n,r,a){return a||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,a){return a||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return d(null,e)},u.allocUnsafeSlow=function(e){return d(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),d=0;d<s;++d)if(c[d]!==l[d]){a=c[d],o=l[d];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return x(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return M(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return I(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return I(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:V(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var G=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(G,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function N(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(4))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,d=s>0?o-4:o;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));return 1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,h=e[t+d];for(d+=f,a=h&(1<<-l)-1,h>>=-l,l+=s;l>0;a=256*a+e[t+d],d+=f,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+d],d+=f,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),a-=c}return(h?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=l?(s=0,o=l):o+d>=1?(s=(t*u-1)*Math.pow(2,i),o+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=255&s,h+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+h]=255&o,h+=p,o/=256,c-=8);e[n+h-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var r=n(9);function i(e){return!0===r(e)&&"[object Object]"===Object.prototype.toString.call(e)}e.exports=function(e){var t,n;return!1!==i(e)&&"function"==typeof(t=e.constructor)&&!1!==i(n=t.prototype)&&!1!==n.hasOwnProperty("isPrototypeOf")}},function(e,t,n){"use strict";e.exports=function(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"setShaderRegisteredCallback",(function(){return b}));var r=n(1),i=n.n(r),a="__WEBGPU_LIVE_SHADER_INFO__";function o(e,t,n){if(a in n)return n[a];var r={device:e,descriptor:t,id:Math.random().toString(36).substring(2,15),generation:0};return n[a]=r,r}function s(e,t,n){if(a in n)return n[a];var r={device:e,descriptor:t,registrationGeneration:0,vertexStageGeneration:0,fragmentStageGeneration:0,computeStageGeneration:0};return n[a]=r,r}function u(e,t,n){if(a in n)return n[a];var r={device:e,descriptor:t,registrationGeneration:0,vertexStageGeneration:0,fragmentStageGeneration:0,computeStageGeneration:0};return n[a]=r,r}function c(e){return e[a]}function l(e){return e[a]}var d=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function h(e){return i()(e)}var p=function(){function e(e,t){this._registrationGeneration=1,this._shaderModuleUpdates=new Map,this._fn=e,this._onShaderRegistered=t}return e.prototype.setOnShaderRegisteredCallback=function(e){this._onShaderRegistered=e},e.prototype.createShaderModule=function(e,t){t=h(t);var n=this._fn.createShaderModule.call(e,t);return o(e,t,n),n},e.prototype.createRenderPipeline=function(e,t){t=h(t);var n=this._fn.createRenderPipeline.call(e,t);return s(e,t,n),n},e.prototype.createRenderPipelineAsync=function(e,t){return d(this,void 0,GPURenderPipeline,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return t=h(t),[4,this._fn.createRenderPipelineAsync.call(e,t)];case 1:return n=r.sent(),s(e,t,n),[2,n]}}))}))},e.prototype.createComputePipeline=function(e,t){t=h(t);var n=this._fn.createComputePipeline.call(e,t);return u(e,t,n),n},e.prototype.createComputePipelineAsync=function(e,t){return d(this,void 0,GPUComputePipeline,(function(){var n;return f(this,(function(r){switch(r.label){case 0:return t=h(t),[4,this._fn.createComputePipelineAsync.call(e,t)];case 1:return n=r.sent(),u(e,t,n),[2,n]}}))}))},e.prototype.registerShaderStage=function(e){var t=this;if(e&&e.module){var n=c(e.module);this._onShaderRegistered&&this._onShaderRegistered(n.descriptor.code,(function(e){t._shaderModuleUpdates.set(n.id,e)}))}},e.prototype.registerRenderPipelineShaders=function(e){var t=l(e);if(t.registrationGeneration!==this._registrationGeneration){t.registrationGeneration=this._registrationGeneration;var n=t.descriptor;this.registerShaderStage("vertex"in n?n.vertex:n.vertexStage),this.registerShaderStage("fragment"in n?n.fragment:"fragmentStage"in n?n.fragmentStage:void 0)}},e.prototype.registerComputePipelineShaders=function(e){var t=l(e);if(t.registrationGeneration!==this._registrationGeneration){t.registrationGeneration=this._registrationGeneration;var n=t.descriptor;this.registerShaderStage("compute"in n?n.compute:n.computeStage)}},e.prototype.updateShaderStage=function(e){if(e&&e.module){var t=c(e.module);if(this._shaderModuleUpdates.has(t.id)){var n=this._shaderModuleUpdates.get(t.id);t.descriptor.code=n,this._shaderModuleUpdates.delete(t.id);try{var r=this._fn.createShaderModule.call(t.device,t.descriptor);o(t.device,t.descriptor,r),Object.assign(c(r),t),t.replacement=r,t.generation+=1}catch(e){console.error(e)}}return t.generation}},e.prototype.updatePipeline=function(e){if(0!==this._shaderModuleUpdates.size){var t,n,r,i,a,o,s,u,d,f=l(e),h=f.descriptor;"vertex"in h?i=h.vertex:"vertexStage"in h&&(s=h.vertexStage),"fragment"in h?a=h.fragment:"fragmentStage"in h&&(u=h.fragmentStage),"compute"in h?o=h.compute:"computeStage"in h&&(d=h.computeStage),t=this.updateShaderStage(i)||this.updateShaderStage(s),n=this.updateShaderStage(a)||this.updateShaderStage(u),r=this.updateShaderStage(o)||this.updateShaderStage(d);var p=void 0!==t&&t!==f.vertexStageGeneration,m=void 0!==n&&n!==f.fragmentStageGeneration,g=void 0!==r&&r!==f.computeStageGeneration;(p||m||g)&&(p&&(i&&(h.vertex.module=c(h.vertex.module).replacement),s&&(h.vertexStage.module=c(h.vertexStage.module).replacement)),m&&(a&&(h.fragment.module=c(h.fragment.module).replacement),u&&(h.fragmentStage.module=c(h.fragmentStage.module).replacement)),g&&(o&&(h.compute.module=c(h.compute.module).replacement),d&&(h.computeStage.module=c(h.computeStage.module).replacement)),p||m?this._fn.createRenderPipelineAsync.call(f.device,h).then((function(e){f.replacement=e})):g&&this._fn.createComputePipelineAsync.call(f.device,h).then((function(e){f.replacement=e})))}},e.prototype.setRenderPipeline=function(e,t){return this.registerRenderPipelineShaders(t),this.updatePipeline(t),t=l(t).replacement||t,this._fn.setRenderPipeline.call(e,t)},e.prototype.setComputePipeline=function(e,t){return this.registerComputePipelineShaders(t),this.updatePipeline(t),t=l(t).replacement||t,this._fn.setComputePipeline.call(e,t)},e}(),m=navigator.gpu?new p({createShaderModule:GPUDevice.prototype.createShaderModule,createRenderPipeline:GPUDevice.prototype.createRenderPipeline,createRenderPipelineAsync:GPUDevice.prototype.createRenderPipelineAsync,createComputePipeline:GPUDevice.prototype.createComputePipeline,createComputePipelineAsync:GPUDevice.prototype.createComputePipelineAsync,setRenderPipeline:GPURenderPassEncoder.prototype.setPipeline,setComputePipeline:GPUComputePassEncoder.prototype.setPipeline}):void 0,g=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};function b(e){m.setOnShaderRegisteredCallback(e)}navigator.gpu&&(Object.assign(GPUDevice.prototype,{createShaderModule:function(e){return m.createShaderModule(this,e)},createRenderPipeline:function(e){return m.createRenderPipeline(this,e)},createRenderPipelineAsync:function(e){return g(this,void 0,GPURenderPipeline,(function(){return v(this,(function(t){return[2,m.createRenderPipelineAsync(this,e)]}))}))},createComputePipeline:function(e){return m.createComputePipeline(this,e)},createComputePipelineAsync:function(e){return g(this,void 0,GPUComputePipeline,(function(){return v(this,(function(t){return[2,m.createComputePipelineAsync(this,e)]}))}))}}),Object.assign(GPURenderPassEncoder.prototype,{setPipeline:function(e){return m.setRenderPipeline(this,e)}}),Object.assign(GPUComputePassEncoder.prototype,{setPipeline:function(e){return m.setComputePipeline(this,e)}}))}])},"7S6R":function(e,t){e.exports=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}},"7ZjA":function(e,t){e.exports=function(e,t){var n=t[15];if(0===n)return!1;for(var r=1/n,i=0;i<16;i++)e[i]=t[i]*r;return!0}},"7rvo":function(e,t,n){"use strict";t.a="//////////////////////////////////////////////////////////////////////\n//                General Vertex Shader                             //\n////////////////////////////////////////////////////////////////////// \n\n[[block]] struct Uniforms {\n    modelViewProjectionMatrix : mat4x4<f32>;\n    gridOn : f32;\n    time: f32;\n  };\n[[binding(0), group(0)]] var<uniform> uniforms : Uniforms;\n  \n  struct VertexOutput {\n    [[builtin(position)]] Position : vec4<f32>;\n    [[location(0)]] fragUV : vec2<f32>;\n    [[location(1)]] fragPosition: vec4<f32>;\n    [[location(2)]] fragNor : vec4<f32>;\n  };\n  \n  [[stage(vertex)]]\n  fn vs_main([[location(0)]] position : vec4<f32>,\n             [[location(1)]] uv : vec2<f32>,\n             [[location(2)]] nor : vec4<f32>) -> VertexOutput {\n    var output : VertexOutput;\n    output.Position = uniforms.modelViewProjectionMatrix * position;\n    output.fragUV = uv;\n    output.fragPosition = position;\n    output.fragNor = nor;\n    return output;\n  }\n\n//////////////////////////////////////////////////////////////////////\n//            Fragment Shader for Platform                          //\n////////////////////////////////////////////////////////////////////// \n\n[[group(0), binding(1)]] var mySampler: sampler;\n[[group(0), binding(2)]] var myTexture: texture_2d<f32>;\n\n[[stage(fragment)]]\nfn fs_platform([[location(0)]] fragUV: vec2<f32>,\n               [[location(1)]] fragPosition: vec4<f32>,\n               [[location(2)]] fragNor : vec4<f32>) -> [[location(0)]] vec4<f32> {\n  var lightDir = vec4<f32>(1.0, 1.0, 1.0, 0.0);\n  var lambertTerm = dot(normalize(lightDir), normalize(fragNor));\n\n  if (fragUV.x == -1.0){\n    return vec4<f32>(0.9, 0.9, 0.9, 1.0);\n  }\n  var albedo = vec4<f32>(1.0, 1.0, 1.0, 1.0);\n  \n  if (uniforms.gridOn == 1.0){\n    albedo = textureSample(myTexture, mySampler, fragUV) + 0.95;\n  }\n  return albedo;\n}\n\n////////////////////////////////////////////////////////////////////////\n//                       Shaders for Goals                            //\n////////////////////////////////////////////////////////////////////////\n\nstruct VertexOutputGoal {\n    [[builtin(position)]] Position : vec4<f32>;\n    [[location(0)]] fragPosition: vec4<f32>;\n    [[location(1)]] fragNor : vec4<f32>;\n};\n\n[[stage(vertex)]]\n  fn vs_goal([[location(0)]] goalPos : vec4<f32>,\n             [[location(1)]] meshPos : vec4<f32>,\n             [[location(2)]] meshNor : vec4<f32>) -> VertexOutputGoal {\n               \n    var model = mat4x4<f32>();\n    model[0] = vec4<f32>(1.0, 0.0, 0.0, 0.0);\n    model[1] = vec4<f32>(0.0, 1.0, 0.0, 0.0);\n    model[2] = vec4<f32>(0.0, 0.0, 1.0, 0.0);\n    model[3] = vec4<f32>(goalPos[0], goalPos[1], goalPos[2], 1.0);\n\n    var output : VertexOutputGoal;\n    output.Position = uniforms.modelViewProjectionMatrix * model * meshPos;\n    output.fragPosition = meshPos;\n    output.fragNor = meshNor;\n    return output;\n  }\n\n[[stage(fragment)]]\nfn fs_goal([[location(0)]] fragPosition: vec4<f32>,\n               [[location(1)]] fragNor : vec4<f32>) -> [[location(0)]] vec4<f32> {\n  var lightDir = vec4<f32>(1.0, 1.0, 1.0, 0.0);\n  var lambertTerm = dot(normalize(lightDir), normalize(fragNor));\n\n  var ambient = vec4<f32>(0.2, 0.5, 0.2, 0.0);\n  var albedo = vec4<f32>(0.0, 1.0, 0.0, 1.0);\n\n  // move color palette along sphere in y direction\n  var y = (fragPosition.y + 1.0) / 2.0;\n  y = fract(y + uniforms.time * 0.002);\n\n  // cosine color palette\n  var a = vec3<f32>(0.608, 0.718, 0.948);\n  var b = vec3<f32>(0.858, 0.248, 0.308);\n  var c = vec3<f32>(-1.112, 1.000, 1.000);\n  var d = vec3<f32>(0.000, 0.333, 0.667);\n  albedo = vec4<f32>(a + b*cos( 6.28318*(c*y+d) ), 1.0);\n\n  return albedo + ambient * lambertTerm;\n}\n"},"83uV":function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// PBD Constraint Solving Compute Shader\n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read> agentData_r : Agents;\n[[binding(2), group(0)]] var<storage, write> agentData_w : Agents;\n[[binding(3), group(0)]] var<storage, read> grid : Grid;\n[[binding(4), group(0)]] var<storage, read> obstacleData : Obstacles;\n\nfn long_range_constraint(agent: Agent, agent_j: Agent, itr: i32, count: ptr<function, i32>, totalDx: ptr<function, vec3<f32>>)\n{\n  let dt = sim_params.deltaTime;\n\n  let r = agent.r + agent_j.r;\n  var r_sq = r * r;\n\n  let dist = distance(agent.x, agent_j.x);\n  if (dist < r) {\n    r_sq = (r - dist) * (r - dist);\n  }\n\n  // relative displacement\n  let x_ij = agent.x - agent_j.x;\n\n  // relative velocity\n  let v_ij = (1.0/dt) * (agent.xp - agent.x - agent_j.xp + agent_j.x);\n\n  let a = dot(v_ij, v_ij);\n  let b = -dot(x_ij, v_ij);\n  let c = dot(x_ij, x_ij) - r_sq;\n  var discr = b*b - a*c;\n  if (discr < 0.0 || abs(a) < eps) { return; }\n\n  discr = sqrt(discr);\n\n  // Compute exact time to collision\n  let t = (b - discr)/a;\n  //let t2 = (b + discr)/a;\n  //var t = select(t1, t2, t2 < t1 && t2 > 0.0);\n\n  // Prune out invalid case\n  if (t < eps || t > t0) { return; }\n\n  // Get time before and after collision\n  let t_nocollision = dt * floor(t/dt);\n  let t_collision = dt + t_nocollision;\n\n  // Get collision and collision-free positions\n  let xi_nocollision = agent.x + t_nocollision * agent.v;\n  var xi_collision   = agent.x + t_collision * agent.v;\n  let xj_nocollision = agent_j.x + t_nocollision * agent_j.v;\n  var xj_collision   = agent_j.x + t_collision * agent_j.v;\n\n  // Enforce collision free for x_collision using distance constraint\n  var n = xi_collision - xj_collision;\n  let d = length(n);\n\n  let f = d - r;\n  if (f < 0.0) {\n    n = normalize(n);\n    \n    var k = k_longrange * exp(-t_nocollision*t_nocollision/t0);\n    k = 1.0 - pow(1.0 - k, 1.0/(f32(itr + 1)));\n    let w = agent.w / (agent.w + agent_j.w);\n    var dx = -w * f * n;\n\n    // 4.5 Avoidance Model\n    if (sim_params.avoidance == 1.0f) {\n      // get collision-free position\n      xi_collision = xi_collision + dx;\n      xj_collision = xj_collision - dx;\n\n      // total relative displacement\n      let d_vec = (xi_collision - xi_nocollision) - (xj_collision - xj_nocollision);\n\n      // tangential relative displacement\n      let d_tangent = d_vec - dot(d_vec, n)*n;\n      dx = w * d_tangent;\n    }\n\n    *totalDx = *totalDx + k * dx;\n    *count = *count + 1;\n  }\n}\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n  let idx = GlobalInvocationID.x;\n\n  var itr = sim_params.iteration;\n\n  var agent = agentData_r.agents[idx];\n  var totalDx = vec3<f32>(0.0, 0.0, 0.0);\n  var neighborCount = 0;\n  let dt = sim_params.deltaTime;\n\n  // 4.4 Long Range Collision\n  if (agent.cell < 0){\n    // ignore invalid cells\n    agent.c = vec4<f32>(1.0, 0.0, 0.0, 1.0);\n    agentData_w.agents[idx] = agent;\n    return;\n  }\n\n  let gridWidth = i32(sim_params.gridWidth);\n  let gridHeight = i32(sim_params.gridWidth);\n  // compute neighbors\n  var nearCount = 0u;\n  var farCount = 0u;\n  //// TODO don't hardcode 9 cells \n  let cellsToCheck = 9u;\n  var nearCellNums = array<i32, 9u>(\n    agent.cell + gridWidth - 1, agent.cell + gridWidth, agent.cell + gridWidth + 1,\n    agent.cell - 1, agent.cell, agent.cell+1, \n    agent.cell - gridWidth - 1, agent.cell - gridWidth, agent.cell - gridWidth + 1);\n\n  for (var c : u32 = 0u; c < cellsToCheck; c = c + 1u ){\n    let cellIdx = nearCellNums[c];\n    if (cellIdx < 0 || cellIdx >= gridWidth * gridHeight){\n      continue;\n    }\n    let cell : CellIndices = grid.cells[cellIdx];\n    for (var i : u32 = cell.start; i <= cell.end; i = i + 1u) {\n\n      if (idx == i) { \n        // ignore ourselves\n        continue; \n      }\n      let agent_j = agentData_r.agents[i];\n\n      let dist = distance(agent.x, agent_j.x);\n\n      if (dist >= farRadius){\n        continue;\n      }\n\n      long_range_constraint(agent, agent_j, itr, &neighborCount, &totalDx);\n    }\n  }\n\n  if (neighborCount > 0) {\n    agent.xp = agent.xp + avgCoefficient * totalDx / f32(neighborCount);\n  }\n\n  // 4.7 Obstacles Collision\n  totalDx = vec3<f32>(0.0);\n  neighborCount = 0;\n  \n  for (var j : u32 = 0u; j < arrayLength(&obstacleData.obstacles); j = j + 1u){\n    obstacle_constraint(agent, obstacleData.obstacles[j], &neighborCount, &totalDx);\n  }\n\n  if (neighborCount > 0) {\n    let k = 1.0 - pow(1.0 - k_obstacle, 1.0/(f32(itr + 1)));\n    agent.xp = agent.xp + avgCoefficient * k * totalDx / f32(neighborCount);\n  }\n\n  // Store the new agent value\n  agentData_w.agents[idx] = agent;\n}\n"},"8Zcn":function(e,t,n){var r=n("7ZjA"),i=n("3Mjd"),a=n("+1Zu"),o=n("sckk"),s=n("k0P+"),u=n("7S6R"),c={length:n("i+ZN"),normalize:n("kTsV"),dot:n("5Eg2"),cross:n("J6RW")},l=i(),d=i(),f=[0,0,0,0],h=[[0,0,0],[0,0,0],[0,0,0]],p=[0,0,0];function m(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}e.exports=function(e,t,n,i,g,v){if(t||(t=[0,0,0]),n||(n=[0,0,0]),i||(i=[0,0,0]),g||(g=[0,0,0,1]),v||(v=[0,0,0,1]),!r(l,e))return!1;if(a(d,l),d[3]=0,d[7]=0,d[11]=0,d[15]=1,Math.abs(o(d)<1e-8))return!1;var b,_,y=l[3],x=l[7],w=l[11],M=l[12],A=l[13],S=l[14],E=l[15];if(0!==y||0!==x||0!==w){if(f[0]=y,f[1]=x,f[2]=w,f[3]=E,!s(d,d))return!1;u(d,d),function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o}(g,f,d)}else g[0]=g[1]=g[2]=0,g[3]=1;if(t[0]=M,t[1]=A,t[2]=S,_=l,(b=h)[0][0]=_[0],b[0][1]=_[1],b[0][2]=_[2],b[1][0]=_[4],b[1][1]=_[5],b[1][2]=_[6],b[2][0]=_[8],b[2][1]=_[9],b[2][2]=_[10],n[0]=c.length(h[0]),c.normalize(h[0],h[0]),i[0]=c.dot(h[0],h[1]),m(h[1],h[1],h[0],1,-i[0]),n[1]=c.length(h[1]),c.normalize(h[1],h[1]),i[0]/=n[1],i[1]=c.dot(h[0],h[2]),m(h[2],h[2],h[0],1,-i[1]),i[2]=c.dot(h[1],h[2]),m(h[2],h[2],h[1],1,-i[2]),n[2]=c.length(h[2]),c.normalize(h[2],h[2]),i[1]/=n[2],i[2]/=n[2],c.cross(p,h[1],h[2]),c.dot(h[0],p)<0)for(var P=0;P<3;P++)n[P]*=-1,h[P][0]*=-1,h[P][1]*=-1,h[P][2]*=-1;return v[0]=.5*Math.sqrt(Math.max(1+h[0][0]-h[1][1]-h[2][2],0)),v[1]=.5*Math.sqrt(Math.max(1-h[0][0]+h[1][1]-h[2][2],0)),v[2]=.5*Math.sqrt(Math.max(1-h[0][0]-h[1][1]+h[2][2],0)),v[3]=.5*Math.sqrt(Math.max(1+h[0][0]+h[1][1]+h[2][2],0)),h[2][1]>h[1][2]&&(v[0]=-v[0]),h[0][2]>h[2][0]&&(v[1]=-v[1]),h[1][0]>h[0][1]&&(v[2]=-v[2]),!0}},"8i9l":function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n("rePB"),i=n("nKUr"),a=n("g4pe"),o=n.n(a),s=n("20a2"),u=n("q1tI"),c=n("hIuh"),l=n.n(c);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h="undefined"!==typeof GPUDevice&&n("7QzT").setShaderRegisteredCallback;n("+dQi");var p=function(e){var t=Object(u.useRef)(null),r=Object(u.useMemo)((function(){return e.sources.map((function(e){return f({name:e.name},function(e,t){var r,a={lineNumbers:!0,lineWrapping:!0,theme:"monokai",readOnly:!t},o=null,s=[];o=document.createElement("div");var u=n("VrN/");return(r=u(o,a)).updatedSource=function(e){s.forEach((function(t){return t(e)}))},{updateCallbacks:s,Container:function(n){return Object(i.jsxs)("div",f(f({},n),{},{children:[t?Object(i.jsx)("button",{className:l.a.updateSourceBtn,onClick:function(){r.updatedSource(r.getValue())},children:"Update"}):null,Object(i.jsx)("div",{ref:function(t){o&&t&&(t.appendChild(o),r.setOption("value",e))}})]}))}}}(e.contents,e.editable))}))}),e.sources),a=Object(u.useRef)(null),c=Object(u.useMemo)((function(){if(e.gui)return new(n("iZKT").GUI)({autoPlace:!1})}),[]),d=Object(u.useRef)(null),p=Object(u.useMemo)((function(){if(e.stats)return new(n("MZFn"))}),[]),m=Object(s.useRouter)().asPath.match(/#([a-zA-Z0-9\.\/]+)/),g=Object(u.useState)(null),v=(g[0],g[1]),b=null!=t.current?t.current.width:1600,_=null!=t.current?t.current.height:800,y=Object(u.useState)(null),x=(y[0],y[1]);return Object(u.useEffect)((function(){x(m?m[1]:r[0].name),c&&a.current&&a.current.appendChild(c.domElement),p&&d&&d.current.appendChild(p.domElement);try{var n=e.init({canvasRef:t,gui:c,stats:p});n instanceof Promise&&n.catch((function(e){console.error(e),v(e)}))}catch(i){console.error(i),v(i)}}),[]),Object(u.useEffect)((function(){h&&h((function(t,n){e.sources.findIndex((function(e){return e.contents==t}))}))}),[r]),Object(i.jsxs)("main",{children:[Object(i.jsxs)(o.a,{children:[Object(i.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n            .CodeMirror {\n              height: auto !important;\n              margin: 1em 0;\n            }\n\n            .CodeMirror-scroll {\n              height: auto !important;\n              overflow: visible !important;\n            }\n          "}}),Object(i.jsx)("title",{className:l.a.title,children:"".concat(e.name)}),Object(i.jsx)("meta",{name:"description",content:e.description})]}),Object(i.jsxs)("div",{className:l.a.canvasContainer,children:[Object(i.jsx)("div",{style:{position:"absolute",right:0},ref:a}),Object(i.jsx)("div",{style:{position:"absolute",left:10},ref:d}),Object(i.jsx)("canvas",{ref:t,width:b,height:_})]})]})},m=function(e){return Object(i.jsx)(p,f({},e))}},A54A:function(e,t,n){"use strict";e.exports=function(e,t){e=e||document.body,t=t||{};var n=[.01,1/0];"distanceLimits"in t&&(n[0]=t.distanceLimits[0],n[1]=t.distanceLimits[1]);"zoomMin"in t&&(n[0]=t.zoomMin);"zoomMax"in t&&(n[1]=t.zoomMax);var c=i({center:t.center||[0,0,0],up:t.up||[0,1,0],eye:t.eye||[0,0,10],mode:t.mode||"orbit",distanceLimits:n}),l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=0,f=e.clientWidth,h=e.clientHeight,p={view:c,element:e,delay:t.delay||16,rotateSpeed:t.rotateSpeed||1,zoomSpeed:t.zoomSpeed||1,translateSpeed:t.translateSpeed||1,flipX:!!t.flipX,flipY:!!t.flipY,modes:c.modes,tick:function(){var t=r(),n=this.delay;c.idle(t-n),c.flush(t-(100+2*n));var i=t-2*n;c.recalcMatrix(i);for(var a=!0,o=c.computedMatrix,s=0;s<16;++s)a=a&&l[s]===o[s],l[s]=o[s];var u=e.clientWidth===f&&e.clientHeight===h;return f=e.clientWidth,h=e.clientHeight,a?!u:(d=Math.exp(c.computedRadius[0]),!0)},lookAt:function(e,t,n){c.lookAt(c.lastT(),e,t,n)},rotate:function(e,t,n){c.rotate(c.lastT(),e,t,n)},pan:function(e,t,n){c.pan(c.lastT(),e,t,n)},translate:function(e,t,n){c.translate(c.lastT(),e,t,n)}};Object.defineProperties(p,{matrix:{get:function(){return c.computedMatrix},set:function(e){return c.setMatrix(c.lastT(),e),c.computedMatrix},enumerable:!0},mode:{get:function(){return c.getMode()},set:function(e){return c.setMode(e),c.getMode()},enumerable:!0},center:{get:function(){return c.computedCenter},set:function(e){return c.lookAt(c.lastT(),e),c.computedCenter},enumerable:!0},eye:{get:function(){return c.computedEye},set:function(e){return c.lookAt(c.lastT(),null,e),c.computedEye},enumerable:!0},up:{get:function(){return c.computedUp},set:function(e){return c.lookAt(c.lastT(),null,null,e),c.computedUp},enumerable:!0},distance:{get:function(){return d},set:function(e){return c.setDistance(c.lastT(),e),e},enumerable:!0},distanceLimits:{get:function(){return c.getDistanceLimits(n)},set:function(e){return c.setDistanceLimits(e),e},enumerable:!0}}),e.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1}));var m=0,g=0,v={shift:!1,control:!1,alt:!1,meta:!1};function b(t,n,i,a){var o=1/e.clientHeight,s=o*(n-m),u=o*(i-g),l=p.flipX?1:-1,f=p.flipY?1:-1,h=Math.PI*p.rotateSpeed,b=r();if(1&t)a.shift?c.rotate(b,0,0,-s*h):c.rotate(b,l*h*s,-f*h*u,0);else if(2&t)c.pan(b,-p.translateSpeed*s*d,p.translateSpeed*u*d,0);else if(4&t){var _=p.zoomSpeed*u/window.innerHeight*(b-c.lastT())*50;c.pan(b,0,0,d*(Math.exp(_)-1))}m=n,g=i,v=a}return a(e,b),e.addEventListener("touchstart",(function(t){var n=s(t.changedTouches[0],e);b(0,n[0],n[1],v),b(1,n[0],n[1],v),t.preventDefault()}),!!u&&{passive:!1}),e.addEventListener("touchmove",(function(t){var n=s(t.changedTouches[0],e);b(1,n[0],n[1],v),t.preventDefault()}),!!u&&{passive:!1}),e.addEventListener("touchend",(function(t){s(t.changedTouches[0],e);b(0,m,g,v),t.preventDefault()}),!!u&&{passive:!1}),o(e,(function(e,t,n){var i=p.flipX?1:-1,a=p.flipY?1:-1,o=r();if(Math.abs(e)>Math.abs(t))c.rotate(o,0,0,-e*i*Math.PI*p.rotateSpeed/window.innerWidth);else{var s=p.zoomSpeed*a*t/window.innerHeight*(o-c.lastT())/100;c.pan(o,0,0,d*(Math.exp(s)-1))}}),!0),p};var r=n("jPIa"),i=n("39+4"),a=n("kbhw"),o=n("pd01"),s=n("i5jP"),u=n("FHfC")},AtRM:function(e,t,n){"use strict";n.r(t),t.default="import { mat4 } from 'gl-matrix';\nimport {GLTFLoader} from '../../node_modules/three/examples/jsm/loaders/GLTFLoader.js';\n\nexport class Mesh {\n    vertexArray     : Float32Array;\n    vertexCount     : number;\n    itemSize        : number;\n    posOffset       : number;\n    uvOffset        : number;\n    normalOffset    : number;\n    colorOffset     : number;\n    scale           : number;\n    rotation        : mat4;\n\n    constructor(array : Array<number>, count : number){\n        this.vertexArray = new Float32Array(array);\n        this.vertexCount = count;\n        this.itemSize = 4 * 4 + // position vec4\n                        2 * 4 + // uv vec2\n                        4 * 4 + // normal vec4\n                        3 * 4;  // color vec3\n        this.posOffset = 0;\n        this.uvOffset = 4 * 4;\n        this.normalOffset = 6 * 4;\n        this.colorOffset = 10 * 4;\n        this.scale = 0;                 // set in main, specific to model\n        this.rotation = mat4.create();  // set in main, specific to model\n    }\n}\n\nexport function loadModel(gltfPath : string, device: GPUDevice) {\n    const tmpMeshVertexArray = [];\n\n    const promise = new Promise((resolve, reject) => {\n        const loader = new GLTFLoader();\n\n        loader.load( gltfPath, ( gltf ) => {\n            let vertCount = 0;\n            let vertArrayIdx = 0;\n\n            // extract vertices and save to Float32Array\n            gltf.scene.traverse( ( child ) => {\n                if ( child.isMesh ) {\n                    vertCount = vertCount + child.geometry.index.count;\n                    const gltfArray = child.geometry.attributes.position.array;\n                    const gltfUVArray = child.geometry.attributes.uv.array;\n                    const gltfNormalArray = child.geometry.attributes.normal.array;\n                    const gltfIdxArray = child.geometry.index.array;\n                    const color = child.material.color;\n\n                    for (let i = 0; i < gltfIdxArray.length; i++){\n                        const idx = gltfIdxArray[i];\n                        tmpMeshVertexArray[vertArrayIdx+0] = gltfArray[idx * 3 + 0];        // position.x\n                        tmpMeshVertexArray[vertArrayIdx+1] = gltfArray[idx * 3 + 1];        // position.y\n                        tmpMeshVertexArray[vertArrayIdx+2] = gltfArray[idx * 3 + 2];        // position.z\n                        tmpMeshVertexArray[vertArrayIdx+3] = 1;                             // position.w\n                        tmpMeshVertexArray[vertArrayIdx+4] = gltfUVArray[idx * 2 + 0];      // uv.u\n                        tmpMeshVertexArray[vertArrayIdx+5] = gltfUVArray[idx * 2 + 1];      // uv.v\n                        tmpMeshVertexArray[vertArrayIdx+6] = gltfNormalArray[idx * 3 + 0];  // normal.x\n                        tmpMeshVertexArray[vertArrayIdx+7] = gltfNormalArray[idx * 3 + 1];  // normal.y\n                        tmpMeshVertexArray[vertArrayIdx+8] = gltfNormalArray[idx * 3 + 2];  // normal.z\n                        tmpMeshVertexArray[vertArrayIdx+9] = 0;                             // normal.w\n                        tmpMeshVertexArray[vertArrayIdx+10] = color.r;                     // color.r\n                        tmpMeshVertexArray[vertArrayIdx+11] = color.g;                     // color.g\n                        tmpMeshVertexArray[vertArrayIdx+12] = color.b;                     // color.b\n\n                        vertArrayIdx += 13;\n                    }\n                }\n            })\n            const mesh = new Mesh(tmpMeshVertexArray, vertCount);\n            resolve(mesh);\n        });\n    })\n    return promise;\n}"},FBcx:function(e,t){e.exports=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],m=t[12],g=t[13],v=t[14],b=t[15],_=n[0],y=n[1],x=n[2],w=n[3];return e[0]=_*r+y*s+x*d+w*m,e[1]=_*i+y*u+x*f+w*g,e[2]=_*a+y*c+x*h+w*v,e[3]=_*o+y*l+x*p+w*b,_=n[4],y=n[5],x=n[6],w=n[7],e[4]=_*r+y*s+x*d+w*m,e[5]=_*i+y*u+x*f+w*g,e[6]=_*a+y*c+x*h+w*v,e[7]=_*o+y*l+x*p+w*b,_=n[8],y=n[9],x=n[10],w=n[11],e[8]=_*r+y*s+x*d+w*m,e[9]=_*i+y*u+x*f+w*g,e[10]=_*a+y*c+x*h+w*v,e[11]=_*o+y*l+x*p+w*b,_=n[12],y=n[13],x=n[14],w=n[15],e[12]=_*r+y*s+x*d+w*m,e[13]=_*i+y*u+x*f+w*g,e[14]=_*a+y*c+x*h+w*v,e[15]=_*o+y*l+x*p+w*b,e}},FHfC:function(e,t,n){"use strict";var r=n("3PNt");e.exports=r&&function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(n){e=!1}return e}()},FOf1:function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// Explicit Integration for Advecting the Agents\n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read_write> agentData : Agents;\n\nfn getVelocityFromPlanner(agent : Agent) -> vec3<f32> {\n  // TODO: Implement a more complex planner\n  return normalize(agent.goal - agent.x) * agent.speed;\n}\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n\n  let idx = GlobalInvocationID.x;\n  var agent = agentData.agents[idx];\n\n  if (idx >= u32(sim_params.numAgents)){\n    return;\n  }\n\n  // velcity planning\n  var vp = getVelocityFromPlanner(agent);\n\n  // 4.1 Velocity Blending\n  agent.v = (1.0 - ksi) * agent.v + ksi * vp;\n\n  // explicit integration\n  agent.xp = agent.x + sim_params.deltaTime * agent.v;\n\n  // Store the new agent value\n  agentData.agents[idx] = agent;\n}\n"},GwYZ:function(e,t){e.exports=function(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}},"HaE+":function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return i}))},IOcx:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a}));var r={};n.r(r),n.d(r,"create",(function(){return c})),n.d(r,"clone",(function(){return l})),n.d(r,"copy",(function(){return d})),n.d(r,"fromValues",(function(){return f})),n.d(r,"set",(function(){return h})),n.d(r,"identity",(function(){return p})),n.d(r,"transpose",(function(){return m})),n.d(r,"invert",(function(){return g})),n.d(r,"adjoint",(function(){return v})),n.d(r,"determinant",(function(){return b})),n.d(r,"multiply",(function(){return _})),n.d(r,"translate",(function(){return y})),n.d(r,"scale",(function(){return x})),n.d(r,"rotate",(function(){return w})),n.d(r,"rotateX",(function(){return M})),n.d(r,"rotateY",(function(){return A})),n.d(r,"rotateZ",(function(){return S})),n.d(r,"fromTranslation",(function(){return E})),n.d(r,"fromScaling",(function(){return P})),n.d(r,"fromRotation",(function(){return C})),n.d(r,"fromXRotation",(function(){return T})),n.d(r,"fromYRotation",(function(){return O})),n.d(r,"fromZRotation",(function(){return k})),n.d(r,"fromRotationTranslation",(function(){return R})),n.d(r,"fromQuat2",(function(){return B})),n.d(r,"getTranslation",(function(){return L})),n.d(r,"getScaling",(function(){return j})),n.d(r,"getRotation",(function(){return I})),n.d(r,"fromRotationTranslationScale",(function(){return D})),n.d(r,"fromRotationTranslationScaleOrigin",(function(){return G})),n.d(r,"fromQuat",(function(){return U})),n.d(r,"frustum",(function(){return V})),n.d(r,"perspective",(function(){return F})),n.d(r,"perspectiveFromFieldOfView",(function(){return N})),n.d(r,"ortho",(function(){return H})),n.d(r,"lookAt",(function(){return z})),n.d(r,"targetTo",(function(){return W})),n.d(r,"str",(function(){return q})),n.d(r,"frob",(function(){return K})),n.d(r,"add",(function(){return Y})),n.d(r,"subtract",(function(){return X})),n.d(r,"multiplyScalar",(function(){return J})),n.d(r,"multiplyScalarAndAdd",(function(){return Q})),n.d(r,"exactEquals",(function(){return Z})),n.d(r,"equals",(function(){return $})),n.d(r,"mul",(function(){return ee})),n.d(r,"sub",(function(){return te}));var i={};n.r(i),n.d(i,"create",(function(){return ne})),n.d(i,"clone",(function(){return re})),n.d(i,"fromValues",(function(){return ie})),n.d(i,"copy",(function(){return ae})),n.d(i,"set",(function(){return oe})),n.d(i,"add",(function(){return se})),n.d(i,"subtract",(function(){return ue})),n.d(i,"multiply",(function(){return ce})),n.d(i,"divide",(function(){return le})),n.d(i,"ceil",(function(){return de})),n.d(i,"floor",(function(){return fe})),n.d(i,"min",(function(){return he})),n.d(i,"max",(function(){return pe})),n.d(i,"round",(function(){return me})),n.d(i,"scale",(function(){return ge})),n.d(i,"scaleAndAdd",(function(){return ve})),n.d(i,"distance",(function(){return be})),n.d(i,"squaredDistance",(function(){return _e})),n.d(i,"length",(function(){return ye})),n.d(i,"squaredLength",(function(){return xe})),n.d(i,"negate",(function(){return we})),n.d(i,"inverse",(function(){return Me})),n.d(i,"normalize",(function(){return Ae})),n.d(i,"dot",(function(){return Se})),n.d(i,"cross",(function(){return Ee})),n.d(i,"lerp",(function(){return Pe})),n.d(i,"random",(function(){return Ce})),n.d(i,"transformMat2",(function(){return Te})),n.d(i,"transformMat2d",(function(){return Oe})),n.d(i,"transformMat3",(function(){return ke})),n.d(i,"transformMat4",(function(){return Re})),n.d(i,"rotate",(function(){return Be})),n.d(i,"angle",(function(){return Le})),n.d(i,"zero",(function(){return je})),n.d(i,"str",(function(){return Ie})),n.d(i,"exactEquals",(function(){return De})),n.d(i,"equals",(function(){return Ge})),n.d(i,"len",(function(){return Ue})),n.d(i,"sub",(function(){return Ve})),n.d(i,"mul",(function(){return Fe})),n.d(i,"div",(function(){return Ne})),n.d(i,"dist",(function(){return He})),n.d(i,"sqrDist",(function(){return ze})),n.d(i,"sqrLen",(function(){return We})),n.d(i,"forEach",(function(){return qe}));var a={};n.r(a),n.d(a,"create",(function(){return Ke})),n.d(a,"clone",(function(){return Ye})),n.d(a,"length",(function(){return Xe})),n.d(a,"fromValues",(function(){return Je})),n.d(a,"copy",(function(){return Qe})),n.d(a,"set",(function(){return Ze})),n.d(a,"add",(function(){return $e})),n.d(a,"subtract",(function(){return et})),n.d(a,"multiply",(function(){return tt})),n.d(a,"divide",(function(){return nt})),n.d(a,"ceil",(function(){return rt})),n.d(a,"floor",(function(){return it})),n.d(a,"min",(function(){return at})),n.d(a,"max",(function(){return ot})),n.d(a,"round",(function(){return st})),n.d(a,"scale",(function(){return ut})),n.d(a,"scaleAndAdd",(function(){return ct})),n.d(a,"distance",(function(){return lt})),n.d(a,"squaredDistance",(function(){return dt})),n.d(a,"squaredLength",(function(){return ft})),n.d(a,"negate",(function(){return ht})),n.d(a,"inverse",(function(){return pt})),n.d(a,"normalize",(function(){return mt})),n.d(a,"dot",(function(){return gt})),n.d(a,"cross",(function(){return vt})),n.d(a,"lerp",(function(){return bt})),n.d(a,"hermite",(function(){return _t})),n.d(a,"bezier",(function(){return yt})),n.d(a,"random",(function(){return xt})),n.d(a,"transformMat4",(function(){return wt})),n.d(a,"transformMat3",(function(){return Mt})),n.d(a,"transformQuat",(function(){return At})),n.d(a,"rotateX",(function(){return St})),n.d(a,"rotateY",(function(){return Et})),n.d(a,"rotateZ",(function(){return Pt})),n.d(a,"angle",(function(){return Ct})),n.d(a,"zero",(function(){return Tt})),n.d(a,"str",(function(){return Ot})),n.d(a,"exactEquals",(function(){return kt})),n.d(a,"equals",(function(){return Rt})),n.d(a,"sub",(function(){return Bt})),n.d(a,"mul",(function(){return Lt})),n.d(a,"div",(function(){return jt})),n.d(a,"dist",(function(){return It})),n.d(a,"sqrDist",(function(){return Dt})),n.d(a,"len",(function(){return Gt})),n.d(a,"sqrLen",(function(){return Ut})),n.d(a,"forEach",(function(){return Vt}));var o=1e-6,s="undefined"!==typeof Float32Array?Float32Array:Array,u=Math.random;Math.PI;function c(){var e=new s(16);return s!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){var t=new s(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,n,r,i,a,o,u,c,l,d,f,h,p,m,g){var v=new s(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=i,v[5]=a,v[6]=o,v[7]=u,v[8]=c,v[9]=l,v[10]=d,v[11]=f,v[12]=h,v[13]=p,v[14]=m,v[15]=g,v}function h(e,t,n,r,i,a,o,s,u,c,l,d,f,h,p,m,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=d,e[11]=f,e[12]=h,e[13]=p,e[14]=m,e[15]=g,e}function p(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function m(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function g(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],v=t[15],b=n*s-r*o,_=n*u-i*o,y=n*c-a*o,x=r*u-i*s,w=r*c-a*s,M=i*c-a*u,A=l*m-d*p,S=l*g-f*p,E=l*v-h*p,P=d*g-f*m,C=d*v-h*m,T=f*v-h*g,O=b*T-_*C+y*P+x*E-w*S+M*A;return O?(O=1/O,e[0]=(s*T-u*C+c*P)*O,e[1]=(i*C-r*T-a*P)*O,e[2]=(m*M-g*w+v*x)*O,e[3]=(f*w-d*M-h*x)*O,e[4]=(u*E-o*T-c*S)*O,e[5]=(n*T-i*E+a*S)*O,e[6]=(g*y-p*M-v*_)*O,e[7]=(l*M-f*y+h*_)*O,e[8]=(o*C-s*E+c*A)*O,e[9]=(r*E-n*C-a*A)*O,e[10]=(p*w-m*y+v*b)*O,e[11]=(d*y-l*w-h*b)*O,e[12]=(s*S-o*P-u*A)*O,e[13]=(n*P-r*S+i*A)*O,e[14]=(m*_-p*x-g*b)*O,e[15]=(l*x-d*_+f*b)*O,e):null}function v(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],v=t[15];return e[0]=s*(f*v-h*g)-d*(u*v-c*g)+m*(u*h-c*f),e[1]=-(r*(f*v-h*g)-d*(i*v-a*g)+m*(i*h-a*f)),e[2]=r*(u*v-c*g)-s*(i*v-a*g)+m*(i*c-a*u),e[3]=-(r*(u*h-c*f)-s*(i*h-a*f)+d*(i*c-a*u)),e[4]=-(o*(f*v-h*g)-l*(u*v-c*g)+p*(u*h-c*f)),e[5]=n*(f*v-h*g)-l*(i*v-a*g)+p*(i*h-a*f),e[6]=-(n*(u*v-c*g)-o*(i*v-a*g)+p*(i*c-a*u)),e[7]=n*(u*h-c*f)-o*(i*h-a*f)+l*(i*c-a*u),e[8]=o*(d*v-h*m)-l*(s*v-c*m)+p*(s*h-c*d),e[9]=-(n*(d*v-h*m)-l*(r*v-a*m)+p*(r*h-a*d)),e[10]=n*(s*v-c*m)-o*(r*v-a*m)+p*(r*c-a*s),e[11]=-(n*(s*h-c*d)-o*(r*h-a*d)+l*(r*c-a*s)),e[12]=-(o*(d*g-f*m)-l*(s*g-u*m)+p*(s*f-u*d)),e[13]=n*(d*g-f*m)-l*(r*g-i*m)+p*(r*f-i*d),e[14]=-(n*(s*g-u*m)-o*(r*g-i*m)+p*(r*u-i*s)),e[15]=n*(s*f-u*d)-o*(r*f-i*d)+l*(r*u-i*s),e}function b(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],h=e[12],p=e[13],m=e[14],g=e[15];return(t*o-n*a)*(d*g-f*m)-(t*s-r*a)*(l*g-f*p)+(t*u-i*a)*(l*m-d*p)+(n*s-r*o)*(c*g-f*h)-(n*u-i*o)*(c*m-d*h)+(r*u-i*s)*(c*p-l*h)}function _(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],m=t[12],g=t[13],v=t[14],b=t[15],_=n[0],y=n[1],x=n[2],w=n[3];return e[0]=_*r+y*s+x*d+w*m,e[1]=_*i+y*u+x*f+w*g,e[2]=_*a+y*c+x*h+w*v,e[3]=_*o+y*l+x*p+w*b,_=n[4],y=n[5],x=n[6],w=n[7],e[4]=_*r+y*s+x*d+w*m,e[5]=_*i+y*u+x*f+w*g,e[6]=_*a+y*c+x*h+w*v,e[7]=_*o+y*l+x*p+w*b,_=n[8],y=n[9],x=n[10],w=n[11],e[8]=_*r+y*s+x*d+w*m,e[9]=_*i+y*u+x*f+w*g,e[10]=_*a+y*c+x*h+w*v,e[11]=_*o+y*l+x*p+w*b,_=n[12],y=n[13],x=n[14],w=n[15],e[12]=_*r+y*s+x*d+w*m,e[13]=_*i+y*u+x*f+w*g,e[14]=_*a+y*c+x*h+w*v,e[15]=_*o+y*l+x*p+w*b,e}function y(e,t,n){var r,i,a,o,s,u,c,l,d,f,h,p,m=n[0],g=n[1],v=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=d,e[9]=f,e[10]=h,e[11]=p,e[12]=r*m+s*g+d*v+t[12],e[13]=i*m+u*g+f*v+t[13],e[14]=a*m+c*g+h*v+t[14],e[15]=o*m+l*g+p*v+t[15]),e}function x(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function w(e,t,n,r){var i,a,s,u,c,l,d,f,h,p,m,g,v,b,_,y,x,w,M,A,S,E,P,C,T=r[0],O=r[1],k=r[2],R=Math.hypot(T,O,k);return R<o?null:(T*=R=1/R,O*=R,k*=R,i=Math.sin(n),s=1-(a=Math.cos(n)),u=t[0],c=t[1],l=t[2],d=t[3],f=t[4],h=t[5],p=t[6],m=t[7],g=t[8],v=t[9],b=t[10],_=t[11],y=T*T*s+a,x=O*T*s+k*i,w=k*T*s-O*i,M=T*O*s-k*i,A=O*O*s+a,S=k*O*s+T*i,E=T*k*s+O*i,P=O*k*s-T*i,C=k*k*s+a,e[0]=u*y+f*x+g*w,e[1]=c*y+h*x+v*w,e[2]=l*y+p*x+b*w,e[3]=d*y+m*x+_*w,e[4]=u*M+f*A+g*S,e[5]=c*M+h*A+v*S,e[6]=l*M+p*A+b*S,e[7]=d*M+m*A+_*S,e[8]=u*E+f*P+g*C,e[9]=c*E+h*P+v*C,e[10]=l*E+p*P+b*C,e[11]=d*E+m*P+_*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function M(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],l=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*r,e[5]=o*i+l*r,e[6]=s*i+d*r,e[7]=u*i+f*r,e[8]=c*i-a*r,e[9]=l*i-o*r,e[10]=d*i-s*r,e[11]=f*i-u*r,e}function A(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],l=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*r,e[1]=o*i-l*r,e[2]=s*i-d*r,e[3]=u*i-f*r,e[8]=a*r+c*i,e[9]=o*r+l*i,e[10]=s*r+d*i,e[11]=u*r+f*i,e}function S(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[4],l=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+c*r,e[1]=o*i+l*r,e[2]=s*i+d*r,e[3]=u*i+f*r,e[4]=c*i-a*r,e[5]=l*i-o*r,e[6]=d*i-s*r,e[7]=f*i-u*r,e}function E(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function P(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t,n){var r,i,a,s=n[0],u=n[1],c=n[2],l=Math.hypot(s,u,c);return l<o?null:(s*=l=1/l,u*=l,c*=l,r=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=s*s*a+i,e[1]=u*s*a+c*r,e[2]=c*s*a-u*r,e[3]=0,e[4]=s*u*a-c*r,e[5]=u*u*a+i,e[6]=c*u*a+s*r,e[7]=0,e[8]=s*c*a+u*r,e[9]=u*c*a-s*r,e[10]=c*c*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function T(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function k(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,c=a+a,l=r*s,d=r*u,f=r*c,h=i*u,p=i*c,m=a*c,g=o*s,v=o*u,b=o*c;return e[0]=1-(h+m),e[1]=d+b,e[2]=f-v,e[3]=0,e[4]=d-b,e[5]=1-(l+m),e[6]=p+g,e[7]=0,e[8]=f+v,e[9]=p-g,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function B(e,t){var n=new s(3),r=-t[0],i=-t[1],a=-t[2],o=t[3],u=t[4],c=t[5],l=t[6],d=t[7],f=r*r+i*i+a*a+o*o;return f>0?(n[0]=2*(u*o+d*r+c*a-l*i)/f,n[1]=2*(c*o+d*i+l*r-u*a)/f,n[2]=2*(l*o+d*a+u*i-c*r)/f):(n[0]=2*(u*o+d*r+c*a-l*i),n[1]=2*(c*o+d*i+l*r-u*a),n[2]=2*(l*o+d*a+u*i-c*r)),R(e,t,n),e}function L(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function j(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(u,c,l),e}function I(e,t){var n=new s(3);j(n,t);var r=1/n[0],i=1/n[1],a=1/n[2],o=t[0]*r,u=t[1]*i,c=t[2]*a,l=t[4]*r,d=t[5]*i,f=t[6]*a,h=t[8]*r,p=t[9]*i,m=t[10]*a,g=o+d+m,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(f-p)/v,e[1]=(h-c)/v,e[2]=(u-l)/v):o>d&&o>m?(v=2*Math.sqrt(1+o-d-m),e[3]=(f-p)/v,e[0]=.25*v,e[1]=(u+l)/v,e[2]=(h+c)/v):d>m?(v=2*Math.sqrt(1+d-o-m),e[3]=(h-c)/v,e[0]=(u+l)/v,e[1]=.25*v,e[2]=(f+p)/v):(v=2*Math.sqrt(1+m-o-d),e[3]=(u-l)/v,e[0]=(h+c)/v,e[1]=(f+p)/v,e[2]=.25*v),e}function D(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,l=o+o,d=i*u,f=i*c,h=i*l,p=a*c,m=a*l,g=o*l,v=s*u,b=s*c,_=s*l,y=r[0],x=r[1],w=r[2];return e[0]=(1-(p+g))*y,e[1]=(f+_)*y,e[2]=(h-b)*y,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(d+g))*x,e[6]=(m+v)*x,e[7]=0,e[8]=(h+b)*w,e[9]=(m-v)*w,e[10]=(1-(d+p))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function G(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],u=t[3],c=a+a,l=o+o,d=s+s,f=a*c,h=a*l,p=a*d,m=o*l,g=o*d,v=s*d,b=u*c,_=u*l,y=u*d,x=r[0],w=r[1],M=r[2],A=i[0],S=i[1],E=i[2],P=(1-(m+v))*x,C=(h+y)*x,T=(p-_)*x,O=(h-y)*w,k=(1-(f+v))*w,R=(g+b)*w,B=(p+_)*M,L=(g-b)*M,j=(1-(f+m))*M;return e[0]=P,e[1]=C,e[2]=T,e[3]=0,e[4]=O,e[5]=k,e[6]=R,e[7]=0,e[8]=B,e[9]=L,e[10]=j,e[11]=0,e[12]=n[0]+A-(P*A+O*S+B*E),e[13]=n[1]+S-(C*A+k*S+L*E),e[14]=n[2]+E-(T*A+R*S+j*E),e[15]=1,e}function U(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,c=n*o,l=r*o,d=r*s,f=i*o,h=i*s,p=i*u,m=a*o,g=a*s,v=a*u;return e[0]=1-d-p,e[1]=l+v,e[2]=f-g,e[3]=0,e[4]=l-v,e[5]=1-c-p,e[6]=h+m,e[7]=0,e[8]=f+g,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V(e,t,n,r,i,a,o){var s=1/(n-t),u=1/(i-r),c=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(o+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*c,e[15]=0,e}function F(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(r-i),e[10]=(i+r)*a,e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e}function N(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),c=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function H(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(o+a)*c,e[15]=1,e}function z(e,t,n,r){var i,a,s,u,c,l,d,f,h,m,g=t[0],v=t[1],b=t[2],_=r[0],y=r[1],x=r[2],w=n[0],M=n[1],A=n[2];return Math.abs(g-w)<o&&Math.abs(v-M)<o&&Math.abs(b-A)<o?p(e):(d=g-w,f=v-M,h=b-A,i=y*(h*=m=1/Math.hypot(d,f,h))-x*(f*=m),a=x*(d*=m)-_*h,s=_*f-y*d,(m=Math.hypot(i,a,s))?(i*=m=1/m,a*=m,s*=m):(i=0,a=0,s=0),u=f*s-h*a,c=h*i-d*s,l=d*a-f*i,(m=Math.hypot(u,c,l))?(u*=m=1/m,c*=m,l*=m):(u=0,c=0,l=0),e[0]=i,e[1]=u,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=l,e[10]=h,e[11]=0,e[12]=-(i*g+a*v+s*b),e[13]=-(u*g+c*v+l*b),e[14]=-(d*g+f*v+h*b),e[15]=1,e)}function W(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],c=r[2],l=i-n[0],d=a-n[1],f=o-n[2],h=l*l+d*d+f*f;h>0&&(l*=h=1/Math.sqrt(h),d*=h,f*=h);var p=u*f-c*d,m=c*l-s*f,g=s*d-u*l;return(h=p*p+m*m+g*g)>0&&(p*=h=1/Math.sqrt(h),m*=h,g*=h),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=d*g-f*m,e[5]=f*p-l*g,e[6]=l*m-d*p,e[7]=0,e[8]=l,e[9]=d,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function q(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function K(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Y(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function X(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function J(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Q(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function $(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],d=e[8],f=e[9],h=e[10],p=e[11],m=e[12],g=e[13],v=e[14],b=e[15],_=t[0],y=t[1],x=t[2],w=t[3],M=t[4],A=t[5],S=t[6],E=t[7],P=t[8],C=t[9],T=t[10],O=t[11],k=t[12],R=t[13],B=t[14],L=t[15];return Math.abs(n-_)<=o*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(r-y)<=o*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-x)<=o*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(a-w)<=o*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-M)<=o*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-A)<=o*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-S)<=o*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-E)<=o*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(d-P)<=o*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-C)<=o*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-T)<=o*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(p-O)<=o*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-k)<=o*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-R)<=o*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(v-B)<=o*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(b-L)<=o*Math.max(1,Math.abs(b),Math.abs(L))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ee=_,te=X;function ne(){var e=new s(2);return s!=Float32Array&&(e[0]=0,e[1]=0),e}function re(e){var t=new s(2);return t[0]=e[0],t[1]=e[1],t}function ie(e,t){var n=new s(2);return n[0]=e,n[1]=t,n}function ae(e,t){return e[0]=t[0],e[1]=t[1],e}function oe(e,t,n){return e[0]=t,e[1]=n,e}function se(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function ue(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function ce(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function le(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function de(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function fe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function he(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function pe(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function me(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ge(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function ve(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function be(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function _e(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function ye(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function xe(e){var t=e[0],n=e[1];return t*t+n*n}function we(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Me(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ae(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Se(e,t){return e[0]*t[0]+e[1]*t[1]}function Ee(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Pe(e,t,n,r){var i=t[0],a=t[1];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e}function Ce(e,t){t=t||1;var n=2*u()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Te(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}function Oe(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}function ke(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}function Re(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}function Be(e,t,n,r){var i=t[0]-n[0],a=t[1]-n[1],o=Math.sin(r),s=Math.cos(r);return e[0]=i*s-a*o+n[0],e[1]=i*o+a*s+n[1],e}function Le(e,t){var n=e[0],r=e[1],i=t[0],a=t[1],o=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+a*a),s=o&&(n*i+r*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function je(e){return e[0]=0,e[1]=0,e}function Ie(e){return"vec2("+e[0]+", "+e[1]+")"}function De(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ge(e,t){var n=e[0],r=e[1],i=t[0],a=t[1];return Math.abs(n-i)<=o*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-a)<=o*Math.max(1,Math.abs(r),Math.abs(a))}var Ue=ye,Ve=ue,Fe=ce,Ne=le,He=be,ze=_e,We=xe,qe=function(){var e=ne();return function(t,n,r,i,a,o){var s,u;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();function Ke(){var e=new s(3);return s!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ye(e){var t=new s(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Xe(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Je(e,t,n){var r=new s(3);return r[0]=e,r[1]=t,r[2]=n,r}function Qe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ze(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function $e(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function et(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function tt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function nt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function rt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function it(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function at(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ot(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function st(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function ut(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function ct(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function lt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function dt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function ft(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function ht(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function pt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function mt(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function gt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function vt(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function bt(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}function _t(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,c=o*(a-1),l=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*s+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*s+n[2]*u+r[2]*c+i[2]*l,e}function yt(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,c=s*o,l=3*a*s,d=3*u*o,f=u*a;return e[0]=t[0]*c+n[0]*l+r[0]*d+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*d+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*d+i[2]*f,e}function xt(e,t){t=t||1;var n=2*u()*Math.PI,r=2*u()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e}function wt(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function Mt(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function At(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=t[0],u=t[1],c=t[2],l=i*c-a*u,d=a*s-r*c,f=r*u-i*s,h=i*f-a*d,p=a*l-r*f,m=r*d-i*l,g=2*o;return l*=g,d*=g,f*=g,h*=2,p*=2,m*=2,e[0]=s+l+h,e[1]=u+d+p,e[2]=c+f+m,e}function St(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Et(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Pt(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Ct(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(a*a+o*o+s*s),c=u&&gt(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function Tt(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ot(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function kt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Rt(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return Math.abs(n-a)<=o*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=o*Math.max(1,Math.abs(i),Math.abs(u))}var Bt=et,Lt=tt,jt=nt,It=lt,Dt=dt,Gt=Xe,Ut=ft,Vt=function(){var e=Ke();return function(t,n,r,i,a,o){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()},J6RW:function(e,t){e.exports=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}},MYnn:function(e,t,n){"use strict";n.r(t),t.default="export const cubeVertexSize = 4 * 13; // Byte size of one cube vertex.\nexport const cubePositionOffset = 0;\nexport const cubeColorOffset = 4 * 10; // Byte offset of cube vertex color attribute.\nexport const cubeUVOffset = 4 * 4;\nexport const cubeNorOffset = 4 * 6;\nexport const cubeVertexCount = 36;\n\n// prettier-ignore\nexport const cubeVertexArray = new Float32Array([\n  // float4 position, float2 uv, float4 normal, float3 color, \n  // has to follow mesh order, because it is loaded in like a mesh\n  1, -1, 1, 1,   1, 1,  0, -1, 0, 0,  1, 1, 1,\n  -1, -1, 1, 1,  0, 1,  0, -1, 0, 0,  1, 1, 1,\n  -1, -1, -1, 1, 0, 0,  0, -1, 0, 0,  1, 1, 1,\n  1, -1, -1, 1,  1, 0,  0, -1, 0, 0,  1, 1, 1,\n  1, -1, 1, 1,   1, 1,  0, -1, 0, 0,  1, 1, 1,\n  -1, -1, -1, 1, 0, 0,  0, -1, 0, 0,  1, 1, 1,\n\n  1, 1, 1, 1,    1, 1,  0, 0, -1, 0,  1, 1, 1,\n  1, -1, 1, 1,   0, 1,  0, 0, -1, 0,  1, 1, 1,\n  1, -1, -1, 1,  0, 0,  0, 0, -1, 0,  1, 1, 1,\n  1, 1, -1, 1,   1, 0,  0, 0, -1, 0,  1, 1, 1,\n  1, 1, 1, 1,    1, 1,  0, 0, -1, 0,  1, 1, 1,\n  1, -1, -1, 1,  0, 0,  0, 0, -1, 0,  1, 1, 1,\n\n  -1, 1, 1, 1,   1, 1,  0, 1, 0, 0,  1, 1, 1,\n  1, 1, 1, 1,    0, 1,  0, 1, 0, 0,  1, 1, 1,\n  1, 1, -1, 1,   0, 0,  0, 1, 0, 0,  1, 1, 1,\n  -1, 1, -1, 1,  1, 0,  0, 1, 0, 0,  1, 1, 1,\n  -1, 1, 1, 1,   1, 1,  0, 1, 0, 0,  1, 1, 1,\n  1, 1, -1, 1,   0, 0,  0, 1, 0, 0,  1, 1, 1,\n\n  -1, -1, 1, 1,  1, 1,  0, 0, 1, 0,  1, 1, 1,\n  -1, 1, 1, 1,   0, 1,  0, 0, 1, 0,  1, 1, 1,\n  -1, 1, -1, 1,  0, 0,  0, 0, 1, 0,  1, 1, 1,\n  -1, -1, -1, 1, 1, 0,  0, 0, 1, 0,  1, 1, 1,\n  -1, -1, 1, 1,  1, 1,  0, 0, 1, 0,  1, 1, 1,\n  -1, 1, -1, 1,  0, 0,  0, 0, 1, 0,  1, 1, 1,\n\n  1, 1, 1, 1,    1, 1,  -1, 0, 0, 0,  1, 1, 1,\n  -1, 1, 1, 1,   0, 1,  -1, 0, 0, 0,  1, 1, 1,\n  -1, -1, 1, 1,  0, 0,  -1, 0, 0, 0,  1, 1, 1,\n  -1, -1, 1, 1,  0, 0,  -1, 0, 0, 0,  1, 1, 1,\n  1, -1, 1, 1,   1, 0,  -1, 0, 0, 0,  1, 1, 1,\n  1, 1, 1, 1,    1, 1,  -1, 0, 0, 0,  1, 1, 1,\n\n  1, -1, -1, 1,  1, 1,  1, 0, 0, 0,  1, 1, 1,\n  -1, -1, -1, 1, 0, 1,  1, 0, 0, 0,  1, 1, 1,\n  -1, 1, -1, 1,  0, 0,  1, 0, 0, 0,  1, 1, 1,\n  1, 1, -1, 1,   1, 0,  1, 0, 0, 0,  1, 1, 1,\n  1, -1, -1, 1,  1, 1,  1, 0, 0, 0,  1, 1, 1,\n  -1, 1, -1, 1,  0, 0,  1, 0, 0, 0,  1, 1, 1,\n]);\n"},MZFn:function(e,t,n){e.exports=function(){var e=function(){function t(e){return i.appendChild(e.dom),e}function n(e){for(var t=0;t<i.children.length;t++)i.children[t].style.display=t===e?"block":"none";r=e}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(e){e.preventDefault(),n(++r%i.children.length)}),!1);var a=(performance||Date).now(),o=a,s=0,u=t(new e.Panel("FPS","#0ff","#002")),c=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(u.update(1e3*s/(e-o),100),o=e,s=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:i,setMode:n}};return e.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,u=48*o,c=3*o,l=2*o,d=3*o,f=15*o,h=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=u,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,s,u),g.fillStyle=t,g.fillText(e,c,l),g.fillRect(d,f,h,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d,f,h,p),{dom:m,update:function(u,v){r=Math.min(r,u),i=Math.max(i,u),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,s,f),g.fillStyle=t,g.fillText(a(u)+" "+e+" ("+a(r)+"-"+a(i)+")",c,l),g.drawImage(m,d+o,f,h-o,p,d,f,h-o,p),g.fillRect(d+h-o,f,o,p),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(d+h-o,f,o,a((1-u/v)*p))}}},e}()},P1cZ:function(e,t,n){e.exports=n("5cX8")},QWga:function(e,t,n){"use strict";var r=n("zHcz"),i=n("iyN4"),a=n("k0P+"),o=n("6eGt"),s=n("RP4a"),u=n("/BFQ"),c=n("5YEP"),l=n("b1F2"),d=(n("nKJB"),n("kTsV")),f=[0,0,0];function h(e){this._components=e.slice(),this._time=[0],this.prevMatrix=e.slice(),this.nextMatrix=e.slice(),this.computedMatrix=e.slice(),this.computedInverse=e.slice(),this.computedEye=[0,0,0],this.computedUp=[0,0,0],this.computedCenter=[0,0,0],this.computedRadius=[0],this._limits=[-1/0,1/0]}e.exports=function(e){return new h((e=e||{}).matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};var p=h.prototype;p.recalcMatrix=function(e){var t=this._time,n=r.le(t,e),o=this.computedMatrix;if(!(n<0)){var s=this._components;if(n===t.length-1)for(var u=16*n,c=0;c<16;++c)o[c]=s[u++];else{var l=t[n+1]-t[n],f=(u=16*n,this.prevMatrix),h=!0;for(c=0;c<16;++c)f[c]=s[u++];var p=this.nextMatrix;for(c=0;c<16;++c)p[c]=s[u++],h=h&&f[c]===p[c];if(l<1e-6||h)for(c=0;c<16;++c)o[c]=f[c];else i(o,f,p,(e-t[n])/l)}var m=this.computedUp;m[0]=o[1],m[1]=o[5],m[2]=o[9],d(m,m);var g=this.computedInverse;a(g,o);var v=this.computedEye,b=g[15];v[0]=g[12]/b,v[1]=g[13]/b,v[2]=g[14]/b;var _=this.computedCenter,y=Math.exp(this.computedRadius[0]);for(c=0;c<3;++c)_[c]=v[c]-o[2+4*c]*y}},p.idle=function(e){if(!(e<this.lastT())){for(var t=this._components,n=t.length-16,r=0;r<16;++r)t.push(t[n++]);this._time.push(e)}},p.flush=function(e){var t=r.gt(this._time,e)-2;t<0||(this._time.splice(0,t),this._components.splice(0,16*t))},p.lastT=function(){return this._time[this._time.length-1]},p.lookAt=function(e,t,n,r){this.recalcMatrix(e),t=t||this.computedEye,n=n||f,r=r||this.computedUp,this.setMatrix(e,c(this.computedMatrix,t,n,r));for(var i=0,a=0;a<3;++a)i+=Math.pow(n[a]-t[a],2);i=Math.log(Math.sqrt(i)),this.computedRadius[0]=i},p.rotate=function(e,t,n,r){this.recalcMatrix(e);var i=this.computedInverse;t&&s(i,i,t),n&&o(i,i,n),r&&u(i,i,r),this.setMatrix(e,a(this.computedMatrix,i))};var m=[0,0,0];p.pan=function(e,t,n,r){m[0]=-(t||0),m[1]=-(n||0),m[2]=-(r||0),this.recalcMatrix(e);var i=this.computedInverse;l(i,i,m),this.setMatrix(e,a(i,i))},p.translate=function(e,t,n,r){m[0]=t||0,m[1]=n||0,m[2]=r||0,this.recalcMatrix(e);var i=this.computedMatrix;l(i,i,m),this.setMatrix(e,i)},p.setMatrix=function(e,t){if(!(e<this.lastT())){this._time.push(e);for(var n=0;n<16;++n)this._components.push(t[n])}},p.setDistance=function(e,t){this.computedRadius[0]=t},p.setDistanceLimits=function(e,t){var n=this._limits;n[0]=e,n[1]=t},p.getDistanceLimits=function(e){var t=this._limits;return e?(e[0]=t[0],e[1]=t[1],e):t}},RP4a:function(e,t){e.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],l=t[9],d=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=a*i-c*r,e[1]=o*i-l*r,e[2]=s*i-d*r,e[3]=u*i-f*r,e[8]=a*r+c*i,e[9]=o*r+l*i,e[10]=s*r+d*i,e[11]=u*r+f*i,e}},TGkP:function(e,t){e.exports=function(e,t){t||(t=[0,""]),e=String(e);var n=parseFloat(e,10);return t[0]=n,t[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t}},UPBU:function(e,t){e.exports="/webgpu-crowd-simulation/_next/static/c84b12b5c60150f4caadb44316e3b86c.png"},WSjQ:function(e,t){e.exports=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,c=n*o,l=r*o,d=r*s,f=i*o,h=i*s,p=i*u,m=a*o,g=a*s,v=a*u;return e[0]=1-d-p,e[1]=l+v,e[2]=f-g,e[3]=0,e[4]=l-v,e[5]=1-c-p,e[6]=h+m,e[7]=0,e[8]=f+g,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},WrN2:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={XBot:{filename:"xbot.glb",scale:.01},"Cesium Man":{filename:"Cesium_Man.glb",scale:1},Duck:{filename:"Duck.glb",scale:.005},Ship:{filename:"ship.glb",scale:.13},Tower:{filename:"tower.gltf",scale:.27},"Garbage Truck":{filename:"garbageTruck.glb",scale:.3},Sedan:{filename:"sedan.glb",scale:.35}}},XPkA:function(e,t,n){"use strict";function r(e){return e.target||e.srcElement||window}t.buttons=function(e){if("object"===typeof e){if("buttons"in e)return e.buttons;if("which"in e){if(2===(t=e.which))return 4;if(3===t)return 2;if(t>0)return 1<<t-1}else if("button"in e){var t;if(1===(t=e.button))return 4;if(2===t)return 2;if(t>=0)return 1<<t}}return 0},t.element=r,t.x=function(e){if("object"===typeof e){if("offsetX"in e)return e.offsetX;var t=r(e).getBoundingClientRect();return e.clientX-t.left}return 0},t.y=function(e){if("object"===typeof e){if("offsetY"in e)return e.offsetY;var t=r(e).getBoundingClientRect();return e.clientY-t.top}return 0}},YeY6:function(e,t,n){"use strict";e.exports=function(e){var t=(e=e||{}).center||[0,0,0],n=e.rotation||[0,0,0,1],r=e.radius||1;t=[].slice.call(t,0,3),l(n=[].slice.call(n,0,4),n);var i=new d(n,t,Math.log(r));i.setDistanceLimits(e.zoomMin,e.zoomMax),("eye"in e||"up"in e)&&i.lookAt(0,e.eye,e.center,e.up);return i};var r=n("j5xS"),i=n("5YEP"),a=n("WSjQ"),o=n("k0P+"),s=n("o5ol");function u(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))}function c(e,t,n,r){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2)+Math.pow(r,2))}function l(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=c(n,r,i,a);o>1e-6?(e[0]=n/o,e[1]=r/o,e[2]=i/o,e[3]=a/o):(e[0]=e[1]=e[2]=0,e[3]=1)}function d(e,t,n){this.radius=r([n]),this.center=r(t),this.rotation=r(e),this.computedRadius=this.radius.curve(0),this.computedCenter=this.center.curve(0),this.computedRotation=this.rotation.curve(0),this.computedUp=[.1,0,0],this.computedEye=[.1,0,0],this.computedMatrix=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.recalcMatrix(0)}var f=d.prototype;f.lastT=function(){return Math.max(this.radius.lastT(),this.center.lastT(),this.rotation.lastT())},f.recalcMatrix=function(e){this.radius.curve(e),this.center.curve(e),this.rotation.curve(e);var t=this.computedRotation;l(t,t);var n=this.computedMatrix;a(n,t);var r=this.computedCenter,i=this.computedEye,o=this.computedUp,s=Math.exp(this.computedRadius[0]);i[0]=r[0]+s*n[2],i[1]=r[1]+s*n[6],i[2]=r[2]+s*n[10],o[0]=n[1],o[1]=n[5],o[2]=n[9];for(var u=0;u<3;++u){for(var c=0,d=0;d<3;++d)c+=n[u+4*d]*i[d];n[12+u]=-c}},f.getMatrix=function(e,t){this.recalcMatrix(e);var n=this.computedMatrix;if(t){for(var r=0;r<16;++r)t[r]=n[r];return t}return n},f.idle=function(e){this.center.idle(e),this.radius.idle(e),this.rotation.idle(e)},f.flush=function(e){this.center.flush(e),this.radius.flush(e),this.rotation.flush(e)},f.pan=function(e,t,n,r){t=t||0,n=n||0,r=r||0,this.recalcMatrix(e);var i=this.computedMatrix,a=i[1],o=i[5],s=i[9],c=u(a,o,s);a/=c,o/=c,s/=c;var l=i[0],d=i[4],f=i[8],h=l*a+d*o+f*s,p=u(l-=a*h,d-=o*h,f-=s*h);l/=p,d/=p,f/=p;var m=i[2],g=i[6],v=i[10],b=m*a+g*o+v*s,_=m*l+g*d+v*f,y=u(m-=b*a+_*l,g-=b*o+_*d,v-=b*s+_*f);m/=y,g/=y,v/=y;var x=l*t+a*n,w=d*t+o*n,M=f*t+s*n;this.center.move(e,x,w,M);var A=Math.exp(this.computedRadius[0]);A=Math.max(1e-4,A+r),this.radius.set(e,Math.log(A))},f.rotate=function(e,t,n,r){this.recalcMatrix(e),t=t||0,n=n||0;var i=this.computedMatrix,a=i[0],o=i[4],s=i[8],l=i[1],d=i[5],f=i[9],h=i[2],p=i[6],m=i[10],g=t*a+n*l,v=t*o+n*d,b=t*s+n*f,_=-(p*b-m*v),y=-(m*g-h*b),x=-(h*v-p*g),w=Math.sqrt(Math.max(0,1-Math.pow(_,2)-Math.pow(y,2)-Math.pow(x,2))),M=c(_,y,x,w);M>1e-6?(_/=M,y/=M,x/=M,w/=M):(_=y=x=0,w=1);var A=this.computedRotation,S=A[0],E=A[1],P=A[2],C=A[3],T=S*w+C*_+E*x-P*y,O=E*w+C*y+P*_-S*x,k=P*w+C*x+S*y-E*_,R=C*w-S*_-E*y-P*x;if(r){_=h,y=p,x=m;var B=Math.sin(r)/u(_,y,x);_*=B,y*=B,x*=B,R=R*(w=Math.cos(t))-(T=T*w+R*_+O*x-k*y)*_-(O=O*w+R*y+k*_-T*x)*y-(k=k*w+R*x+T*y-O*_)*x}var L=c(T,O,k,R);L>1e-6?(T/=L,O/=L,k/=L,R/=L):(T=O=k=0,R=1),this.rotation.set(e,T,O,k,R)},f.lookAt=function(e,t,n,r){this.recalcMatrix(e),n=n||this.computedCenter,t=t||this.computedEye,r=r||this.computedUp;var a=this.computedMatrix;i(a,t,n,r);var o=this.computedRotation;s(o,a[0],a[1],a[2],a[4],a[5],a[6],a[8],a[9],a[10]),l(o,o),this.rotation.set(e,o[0],o[1],o[2],o[3]);for(var u=0,c=0;c<3;++c)u+=Math.pow(n[c]-t[c],2);this.radius.set(e,.5*Math.log(Math.max(u,1e-6))),this.center.set(e,n[0],n[1],n[2])},f.translate=function(e,t,n,r){this.center.move(e,t||0,n||0,r||0)},f.setMatrix=function(e,t){var n=this.computedRotation;s(n,t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]),l(n,n),this.rotation.set(e,n[0],n[1],n[2],n[3]);var r=this.computedMatrix;o(r,t);var i=r[15];if(Math.abs(i)>1e-6){var a=r[12]/i,u=r[13]/i,c=r[14]/i;this.recalcMatrix(e);var d=Math.exp(this.computedRadius[0]);this.center.set(e,a-r[2]*d,u-r[6]*d,c-r[10]*d),this.radius.idle(e)}else this.center.idle(e),this.radius.idle(e)},f.setDistance=function(e,t){t>0&&this.radius.set(e,Math.log(t))},f.setDistanceLimits=function(e,t){e=e>0?Math.log(e):-1/0,t=t>0?Math.log(t):1/0,t=Math.max(t,e),this.radius.bounds[0][0]=e,this.radius.bounds[1][0]=t},f.getDistanceLimits=function(e){var t=this.radius.bounds;return e?(e[0]=Math.exp(t[0][0]),e[1]=Math.exp(t[1][0]),e):[Math.exp(t[0][0]),Math.exp(t[1][0])]},f.toJSON=function(){return this.recalcMatrix(this.lastT()),{center:this.computedCenter.slice(),rotation:this.computedRotation.slice(),distance:Math.log(this.computedRadius[0]),zoomMin:this.radius.bounds[0][0],zoomMax:this.radius.bounds[1][0]}},f.fromJSON=function(e){var t=this.lastT(),n=e.center;n&&this.center.set(t,n[0],n[1],n[2]);var r=e.rotation;r&&this.rotation.set(t,r[0],r[1],r[2],r[3]);var i=e.distance;i&&i>0&&this.radius.set(t,Math.log(i)),this.setDistanceLimits(e.zoomMin,e.zoomMax)}},Z2ew:function(e,t,n){"use strict";t.a="\n////////////////////////////////////////////////////////////////////////////////\n// Assign Cells Compute shader\n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read_write> agentData : Agents;\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n  // Calculate which grid cell each agent is in and store it\n\n  let idx = GlobalInvocationID.x;\n  if (idx >= u32(sim_params.numAgents)){\n    return;\n  }\n\n  var agent = agentData.agents[idx];\n\n  let gridWidth = sim_params.gridWidth;\n  let gridHeight = sim_params.gridWidth;\n  let cellWidth = 1000.0 / gridWidth;\n\n  // get position relative to the start of the grid\n  // (world origin is at the center of the grid)\n  let pos = vec3<f32>(agent.x.x + (cellWidth * gridWidth / 2.0), \n                      agent.x.y, \n                      agent.x.z + (cellWidth * gridHeight / 2.0));\n  \n  var cell = vec2<i32>(i32(pos.x / cellWidth), i32(pos.z / cellWidth));\n\n  var cellID : i32;\n\n  // if outside grid, note that it's in an invalid cell\n  if (cell.x >= i32(gridWidth) || cell.y >= i32(gridHeight) ||\n      pos.x < 0.0 || pos.z < 0.0) {\n    cellID = -1; \n  }\n  else {\n    cellID = cell.x + i32(gridWidth) * cell.y;\n  }\n\n  agent.cell = cellID;\n\n  // Store the new agent value\n  agentData.agents[idx] = agent;\n}\n"},ZWaE:function(e,t,n){"use strict";n.r(t),t.default="export const platformVertexSize = 4 * 14; // Byte size of one cube vertex.\nexport const platformPositionOffset = 0;\nexport const platformColorOffset = 4 * 4; // Byte offset of cube vertex color attribute.\nexport const platformUVOffset = 4 * 8;\nexport const platformNorOffset = 4 * 10;\nexport const platformVertexCount = 36;\n\nlet platformHeight = 20.0;\nplatformHeight -= 2.0;\n\n// prettier-ignore\nexport const platformVertexArray = new Float32Array([\n  // float4 position, float4 color, float2 uv, float4 normal\n  1, -platformHeight, 1, 1,   1, 1, 1, 1,  -1, -1,  0, -1, 0, 0,\n  -1, -platformHeight, 1, 1,  1, 1, 1, 1,  -1, -1,  0, -1, 0, 0,\n  -1, -platformHeight, -1, 1, 1, 1, 1, 1,  -1, -1,  0, -1, 0, 0,\n  1, -platformHeight, -1, 1,  1, 0, 0, 1,  -1, -1,  0, -1, 0, 0,\n  1, -platformHeight, 1, 1,   1, 0, 1, 1,  -1, -1,  0, -1, 0, 0,\n  -1, -platformHeight, -1, 1, 0, 0, 0, 1,  -1, -1,  0, -1, 0, 0,\n\n  1, 2, 1, 1,                 1, 1, 1, 1,  0, 0,  0, 0, -1, 0,\n  1, -platformHeight, 1, 1,   1, 0, 1, 1,  0, 0,  0, 0, -1, 0,\n  1, -platformHeight, -1, 1,  1, 0, 0, 1,  0, 0,  0, 0, -1, 0,\n  1, 2, -1, 1,                1, 1, 0, 1,  0, 0,  0, 0, -1, 0,\n  1, 2, 1, 1,                 1, 1, 1, 1,  0, 0,  0, 0, -1, 0,\n  1, -platformHeight, -1, 1,  1, 0, 0, 1,  0, 0,  0, 0, -1, 0,\n\n  -1, 2, 1, 1,                0, 1, 1, 1,  1, 1,  0, 1, 0, 0,\n  1, 2, 1, 1,                 1, 1, 1, 1,  0, 1,  0, 1, 0, 0,\n  1, 2, -1, 1,                1, 1, 0, 1,  0, 0,  0, 1, 0, 0,\n  -1, 2, -1, 1,               0, 1, 0, 1,  1, 0,  0, 1, 0, 0,\n  -1, 2, 1, 1,                0, 1, 1, 1,  1, 1,  0, 1, 0, 0,\n  1, 2, -1, 1,                1, 1, 0, 1,  0, 0,  0, 1, 0, 0,\n\n  -1, -platformHeight, 1, 1,  0, 0, 1, 1,  0, 0,  0, 0, 1, 0,\n  -1, 2, 1, 1,                0, 1, 1, 1,  0, 0,  0, 0, 1, 0,\n  -1, 2, -1, 1,               0, 1, 0, 1,  0, 0,  0, 0, 1, 0,\n  -1, -platformHeight, -1, 1, 0, 0, 0, 1,  0, 0,  0, 0, 1, 0,\n  -1, -platformHeight, 1, 1,  0, 0, 1, 1,  0, 0,  0, 0, 1, 0,\n  -1, 2, -1, 1,               0, 1, 0, 1,  0, 0,  0, 0, 1, 0,\n\n  1, 2, 1, 1,                 1, 1, 1, 1,  0, 0,  -1, 0, 0, 0,\n  -1, 2, 1, 1,                0, 1, 1, 1,  0, 0,  -1, 0, 0, 0,\n  -1, -platformHeight, 1, 1,  0, 0, 1, 1,  0, 0,  -1, 0, 0, 0,\n  -1, -platformHeight, 1, 1,  0, 0, 1, 1,  0, 0,  -1, 0, 0, 0,\n  1, -platformHeight, 1, 1,   1, 0, 1, 1,  0, 0,  -1, 0, 0, 0,\n  1, 2, 1, 1,                 1, 1, 1, 1,  0, 0,  -1, 0, 0, 0,\n\n  1, -platformHeight, -1, 1,  1, 0, 0, 1,  0, 0,  1, 0, 0, 0,\n  -1, -platformHeight, -1, 1, 0, 0, 0, 1,  0, 0,  1, 0, 0, 0,\n  -1, 2, -1, 1,               0, 1, 0, 1,  0, 0,  1, 0, 0, 0,\n  1, 2, -1, 1,                1, 1, 0, 1,  0, 0,  1, 0, 0, 0,\n  1, -platformHeight, -1, 1,  1, 0, 0, 1,  0, 0,  1, 0, 0, 0,\n  -1, 2, -1, 1,               0, 1, 0, 1,  0, 0,  1, 0, 0, 0\n]);"},b1F2:function(e,t){e.exports=function(e,t,n){var r,i,a,o,s,u,c,l,d,f,h,p,m=n[0],g=n[1],v=n[2];t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=d,e[9]=f,e[10]=h,e[11]=p,e[12]=r*m+s*g+d*v+t[12],e[13]=i*m+u*g+f*v+t[13],e[14]=a*m+c*g+h*v+t[14],e[15]=o*m+l*g+p*v+t[15]);return e}},d3Ek:function(e,t,n){"use strict";n.d(t,"a",(function(){return oe})),n.d(t,"b",(function(){return se}));var r=n("1OyB"),i=n("rePB"),a=n("IOcx"),o=n("Womt");class s extends o.z{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new f(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new _(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new y(e)}))}load(e,t,n,r){const i=this;let a;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:o.A.extractUrlBase(e),this.manager.itemStart(e);const s=function(t){r?r(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},u=new o.j(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,(function(n){try{i.parse(n,a,(function(n){t(n),i.manager.itemEnd(e)}),s)}catch(r){s(r)}}),n,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const a={},s={};if("string"===typeof e)i=e;else{if(o.A.decodeText(new Uint8Array(e,0,4))===x){try{a[c.KHR_BINARY_GLTF]=new A(e)}catch(f){return void(r&&r(f))}i=a[c.KHR_BINARY_GLTF].content}else i=o.A.decodeText(new Uint8Array(e))}const u=JSON.parse(i);if(void 0===u.asset||u.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new ne(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let o=0;o<this.pluginCallbacks.length;o++){const e=this.pluginCallbacks[o](l);s[e.name]=e,a[e.name]=!0}if(u.extensionsUsed)for(let o=0;o<u.extensionsUsed.length;++o){const e=u.extensionsUsed[o],t=u.extensionsRequired||[];switch(e){case c.KHR_MATERIALS_UNLIT:a[e]=new d;break;case c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[e]=new C;break;case c.KHR_DRACO_MESH_COMPRESSION:a[e]=new S(u,this.dracoLoader);break;case c.KHR_TEXTURE_TRANSFORM:a[e]=new E;break;case c.KHR_MESH_QUANTIZATION:a[e]=new T;break;default:t.indexOf(e)>=0&&void 0===s[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(a),l.setPlugins(s),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise((function(r,i){n.parse(e,t,r,i)}))}}function u(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const c={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class l{constructor(e){this.parser=e,this.name=c.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const i=t.json,a=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let s;const u=new o.g(16777215);void 0!==a.color&&u.fromArray(a.color);const c=void 0!==a.range?a.range:0;switch(a.type){case"directional":s=new o.h(u),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new o.Q(u),s.distance=c;break;case"spot":s=new o.cb(u),s.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0,a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4,s.angle=a.spot.outerConeAngle,s.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return s.position.set(0,0,0),s.decay=2,void 0!==a.intensity&&(s.intensity=a.intensity),s.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(s),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))}}class d{constructor(){this.name=c.KHR_MATERIALS_UNLIT}getMaterialType(){return o.F}extendParams(e,t,n){const r=[];e.color=new o.g(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))}return Promise.all(r)}}class f{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){const e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new o.ib(e,e)}return Promise.all(i)}}class h{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new o.g(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&i.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture)),void 0!==a.sheenRoughnessTexture&&i.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class p{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class m{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&i.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;const s=a.attenuationColor||[1,1,1];return t.attenuationColor=new o.g(s[0],s[1],s[2]),Promise.all(i)}}class g{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=c.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?o.G:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[],a=r.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const s=a.specularColorFactor||[1,1,1];return t.specularColor=new o.g(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&i.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture).then((function(e){e.encoding=o.lb}))),Promise.all(i)}}class b{constructor(e){this.parser=e,this.name=c.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const i=r.extensions[this.name],a=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)}}class _{constructor(e){this.parser=e,this.name=c.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;const a=i.extensions[t],o=r.images[a.source];let s=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class y{constructor(e){this.name=c.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],r=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,i.ready]).then((function(t){const n=e.byteOffset||0,r=e.byteLength||0,a=e.count,o=e.byteStride,s=new ArrayBuffer(a*o),u=new Uint8Array(t[0],n,r);return i.decodeGltfBuffer(new Uint8Array(s),a,o,u,e.mode,e.filter),s}))}return null}}const x="glTF",w=1313821514,M=5130562;class A{constructor(e){this.name=c.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:o.A.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==x)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let i=0;for(;i<n;){const t=r.getUint32(i,!0);i+=4;const n=r.getUint32(i,!0);if(i+=4,n===w){const n=new Uint8Array(e,12+i,t);this.content=o.A.decodeText(n)}else if(n===M){const n=12+i;this.body=e.slice(n,n+t)}i+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class S{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=c.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},u={};for(const c in a){const e=z[c]||c.toLowerCase();o[e]=a[c]}for(const c in e.attributes){const t=z[c]||c.toLowerCase();if(void 0!==a[c]){const r=n.accessors[e.attributes[c]],i=V[r.componentType];u[t]=i,s[t]=!0===r.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],r=s[t];void 0!==r&&(n.normalized=r)}t(e)}),o,u)}))}))}}class E{constructor(){this.name=c.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class P extends o.H{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new o.g).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(const t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class C{constructor(){this.name=c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return P}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new o.g(1,1,1),e.opacity=1;const i=[];if(Array.isArray(r.diffuseFactor)){const t=r.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new o.g(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new o.g(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const t=r.specularGlossinessTexture;i.push(n.assignTexture(e,"glossinessMap",t)),i.push(n.assignTexture(e,"specularMap",t))}return Promise.all(i)}createMaterial(e){const t=new P(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=o.db,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class T{constructor(){this.name=c.KHR_MESH_QUANTIZATION}}class O extends o.p{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let a=0;a!==r;a++)t[a]=n[i+a];return t}}O.prototype.beforeStart_=O.prototype.copySampleValue_,O.prototype.afterEnd_=O.prototype.copySampleValue_,O.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,u=3*o,c=r-t,l=(n-t)/c,d=l*l,f=d*l,h=e*u,p=h-u,m=-2*f+3*d,g=f-d,v=1-m,b=g-d+l;for(let _=0;_!==o;_++){const e=a[p+_+o],t=a[p+_+s]*c,n=a[h+_+o],r=a[h+_]*c;i[_]=v*e+b*t+m*n+g*r}return i};const k=new o.U;class R extends O{interpolate_(e,t,n,r){const i=super.interpolate_(e,t,n,r);return k.fromArray(i).normalize().toArray(i),i}}const B=0,L=1,j=2,I=3,D=4,G=5,U=6,V={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F={9728:o.J,9729:o.w,9984:o.L,9985:o.y,9986:o.K,9987:o.x},N={33071:o.f,33648:o.I,10497:o.X},H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},q={CUBICSPLINE:void 0,LINEAR:o.r,STEP:o.q},K="OPAQUE",Y="MASK",X="BLEND";function J(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function Q(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Z(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $(e){const t=e.extensions&&e.extensions[c.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+ee(t.attributes):e.indices+":"+ee(e.attributes)+":"+e.mode,n}function ee(e){let t="";const n=Object.keys(e).sort();for(let r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function te(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class ne{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new u,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new o.m(this.options.manager):this.textureLoader=new o.fb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new o.j(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};J(i,a,r),Q(a,r),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let r=0,i=e.length;r<i;r++){const t=e[r];void 0!==t.mesh&&(this._addNodeRef(this.meshCache,t.mesh),void 0!==t.skin&&(n[t.mesh].isSkinnedMesh=!0)),void 0!==t.camera&&this._addNodeRef(this.cameraCache,t.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),i=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[r,a]of e.children.entries())i(a,t.children[r])};return i(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const i=e(t[r]);i&&n.push(i)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[c.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,i){n.load(o.A.resolveURL(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],a=H[r.type],s=V[r.componentType],u=s.BYTES_PER_ELEMENT,c=u*a,l=r.byteOffset||0,d=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;let h,p;if(d&&d!==c){const e=Math.floor(l/d),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let c=t.cache.get(n);c||(h=new s(i,e*d,r.count*d/u),c=new o.n(h,d/u),t.cache.add(n,c)),p=new o.o(c,a,l%d/u,f)}else h=null===i?new s(r.count*a):new s(i,l,r.count*a),p=new o.d(h,a,f);if(void 0!==r.sparse){const t=H.SCALAR,n=V[r.sparse.indices.componentType],u=r.sparse.indices.byteOffset||0,c=r.sparse.values.byteOffset||0,l=new n(e[1],u,r.sparse.count*t),d=new s(e[2],c,r.sparse.count*a);null!==i&&(p=new o.d(p.array.slice(),p.itemSize,p.normalized));for(let e=0,r=l.length;e<r;e++){const t=l[e];if(p.setX(t,d[e*a]),a>=2&&p.setY(t,d[e*a+1]),a>=3&&p.setZ(t,d[e*a+2]),a>=4&&p.setW(t,d[e*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e],i=t.images[r.source];let a=this.textureLoader;if(i.uri){const e=n.manager.getHandler(i.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,n){const r=this,i=this.json,a=this.options,s=i.textures[e],u=(t.uri||t.bufferView)+":"+s.sampler;if(this.textureCache[u])return this.textureCache[u];const c=self.URL||self.webkitURL;let l=t.uri||"",d=!1;if(void 0!==t.bufferView)l=r.getDependency("bufferView",t.bufferView).then((function(e){d=!0;const n=new Blob([e],{type:t.mimeType});return l=c.createObjectURL(n),l}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(l).then((function(e){return new Promise((function(t,r){let i=t;!0===n.isImageBitmapLoader&&(i=function(e){const n=new o.eb(e);n.needsUpdate=!0,t(n)}),n.load(o.A.resolveURL(e,a.path),i,void 0,r)}))})).then((function(t){!0===d&&c.revokeObjectURL(l),t.flipY=!1,s.name&&(t.name=s.name);const n=(i.samplers||{})[s.sampler]||{};return t.magFilter=F[n.magFilter]||o.w,t.minFilter=F[n.minFilter]||o.x,t.wrapS=N[n.wrapS]||o.X,t.wrapT=N[n.wrapT]||o.X,r.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null}));return this.textureCache[u]=f,f}assignTexture(e,t,n){const r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[c.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[c.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=r.associations.get(i);i=r.extensions[c.KHR_TEXTURE_TRANSFORM].extendTexture(i,e),r.associations.set(i,t)}}return e[t]=i,i}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new o.S,o.B.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new o.t,o.B.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(r||i||a){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),r&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),a&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return o.H}loadMaterial(e){const t=this,n=this.json,r=this.extensions,i=n.materials[e];let a;const s={},u=i.extensions||{},l=[];if(u[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=e.getMaterialType(),l.push(e.extendParams(s,i,t))}else if(u[c.KHR_MATERIALS_UNLIT]){const e=r[c.KHR_MATERIALS_UNLIT];a=e.getMaterialType(),l.push(e.extendParams(s,i,t))}else{const n=i.pbrMetallicRoughness||{};if(s.color=new o.g(1,1,1),s.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;s.color.fromArray(e),s.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(t.assignTexture(s,"map",n.baseColorTexture)),s.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,s.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(t.assignTexture(s,"metalnessMap",n.metallicRoughnessTexture)),l.push(t.assignTexture(s,"roughnessMap",n.metallicRoughnessTexture))),a=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===i.doubleSided&&(s.side=o.i);const d=i.alphaMode||K;if(d===X?(s.transparent=!0,s.depthWrite=!1):(s.format=o.W,s.transparent=!1,d===Y&&(s.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&a!==o.F&&(l.push(t.assignTexture(s,"normalMap",i.normalTexture)),s.normalScale=new o.ib(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;s.normalScale.set(e,e)}return void 0!==i.occlusionTexture&&a!==o.F&&(l.push(t.assignTexture(s,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(s.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&a!==o.F&&(s.emissive=(new o.g).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&a!==o.F&&l.push(t.assignTexture(s,"emissiveMap",i.emissiveTexture)),Promise.all(l).then((function(){let n;return n=a===P?r[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new a(s),i.name&&(n.name=i.name),n.map&&(n.map.encoding=o.lb),n.emissiveMap&&(n.emissiveMap.encoding=o.lb),Q(n,i),t.associations.set(n,{materials:e}),i.extensions&&J(r,n,i),n}))}createUniqueName(e){const t=o.T.sanitizeNodeName(e||"");let n=t;for(let r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function i(e){return n[c.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return ie(n,e,t)}))}const a=[];for(let s=0,u=e.length;s<u;s++){const n=e[s],u=$(n),l=r[u];if(l)a.push(l.promise);else{let e;e=n.extensions&&n.extensions[c.KHR_DRACO_MESH_COMPRESSION]?i(n):ie(new o.e,n,t),r[u]={primitive:n,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,r=this.extensions,i=n.meshes[e],a=i.primitives,s=[];for(let c=0,l=a.length;c<l;c++){const e=void 0===a[c].material?(void 0===(u=this.cache).DefaultMaterial&&(u.DefaultMaterial=new o.H({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:o.k})),u.DefaultMaterial):this.getDependency("material",a[c].material);s.push(e)}var u;return s.push(t.loadGeometries(a)),Promise.all(s).then((function(n){const s=n.slice(0,n.length-1),u=n[n.length-1],c=[];for(let d=0,f=u.length;d<f;d++){const n=u[d],l=a[d];let f;const h=s[d];if(l.mode===D||l.mode===G||l.mode===U||void 0===l.mode)f=!0===i.isSkinnedMesh?new o.Z(n,h):new o.E(n,h),!0!==f.isSkinnedMesh||f.geometry.attributes.skinWeight.normalized||f.normalizeSkinWeights(),l.mode===G?f.geometry=ae(f.geometry,o.hb):l.mode===U&&(f.geometry=ae(f.geometry,o.gb));else if(l.mode===L)f=new o.v(n,h);else if(l.mode===I)f=new o.s(n,h);else if(l.mode===j)f=new o.u(n,h);else{if(l.mode!==B)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);f=new o.R(n,h)}Object.keys(f.geometry.morphAttributes).length>0&&Z(f,i),f.name=t.createUniqueName(i.name||"mesh_"+e),Q(f,i),l.extensions&&J(r,f,l),t.assignFinalMaterial(f),c.push(f)}for(let r=0,i=c.length;r<i;r++)t.associations.set(c[r],{meshes:e,primitives:r});if(1===c.length)return c[0];const l=new o.l;t.associations.set(l,{meshes:e});for(let e=0,t=c.length;e<t;e++)l.add(c[e]);return l}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new o.P(o.C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new o.O(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Q(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],i=[],a=[],s=[];for(let o=0,u=t.channels.length;o<u;o++){const e=t.channels[o],u=t.samplers[e.sampler],c=e.target,l=void 0!==c.node?c.node:c.id,d=void 0!==t.parameters?t.parameters[u.input]:u.input,f=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",l)),r.push(this.getDependency("accessor",d)),i.push(this.getDependency("accessor",f)),a.push(u),s.push(c)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(s)]).then((function(n){const r=n[0],i=n[1],a=n[2],s=n[3],u=n[4],c=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],n=i[e],l=a[e],d=s[e],f=u[e];if(void 0===t)continue;let h;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,W[f.path]){case W.weights:h=o.M;break;case W.rotation:h=o.V;break;case W.position:case W.scale:default:h=o.kb}const p=t.name?t.name:t.uuid,m=void 0!==d.interpolation?q[d.interpolation]:o.r,g=[];W[f.path]===W.weights?t.traverse((function(e){e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(p);let v=l.array;if(l.normalized){const e=te(v.constructor),t=new Float32Array(v.length);for(let n=0,r=v.length;n<r;n++)t[n]=v[n]*e;v=t}for(let e=0,r=g.length;e<r;e++){const t=new h(g[e]+"."+W[f.path],n.array,v,m);"CUBICSPLINE"===d.interpolation&&(t.createInterpolant=function(e){return new(this instanceof o.V?R:O)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),c.push(t)}}const l=t.name?t.name:"animation_"+e;return new o.a(l,void 0,c)}))}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,r=this,i=t.nodes[e],a=i.name?r.createUniqueName(i.name):"";return function(){const t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==i.camera&&t.push(r.getDependency("camera",i.camera).then((function(e){return r._getNodeRef(r.cameraCache,i.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let s;if(s=!0===i.isBone?new o.b:t.length>1?new o.l:1===t.length?t[0]:new o.N,s!==t[0])for(let e=0,n=t.length;e<n;e++)s.add(t[e]);if(i.name&&(s.userData.name=i.name,s.name=a),Q(s,i),i.extensions&&J(n,s,i),void 0!==i.matrix){const e=new o.D;e.fromArray(i.matrix),s.applyMatrix4(e)}else void 0!==i.translation&&s.position.fromArray(i.translation),void 0!==i.rotation&&s.quaternion.fromArray(i.rotation),void 0!==i.scale&&s.scale.fromArray(i.scale);return r.associations.has(s)||r.associations.set(s,{}),r.associations.get(s).nodes=e,s}))}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],i=this,a=new o.l;r.name&&(a.name=i.createUniqueName(r.name)),Q(a,r),r.extensions&&J(n,a,r);const s=r.nodes||[],u=[];for(let o=0,c=s.length;o<c;o++)u.push(re(s[o],a,t,i));return Promise.all(u).then((function(){return i.associations=(e=>{const t=new Map;for(const[n,r]of i.associations)(n instanceof o.B||n instanceof o.eb)&&t.set(n,r);return e.traverse((e=>{const n=i.associations.get(e);null!=n&&t.set(e,n)})),t})(a),a}))}}function re(e,t,n,r){const i=n.nodes[e];return r.getDependency("node",e).then((function(e){if(void 0===i.skin)return e;let t;return r.getDependency("skin",i.skin).then((function(e){t=e;const n=[];for(let i=0,a=t.joints.length;i<a;i++)n.push(r.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const r=[],i=[];for(let a=0,s=n.length;a<s;a++){const e=n[a];if(e){r.push(e);const n=new o.D;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*a),i.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new o.Y(r,i),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const a=[];if(i.children){const t=i.children;for(let i=0,o=t.length;i<o;i++){const o=t[i];a.push(re(o,e,n,r))}}return Promise.all(a)}))}function ie(e,t,n){const r=t.attributes,i=[];function a(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(const o in r){const t=z[o]||o.toLowerCase();t in e.attributes||i.push(a(r[o],t))}if(void 0!==t.indices&&!e.index){const r=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(r)}return Q(e,t),function(e,t,n){const r=t.attributes,i=new o.c;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new o.jb(t[0],t[1],t[2]),new o.jb(a[0],a[1],a[2])),e.normalized){const t=te(V[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const a=t.targets;if(void 0!==a){const e=new o.jb,t=new o.jb;for(let r=0,i=a.length;r<i;r++){const i=a[r];if(void 0!==i.POSITION){const r=n.json.accessors[i.POSITION],a=r.min,o=r.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),r.normalized){const e=te(V[r.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const s=new o.ab;i.getCenter(s.center),s.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=s}(e,t,n),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,n){let r=!1,i=!1;for(let s=0,u=t.length;s<u;s++){const e=t[s];if(void 0!==e.POSITION&&(r=!0),void 0!==e.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(e);const a=[],o=[];for(let s=0,u=t.length;s<u;s++){const u=t[s];if(r){const t=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;a.push(t)}if(i){const t=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(a),Promise.all(o)]).then((function(t){const n=t[0],a=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function ae(e,t){let n=e.getIndex();if(null===n){const t=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,i=[];if(t===o.gb)for(let o=1;o<=r;o++)i.push(n.getX(0)),i.push(n.getX(o)),i.push(n.getX(o+1));else for(let o=0;o<r;o++)o%2===0?(i.push(n.getX(o)),i.push(n.getX(o+1)),i.push(n.getX(o+2))):(i.push(n.getX(o+2)),i.push(n.getX(o+1)),i.push(n.getX(o)));i.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(i),a}var oe=function e(t,n){Object(r.a)(this,e),Object(i.a)(this,"vertexArray",void 0),Object(i.a)(this,"vertexCount",void 0),Object(i.a)(this,"itemSize",void 0),Object(i.a)(this,"posOffset",void 0),Object(i.a)(this,"uvOffset",void 0),Object(i.a)(this,"normalOffset",void 0),Object(i.a)(this,"colorOffset",void 0),Object(i.a)(this,"scale",void 0),Object(i.a)(this,"rotation",void 0),this.vertexArray=new Float32Array(t),this.vertexCount=n,this.itemSize=52,this.posOffset=0,this.uvOffset=16,this.normalOffset=24,this.colorOffset=40,this.scale=0,this.rotation=a.a.create()};function se(e,t){var n=[];return new Promise((function(t,r){(new s).load(e,(function(e){var r=0,i=0;e.scene.traverse((function(e){if(e.isMesh){r+=e.geometry.index.count;for(var t=e.geometry.attributes.position.array,a=e.geometry.attributes.uv.array,o=e.geometry.attributes.normal.array,s=e.geometry.index.array,u=e.material.color,c=0;c<s.length;c++){var l=s[c];n[i+0]=t[3*l+0],n[i+1]=t[3*l+1],n[i+2]=t[3*l+2],n[i+3]=1,n[i+4]=a[2*l+0],n[i+5]=a[2*l+1],n[i+6]=o[3*l+0],n[i+7]=o[3*l+1],n[i+8]=o[3*l+2],n[i+9]=0,n[i+10]=u.r,n[i+11]=u.g,n[i+12]=u.b,i+=13}}}));var a=new oe(n,r);t(a)}))}))}},g4pe:function(e,t,n){e.exports=n("8Kt/")},"gY+q":function(e,t,n){"use strict";t.a="// ----- Parameteres -----\nlet eps : f32 = 0.0001;\nlet t0 : f32 = 20.0;           // paper = 20\nlet tObstacle : f32 = 20.0;\nlet k_longrange : f32 = 0.20;   // paper = 0.24 [0-1]\nlet k_obstacle : f32 = 0.24;\nlet k_shortrange : f32 = 1.0;   // paper = 1.0 [0,1]\nlet k_avoid : f32 = 0.2;\nlet avgCoefficient : f32 = 1.2; // paper = 1.2 [1,2]\nlet farRadius : f32 = 5.0;\nlet nearRadius : f32 = 2.5;\nlet mu_static : f32 = 0.21;     // paper = 0.21\nlet mu_kinematic : f32 = 0.15;  // papser = ?\nlet ksi : f32 = 0.0385;         // paper = 0.0385\nlet xsph_c : f32 = 7.0;         // paper = 7.0\nlet xsph_h : f32 = 217.0;        // paper = 217.0 // the smoothing distance specified in the paper (assumes particles with radius 1)\nlet dir_blending : f32 = 0.8; \nlet wall_radius : f32 = 0.5;  \n\nlet friction : bool = true;\n\n// ----- Struct -----\n[[block]] struct SimulationParams {\n  deltaTime : f32;\n  avoidance : f32;\n  numAgents : f32;\n  gridWidth : f32;\n  iteration : i32;\n};\n\nstruct Agent {\n  x  : vec3<f32>;  // position + radius\n  r  : f32;\n  c  : vec4<f32>;  // color\n  v  : vec3<f32>;  // velocity + inverse mass\n  w  : f32;\n  xp : vec3<f32>;  // planned/predicted position\n  speed : f32;\n  goal : vec3<f32>;\n  cell : i32;\n  dir : vec3<f32>;\n  group : f32;\n};\n\n[[block]] struct Agents {\n  agents : array<Agent>;\n};\n\nstruct CellIndices {\n  start : u32;\n  end   : u32;\n};\n\n[[block]] struct Grid {\n  cells : array<CellIndices>;\n};\n\nstruct Obstacle {\n  pos : vec3<f32>;\n  rot : f32;\n  scale : vec3<f32>;\n};\n\n[[block]] struct Obstacles {\n  obstacles : array<Obstacle>;\n};\n\n\nfn wall_constraint(agent: Agent, p0: vec2<f32>, p1: vec2<f32>, count: ptr<function, i32>, total_dx: ptr<function, vec3<f32>>) -> bool{\n  let xp = agent.xp.xz;\n  let a = xp - p0;\n  let b = p1 - p0;\n  let b_norm = normalize(b);\n  let l = dot(a, b_norm);\n\n  if(l < eps || l > length(b)) { return false; }\n\n  let c = l * b_norm;\n\n  let xj = p0 + c; \n  var n = a - c;\n  let d = length(n);\n\n  let r = agent.r + wall_radius;\n  let f = d - r;\n  if (f < 0.0)\n  {\n    n = normalize(n);\n    var dx = - f * n;\n    \n    *total_dx = *total_dx + vec3<f32>(dx.x, 0.0, dx.y);\n    *count = *count + 1;\n    return true;\n  }\n\n  return false;\n}\n\n\nfn obstacle_constraint(agent: Agent, obstacle: Obstacle, count: ptr<function, i32>, total_dx: ptr<function, vec3<f32>>) {\n  let c = cos(obstacle.rot);\n  let s = sin(obstacle.rot);\n  var m = mat4x4<f32>();\n  m[0] = vec4<f32>(obstacle.scale.x*c, 0.0, -obstacle.scale.x*s, 0.0);\n  m[1] = vec4<f32>(0.0, obstacle.scale.y, 0.0, 0.0);\n  m[2] = vec4<f32>(obstacle.scale.z*s, 0.0, obstacle.scale.z*c, 0.0);\n  m[3] = vec4<f32>(obstacle.pos, 1.0);\n\n  // Get Corner Points in World Position (Cube)\n  let l = 1.0;\n  var p1 = (m * vec4<f32>(l,0.0,l,1.0)).xz;\n  var p2 = (m * vec4<f32>(l,0.0,-l,1.0)).xz;\n  var p3 = (m * vec4<f32>(-l,0.0,-l,1.0)).xz;\n  var p4 = (m * vec4<f32>(-l,0.0,l,1.0)).xz;\n\n  wall_constraint(agent, p1, p2, count, total_dx);\n  wall_constraint(agent, p2, p3, count, total_dx);\n  wall_constraint(agent, p3, p4, count, total_dx);\n  wall_constraint(agent, p4, p1, count, total_dx);\n}"},gnl7:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return h}));var r,i=n("1OyB"),a=n("vuIU"),o=n("rePB"),s=n("IOcx"),u=45,c=.5,l=1.4,d=[(100*Math.random()-50+117)/255,4/255,(50*Math.random()-25+60)/255,1],f=[17/255,(50*Math.random()-25+113)/255,(200*Math.random()-100+128)/255,1];!function(e){e.PROXIMAL="proximal",e.BOTTLENECK="bottleneck",e.DENSE="dense",e.SPARSE="sparse",e.OBSTACLES="obstacles",e.CIRCLE="circle"}(r||(r={}));var h=function(){function e(t,n,r,a){Object(i.a)(this,e),Object(o.a)(this,"testScene",void 0),Object(o.a)(this,"numAgents",void 0),Object(o.a)(this,"numValidAgents",void 0),Object(o.a)(this,"numObstacles",void 0),Object(o.a)(this,"numGoals",void 0),Object(o.a)(this,"simulationUBOBufferSize",void 0),Object(o.a)(this,"agentInstanceSize",void 0),Object(o.a)(this,"agentPositionOffset",void 0),Object(o.a)(this,"agentColorOffset",void 0),Object(o.a)(this,"agentVelocityOffset",void 0),Object(o.a)(this,"cellInstanceSize",void 0),Object(o.a)(this,"obstacleInstanceSize",void 0),Object(o.a)(this,"obstaclePositionOffset",void 0),Object(o.a)(this,"device",void 0),Object(o.a)(this,"simulationUBOBuffer",void 0),Object(o.a)(this,"agents1Buffer",void 0),Object(o.a)(this,"agents2Buffer",void 0),Object(o.a)(this,"cellsBuffer",void 0),Object(o.a)(this,"goalsBuffer",void 0),Object(o.a)(this,"goalData",void 0),Object(o.a)(this,"obstaclesBuffer",void 0),Object(o.a)(this,"bindGroupLayout",void 0),Object(o.a)(this,"gridWidth",void 0),this.device=t,this.testScene=n,this.goalData=new Array,this.agentPositionOffset=0,this.agentColorOffset=16,this.agentVelocityOffset=80,this.numAgents=Math.pow(2,Math.ceil(Math.log2(r))),this.numValidAgents=r,this.numObstacles=1,this.numGoals=0,this.agentInstanceSize=96,this.obstacleInstanceSize=32,this.simulationUBOBufferSize=32,this.cellInstanceSize=16,this.gridWidth=a,this.initBuffers(),this.setBindGroupLayout()}return Object(a.a)(e,[{key:"initBuffers",value:function(){this.numAgents=Math.pow(2,Math.ceil(Math.log2(this.numValidAgents)));var e=new Float32Array(this.numAgents*this.agentInstanceSize/4),t=new Float32Array(this.numObstacles*this.obstacleInstanceSize/4);switch(this.testScene){case r.PROXIMAL:this.initProximal(e,t);break;case r.BOTTLENECK:this.initBottleneck(e,t);break;case r.DENSE:this.initDense(e,t);break;case r.SPARSE:this.initSparse(e,t);break;case r.OBSTACLES:this.initObstacles(e,t);break;case r.CIRCLE:this.initCircle(e,t)}var n=this.getGoalsArray();this.simulationUBOBuffer=this.device.createBuffer({size:this.simulationUBOBufferSize,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.agents1Buffer=this.device.createBuffer({size:this.numAgents*this.agentInstanceSize,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0}),new Float32Array(this.agents1Buffer.getMappedRange()).set(e),this.agents1Buffer.unmap(),this.agents2Buffer=this.device.createBuffer({size:this.numAgents*this.agentInstanceSize,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!1}),this.cellsBuffer=this.device.createBuffer({size:this.gridWidth*this.gridWidth*this.cellInstanceSize,usage:GPUBufferUsage.STORAGE,mappedAtCreation:!1}),this.obstaclesBuffer=this.device.createBuffer({size:this.numObstacles*this.obstacleInstanceSize,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0}),new Float32Array(this.obstaclesBuffer.getMappedRange()).set(t),this.obstaclesBuffer.unmap(),this.goalsBuffer=this.device.createBuffer({size:6*this.goalData.length*4,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0}),new Float32Array(this.goalsBuffer.getMappedRange()).set(n),this.goalsBuffer.unmap()}},{key:"writeSimParams",value:function(e){this.device.queue.writeBuffer(this.simulationUBOBuffer,0,new Float32Array([e.simulate?e.deltaTime:0,e.avoidance,this.numAgents,this.gridWidth]))}},{key:"setIteration",value:function(e){this.device.queue.writeBuffer(this.simulationUBOBuffer,16,new Int32Array([e]))}},{key:"getGoalsArray",value:function(){for(var e=[],t=0;t<this.goalData.length;t++)e[6*t+0]=this.goalData[t][0],e[6*t+1]=1,e[6*t+2]=this.goalData[t][1],e[6*t+3]=1,e[6*t+4]=1,e[6*t+5]=1;return this.numGoals=this.goalData.length,new Float32Array(e)}},{key:"setBindGroupLayout",value:function(){this.bindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]})}},{key:"getBindGroup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.device.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:{buffer:this.simulationUBOBuffer}},{binding:1,resource:{buffer:e?this.agents2Buffer:this.agents1Buffer,offset:0,size:this.numAgents*this.agentInstanceSize}},{binding:2,resource:{buffer:e?this.agents1Buffer:this.agents2Buffer,offset:0,size:this.numAgents*this.agentInstanceSize}},{binding:3,resource:{buffer:this.cellsBuffer,offset:0,size:this.gridWidth*this.gridWidth*this.cellInstanceSize}},{binding:4,resource:{buffer:this.obstaclesBuffer,offset:0,size:this.numObstacles*this.obstacleInstanceSize}}]});return t}},{key:"setObstacleData",value:function(e,t,n,r,i){var a=this.obstacleInstanceSize*t/4;e[a+0]=n[0],e[a+1]=c,e[a+2]=n[1],e[a+3]=r,e[a+4]=i[0],e[a+5]=1.5,e[a+6]=i[1]}},{key:"setAgentData",value:function(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=this.agentInstanceSize*t/4;e[u+0]=n[0],e[u+1]=c,e[u+2]=n[1],e[u+3]=.5,e[u+4]=r[0],e[u+5]=r[1],e[u+6]=r[2],e[u+7]=r[3],e[u+8]=i[0],e[u+9]=0,e[u+10]=i[1],e[u+11]=.5,e[u+15]=a,e[u+16]=o[0],e[u+17]=c,e[u+18]=o[1],e[u+20]=o[0]-n[0],e[u+21]=0,e[u+22]=o[1]-n[1],e[u+23]=s}},{key:"initProximal",value:function(e,t){for(var n=new Array,r=0;r<this.numAgents/2;++r){var i=Math.floor(r/10),a=r%10+5;i*=1.1,a*=1.1;this.setAgentData(e,2*r,[.15+i,a],d,[0,-.5],l,[0,-25],0),this.setAgentData(e,2*r+1,[-.15+i,-a],f,[0,.5],l,[0,25],1)}n.push(s.b.fromValues(0,-25)),n.push(s.b.fromValues(0,25)),this.goalData=n}},{key:"initBottleneck",value:function(e,t){for(var n=new Array,r=0;r<this.numAgents;++r){var i=r%10*1.5-8,a=1.1*Math.floor(r/10)+10;this.setAgentData(e,r,[.1+i,a],d,[0,-.5],l,[0,-45])}n.push(s.b.fromValues(0,-45)),this.goalData=n,this.setObstacleData(t,0,[23,-25],0,[20,20]),this.setObstacleData(t,1,[-23,-25],0,[20,20])}},{key:"initDense",value:function(e,t){for(var n=new Array,r=0;r<this.numAgents/2;++r){var i=r%200-100,a=Math.floor(r/200)+10;this.setAgentData(e,2*r,[.1+i,a],d,[0,-.5],l,[0,-95],0),this.setAgentData(e,2*r+1,[-.1+i,-a],f,[0,.5],l,[0,95],1)}n.push(s.b.fromValues(0,-95)),n.push(s.b.fromValues(0,95)),this.goalData=n}},{key:"initSparse",value:function(e,t){for(var n=new Array,r=0;r<this.numAgents/2;++r){var i=r%100*2-100,a=2*Math.floor(r/100)+10,o=Math.random()-.5+l;this.setAgentData(e,2*r,[.1+i,a],d,[0,-.5],o,[0,-95],0),this.setAgentData(e,2*r+1,[-.1+i,-a],f,[0,.5],o,[0,95],1)}n.push(s.b.fromValues(0,-95)),n.push(s.b.fromValues(0,95)),this.goalData=n}},{key:"initObstacles",value:function(e,t){for(var n=new Array,r=0;r<this.numAgents/2;++r){var i=r%100-50,a=Math.floor(r/100)+10;this.setAgentData(e,2*r,[.1+i,a],d,[0,-.5],l,[0,-45],0),this.setAgentData(e,2*r+1,[-.1+i,-a],f,[0,.5],l,[0,u],1)}for(var o=0;o<t.length;o++){var c=3*Math.random()+1,h=Math.random()*Math.PI;this.setObstacleData(t,o,[(Math.random()-.5)*u,0],h,[c,c])}n.push(s.b.fromValues(0,-45)),n.push(s.b.fromValues(0,u)),this.goalData=n}},{key:"initCircle",value:function(e,t){for(var n=new Array,r=.5*this.numAgents/Math.PI,i=0;i<this.numAgents;i++){var a=i/this.numAgents*2*Math.PI,o=r*Math.cos(a),u=r*Math.sin(a),c=[Math.random(),Math.random(),Math.random(),1],d=Math.random()-.5+l;this.setAgentData(e,i,[o,u],c,[0,0],d,[-o,-u],i),n.push(s.b.fromValues(-o,-u))}this.goalData=n}}]),e}()},hIuh:function(e,t,n){e.exports={canvasContainer:"SampleLayout_canvasContainer__1qkqt",sourceFileNav:"SampleLayout_sourceFileNav__2aMxK",sourceFileContainer:"SampleLayout_sourceFileContainer__3iiDM",updateSourceBtn:"SampleLayout_updateSourceBtn__3lOwr",title:"SampleLayout_title__1JL9n"}},hcEL:function(e,t,n){"use strict";n.r(t);var r=n("wqbC");t.default=r.a},"i+ZN":function(e,t){e.exports=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}},i5jP:function(e,t){var n={left:0,top:0};e.exports=function(e,t,r){t=t||e.currentTarget||e.srcElement,Array.isArray(r)||(r=[0,0]);var i=e.clientX||0,a=e.clientY||0,o=(s=t,s===window||s===document||s===document.body?n:s.getBoundingClientRect());var s;return r[0]=i-o.left,r[1]=a-o.top,r}},iZKT:function(e,t,n){"use strict";function r(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),a=Math.round(e.b),o=e.a,s=Math.round(e.h),u=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var l=e.hex.toString(16);l.length<6;)l="0"+l;return"#"+l}return"CSS_RGB"===n?"rgb("+r+","+i+","+a+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+a+","+o+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+a+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+a+","+o+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+",a:"+o+"}":"unknown format"}n.r(t),n.d(t,"color",(function(){return de})),n.d(t,"controllers",(function(){return fe})),n.d(t,"dom",(function(){return he})),n.d(t,"gui",(function(){return pe})),n.d(t,"GUI",(function(){return me}));var i=Array.prototype.forEach,a=Array.prototype.slice,o={BREAK:{},extend:function(e){return this.each(a.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(a.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=a.call(arguments);return function(){for(var t=a.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(i&&e.forEach&&e.forEach===i)e.forEach(t,n);else if(e.length===e.length+0){var r,a=void 0;for(a=0,r=e.length;a<r;a++)if(a in e&&t.call(n,e[a],a)===this.BREAK)return}else for(var o in e)if(t.call(n,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,a=arguments;function o(){r=null,n||e.apply(i,a)}var s=n||!r;clearTimeout(r),r=setTimeout(o,t),s&&e.apply(i,a)}},toArray:function(e){return e.toArray?e.toArray():a.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},s=[{litmus:o.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:r},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:r},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:r}}},{litmus:o.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:o.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:o.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(o.isNumber(e.r)&&o.isNumber(e.g)&&o.isNumber(e.b)&&o.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(o.isNumber(e.r)&&o.isNumber(e.g)&&o.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(o.isNumber(e.h)&&o.isNumber(e.s)&&o.isNumber(e.v)&&o.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(o.isNumber(e.h)&&o.isNumber(e.s)&&o.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],u=void 0,c=void 0,l=function(){c=!1;var e=arguments.length>1?o.toArray(arguments):arguments[0];return o.each(s,(function(t){if(t.litmus(e))return o.each(t.conversions,(function(t,n){if(u=t.read(e),!1===c&&!1!==u)return c=u,u.conversionName=n,u.conversion=t,o.BREAK})),o.BREAK})),c},d=void 0,f={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,a],[o,n,a],[a,n,s],[a,o,n],[s,a,n],[n,a,o]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),a=i-r,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/a:t===i?2+(n-e)/a:4+(e-t)/a,(o/=6)<0&&(o+=1),{h:360*o,s:a/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(d=8*t)|e&~(255<<d)}},h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0},v=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},b=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},_=function(){function e(){if(p(this,e),this.__state=l.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(e,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function y(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||_.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function x(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||_.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=f.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");o.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=f.rgb_to_hsv(e.r,e.g,e.b);o.extend(e.__state,{s:t.s,v:t.v}),o.isNaN(t.h)?o.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],y(_.prototype,"r",2),y(_.prototype,"g",1),y(_.prototype,"b",0),x(_.prototype,"h"),x(_.prototype,"s"),x(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var w=function(){function e(t,n){p(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return m(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),M={};o.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){o.each(e,(function(e){M[e]=t}))}));var A=/(\d+(\.\d+)?)px/;function S(e){if("0"===e||o.isUndefined(e))return 0;var t=e.match(A);return o.isNull(t)?0:parseFloat(t[1])}var E={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,i=t;o.isUndefined(i)&&(i=!0),o.isUndefined(r)&&(r=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var i=n||{},a=M[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var u=i.x||i.clientX||0,c=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,u,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;o.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0)}o.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),E},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),E},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return E},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return E},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return S(t["border-left-width"])+S(t["border-right-width"])+S(t["padding-left"])+S(t["padding-right"])+S(t.width)},getHeight:function(e){var t=getComputedStyle(e);return S(t["border-top-width"])+S(t["border-bottom-width"])+S(t["padding-top"])+S(t["padding-bottom"])+S(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},P=function(e){function t(e,n){p(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),E.bind(r.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return v(t,e),m(t,[{key:"setValue",value:function(e){var n=g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(w),C=function(e){function t(e,n,r){p(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r,s=i;if(i.__select=document.createElement("select"),o.isArray(a)){var u={};o.each(a,(function(e){u[e]=e})),a=u}return o.each(a,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)})),i.updateDisplay(),E.bind(i.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),i.domElement.appendChild(i.__select),i}return v(t,e),m(t,[{key:"setValue",value:function(e){var n=g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return E.isActive(this.__select)?this:(this.__select.value=this.getValue(),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(w),T=function(e){function t(e,n){p(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function a(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),E.bind(r.__input,"keyup",a),E.bind(r.__input,"change",a),E.bind(r.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),E.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(t,e),m(t,[{key:"updateDisplay",value:function(){return E.isActive(this.__input)||(this.__input.value=this.getValue()),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(w);function O(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var k=function(e){function t(e,n,r){p(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r||{};return i.__min=a.min,i.__max=a.max,i.__step=a.step,o.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=O(i.__impliedStep),i}return v(t,e),m(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=O(e),this}}]),t}(w);var R=function(e){function t(e,n,r){p(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.__truncationSuspended=!1;var a=i,s=void 0;function u(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function l(){E.unbind(window,"mousemove",c),E.unbind(window,"mouseup",l),u()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),E.bind(i.__input,"change",(function(){var e=parseFloat(a.__input.value);o.isNaN(e)||a.setValue(e)})),E.bind(i.__input,"blur",(function(){u()})),E.bind(i.__input,"mousedown",(function(e){E.bind(window,"mousemove",c),E.bind(window,"mouseup",l),s=e.clientY})),E.bind(i.__input,"keydown",(function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,u())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return v(t,e),m(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}(this.getValue(),this.__precision),g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k);function B(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var L=function(e){function t(e,n,r,i,a){p(this,t);var o=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:a})),s=o;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(B(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function c(){E.unbind(window,"mousemove",u),E.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function l(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(B(t,n.left,n.right,s.__min,s.__max))}function d(){E.unbind(window,"touchmove",l),E.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),E.bind(o.__background,"mousedown",(function(e){document.activeElement.blur(),E.bind(window,"mousemove",u),E.bind(window,"mouseup",c),u(e)})),E.bind(o.__background,"touchstart",(function(e){if(1!==e.touches.length)return;E.bind(window,"touchmove",l),E.bind(window,"touchend",d),l(e)})),E.addClass(o.__background,"slider"),E.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return v(t,e),m(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",g(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k),j=function(e){function t(e,n,r){p(this,t);var i=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,E.bind(i.__button,"click",(function(e){return e.preventDefault(),a.fire(),!1})),E.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return v(t,e),m(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(w),I=function(e){function t(e,n){p(this,t);var r=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new _(r.getValue()),r.__temp=new _(0);var i=r;r.domElement=document.createElement("div"),E.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",E.bind(r.__input,"keydown",(function(e){13===e.keyCode&&h.call(this)})),E.bind(r.__input,"blur",h),E.bind(r.__selector,"mousedown",(function(){E.addClass(this,"drag").bind(window,"mouseup",(function(){E.removeClass(i.__selector,"drag")}))})),E.bind(r.__selector,"touchstart",(function(){E.addClass(this,"drag").bind(window,"touchend",(function(){E.removeClass(i.__selector,"drag")}))}));var a,s=document.createElement("div");function u(e){g(e),E.bind(window,"mousemove",g),E.bind(window,"touchmove",g),E.bind(window,"mouseup",d),E.bind(window,"touchend",d)}function c(e){v(e),E.bind(window,"mousemove",v),E.bind(window,"touchmove",v),E.bind(window,"mouseup",f),E.bind(window,"touchend",f)}function d(){E.unbind(window,"mousemove",g),E.unbind(window,"touchmove",g),E.unbind(window,"mouseup",d),E.unbind(window,"touchend",d),m()}function f(){E.unbind(window,"mousemove",v),E.unbind(window,"touchmove",v),E.unbind(window,"mouseup",f),E.unbind(window,"touchend",f),m()}function h(){var e=l(this.value);!1!==e?(i.__color.__state=e,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function m(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function g(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,a=n.clientY,o=(r-t.left)/(t.right-t.left),s=1-(a-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),o>1?o=1:o<0&&(o=0),i.__color.v=s,i.__color.s=o,i.setValue(i.__color.toOriginal()),!1}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=i.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return o.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),o.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),o.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),o.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),o.extend(s.style,{width:"100%",height:"100%",background:"none"}),G(s,"top","rgba(0,0,0,0)","#000"),o.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=r.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),E.bind(r.__saturation_field,"mousedown",u),E.bind(r.__saturation_field,"touchstart",u),E.bind(r.__field_knob,"mousedown",u),E.bind(r.__field_knob,"touchstart",u),E.bind(r.__hue_field,"mousedown",c),E.bind(r.__hue_field,"touchstart",c),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return v(t,e),m(t,[{key:"updateDisplay",value:function(){var e=l(this.getValue());if(!1!==e){var t=!1;o.each(_.COMPONENTS,(function(n){if(!o.isUndefined(e[n])&&!o.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&o.extend(this.__color.__state,e)}o.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;o.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,G(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),o.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(w),D=["-moz-","-o-","-webkit-","-ms-",""];function G(e,t,n,r){e.style.background="",o.each(D,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var U=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(a){}},V='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',F=function(e,t){var n=e[t];return o.isArray(arguments[2])||o.isObject(arguments[2])?new C(e,t,arguments[2]):o.isNumber(n)?o.isNumber(arguments[2])&&o.isNumber(arguments[3])?o.isNumber(arguments[4])?new L(e,t,arguments[2],arguments[3],arguments[4]):new L(e,t,arguments[2],arguments[3]):o.isNumber(arguments[4])?new R(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new R(e,t,{min:arguments[2],max:arguments[3]}):o.isString(n)?new T(e,t):o.isFunction(n)?new j(e,t,""):o.isBoolean(n)?new P(e,t):null};var N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},H=function(){function e(){p(this,e),this.backgroundElement=document.createElement("div"),o.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),E.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),o.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;E.bind(this.backgroundElement,"click",(function(){t.hide()}))}return m(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),o.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",E.unbind(e.domElement,"webkitTransitionEnd",t),E.unbind(e.domElement,"transitionend",t),E.unbind(e.domElement,"oTransitionEnd",t)};E.bind(this.domElement,"webkitTransitionEnd",t),E.bind(this.domElement,"transitionend",t),E.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-E.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-E.getHeight(this.domElement)/2+"px"}}]),e}();U(function(e){if(e&&"undefined"!==typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var z="Default",W=function(){try{return!!window.localStorage}catch(e){return!1}}(),q=void 0,K=!0,Y=void 0,X=!1,J=[],Q=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),E.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=o.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=o.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),o.isUndefined(r.load)?r.load={preset:z}:r.preset&&(r.load.preset=r.preset),o.isUndefined(r.parent)&&r.hideable&&J.push(this),r.resizable=o.isUndefined(r.parent)&&r.resizable,r.autoPlace&&o.isUndefined(r.scrollable)&&(r.scrollable=!0);var i=W&&"true"===localStorage.getItem(re(this,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ue(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?E.addClass(n.__ul,e.CLASS_CLOSED):E.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(e){W&&(i=e,e?E.bind(window,"unload",a):E.unbind(window,"unload",a),localStorage.setItem(re(n,"isLocal"),e))}}}),o.isUndefined(r.parent)){if(this.closed=r.closed||!1,E.addClass(this.domElement,e.CLASS_MAIN),E.makeSelectable(this.domElement,!1),W&&i){n.useLocalStorage=!0;var u=localStorage.getItem(re(this,"gui"));u&&(r.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,E.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(E.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(E.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),E.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var c=document.createTextNode(r.name);E.addClass(c,"controller-name"),s=Z(n,c);E.addClass(this.__ul,e.CLASS_CLOSED),E.addClass(s,"title"),E.bind(s,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(o.isUndefined(r.parent)&&(K&&(Y=document.createElement("div"),E.addClass(Y,"dg"),E.addClass(Y,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Y),K=!1),Y.appendChild(this.domElement),E.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ue(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},E.bind(window,"resize",this.__resizeHandler),E.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),E.bind(this.__ul,"transitionend",this.__resizeHandler),E.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&se(this),a=function(){W&&"true"===localStorage.getItem(re(n,"isLocal"))&&localStorage.setItem(re(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,r.parent||function(){var e=n.getRoot();e.width+=1,o.defer((function(){e.width-=1}))}()};function Z(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function $(e){E.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&E.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ee(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function te(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var a=n.load.remembered,o=void 0;if(a[e.preset])o=a[e.preset];else{if(!a.Default)return;o=a.Default}if(o[r]&&void 0!==o[r][t.property]){var s=o[r][t.property];t.initialValue=s,t.setValue(s)}}}}function ne(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(r.color)i=new I(t,n);else{var a=[t,n].concat(r.factoryArgs);i=F.apply(e,a)}r.before instanceof w&&(r.before=r.before.__li),te(e,i),E.addClass(i.domElement,"c");var s=document.createElement("span");E.addClass(s,"property-name"),s.innerHTML=i.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(i.domElement);var c=Z(e,u,r.before);return E.addClass(c,Q.CLASS_CONTROLLER_ROW),i instanceof I?E.addClass(c,"color"):E.addClass(c,h(i.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,o.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),ne(e,n.object,n.property,{before:r,factoryArgs:[o.toArray(arguments)]})}if(o.isArray(t)||o.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),ne(e,n.object,n.property,{before:i,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof L){var r=new R(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});o.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}})),E.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof R){var i=function(t){if(o.isNumber(n.__min)&&o.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=ne(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(r),i&&a.listen(),a}return t};n.min=o.compose(i,n.min),n.max=o.compose(i,n.max)}else n instanceof P?(E.bind(t,"click",(function(){E.fakeEvent(n.__checkbox,"click")})),E.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof j?(E.bind(t,"click",(function(){E.fakeEvent(n.__button,"click")})),E.bind(t,"mouseover",(function(){E.addClass(n.__button,"hover")})),E.bind(t,"mouseout",(function(){E.removeClass(n.__button,"hover")}))):n instanceof I&&(E.addClass(t,"color"),n.updateDisplay=o.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=o.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&ee(e.getRoot(),!0),t}),n.setValue)}(e,c,i),e.__controllers.push(i),i}function re(e,t){return document.location.href+"."+t}function ie(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ae(e,t){t.style.display=e.useLocalStorage?"block":"none"}function oe(e){var t=e.__save_row=document.createElement("li");E.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),E.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",E.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",E.addClass(r,"button"),E.addClass(r,"save");var i=document.createElement("span");i.innerHTML="New",E.addClass(i,"button"),E.addClass(i,"save-as");var a=document.createElement("span");a.innerHTML="Revert",E.addClass(a,"button"),E.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?o.each(e.load.remembered,(function(t,n){ie(e,n,n===e.preset)})):ie(e,z,!1),E.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(i),t.appendChild(a),W){var u=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(re(0,"isLocal"))&&c.setAttribute("checked","checked"),ae(e,u),E.bind(c,"change",(function(){e.useLocalStorage=!e.useLocalStorage,ae(e,u)}))}var l=document.getElementById("dg-new-constructor");E.bind(l,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||q.hide()})),E.bind(n,"click",(function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),q.show(),l.focus(),l.select()})),E.bind(r,"click",(function(){e.save()})),E.bind(i,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),E.bind(a,"click",(function(){e.revert()}))}function se(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){E.removeClass(e.__closeButton,Q.CLASS_DRAG),E.unbind(window,"mousemove",n),E.unbind(window,"mouseup",r)}function i(i){return i.preventDefault(),t=i.clientX,E.addClass(e.__closeButton,Q.CLASS_DRAG),E.bind(window,"mousemove",n),E.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),o.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),E.bind(e.__resize_handle,"mousedown",i),E.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ue(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ce(e,t){var n={};return o.each(e.__rememberedObjects,(function(r,i){var a={},s=e.__rememberedObjectIndecesToControllers[i];o.each(s,(function(e,n){a[n]=t?e.initialValue:e.getValue()})),n[i]=a})),n}function le(e){0!==e.length&&N.call(window,(function(){le(e)})),o.each(e,(function(e){e.updateDisplay()}))}Q.toggleHide=function(){X=!X,o.each(J,(function(e){e.domElement.style.display=X?"none":""}))},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Q.toggleHide()},E.bind(window,"keydown",Q._keydownHandler,!1),o.extend(Q.prototype,{add:function(e,t){return ne(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return ne(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;o.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Y.removeChild(this.domElement);var e=this;o.each(this.__folders,(function(t){e.removeFolder(t)})),E.unbind(window,"keydown",Q._keydownHandler,!1),$(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Q(t);this.__folders[e]=n;var r=Z(this,n.domElement);return E.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],$(e);var t=this;o.each(e.__folders,(function(t){e.removeFolder(t)})),o.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=E.getOffset(e.__ul).top,n=0;o.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=E.getHeight(t))})),window.innerHeight-t-20<n?(E.addClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(E.removeClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&o.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:o.debounce((function(){this.onResize()}),50),remember:function(){if(o.isUndefined(q)&&((q=new H).domElement.innerHTML=V),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;o.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&oe(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ue(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ce(this)),e.folders={},o.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ce(this),ee(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=ce(this,!0)),this.load.remembered[e]=ce(this),this.preset=e,ie(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){o.each(this.__controllers,(function(t){this.getRoot().load.remembered?te(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),o.each(this.__folders,(function(e){e.revert(e)})),e||ee(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&le(this.__listening)},updateDisplay:function(){o.each(this.__controllers,(function(e){e.updateDisplay()})),o.each(this.__folders,(function(e){e.updateDisplay()}))}});var de={Color:_,math:f,interpret:l},fe={Controller:w,BooleanController:P,OptionController:C,StringController:T,NumberController:k,NumberControllerBox:R,NumberControllerSlider:L,FunctionController:j,ColorController:I},he={dom:E},pe={GUI:Q},me=Q,ge={color:de,controllers:fe,dom:he,gui:pe,GUI:me};t.default=ge},iyN4:function(e,t,n){var r=n("GwYZ"),i=n("vTHW"),a=n("8Zcn"),o=n("sckk"),s=n("P1cZ"),u=d(),c=d(),l=d();function d(){return{translate:f(),scale:f(1),skew:f(),perspective:[0,0,0,1],quaternion:[0,0,0,1]}}function f(e){return[e||0,e||0,e||0]}e.exports=function(e,t,n,d){if(0===o(t)||0===o(n))return!1;var f=a(t,u.translate,u.scale,u.skew,u.perspective,u.quaternion),h=a(n,c.translate,c.scale,c.skew,c.perspective,c.quaternion);return!(!f||!h)&&(r(l.translate,u.translate,c.translate,d),r(l.skew,u.skew,c.skew,d),r(l.scale,u.scale,c.scale,d),r(l.perspective,u.perspective,c.perspective,d),s(l.quaternion,u.quaternion,c.quaternion,d),i(e,l.translate,l.scale,l.skew,l.perspective,l.quaternion),!0)}},j5xS:function(e,t,n){"use strict";e.exports=function(e,t,n){switch(arguments.length){case 0:return new o([0],[0],0);case 1:return"number"===typeof e?new o(r=u(e),r,0):new o(e,u(e.length),0);case 2:if("number"===typeof t){var r=u(e.length);return new o(e,r,+t)}n=0;case 3:if(e.length!==t.length)throw new Error("state and velocity lengths must match");return new o(e,t,n)}};var r=n("08IH"),i=n("zHcz");function a(e,t,n){return Math.min(t,Math.max(e,n))}function o(e,t,n){this.dimension=e.length,this.bounds=[new Array(this.dimension),new Array(this.dimension)];for(var r=0;r<this.dimension;++r)this.bounds[0][r]=-1/0,this.bounds[1][r]=1/0;this._state=e.slice().reverse(),this._velocity=t.slice().reverse(),this._time=[n],this._scratch=[e.slice(),e.slice(),e.slice(),e.slice(),e.slice()]}var s=o.prototype;function u(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=0;return t}s.flush=function(e){var t=i.gt(this._time,e)-1;t<=0||(this._time.splice(0,t),this._state.splice(0,t*this.dimension),this._velocity.splice(0,t*this.dimension))},s.curve=function(e){var t=this._time,n=t.length,o=i.le(t,e),s=this._scratch[0],u=this._state,c=this._velocity,l=this.dimension,d=this.bounds;if(o<0)for(var f=l-1,h=0;h<l;++h,--f)s[h]=u[f];else if(o>=n-1){f=u.length-1;var p=e-t[n-1];for(h=0;h<l;++h,--f)s[h]=u[f]+p*c[f]}else{f=l*(o+1)-1;var m=t[o],g=t[o+1]-m||1,v=this._scratch[1],b=this._scratch[2],_=this._scratch[3],y=this._scratch[4],x=!0;for(h=0;h<l;++h,--f)v[h]=u[f],_[h]=c[f]*g,b[h]=u[f+l],y[h]=c[f+l]*g,x=x&&v[h]===b[h]&&_[h]===y[h]&&0===_[h];if(x)for(h=0;h<l;++h)s[h]=v[h];else r(v,_,b,y,(e-m)/g,s)}var w=d[0],M=d[1];for(h=0;h<l;++h)s[h]=a(w[h],M[h],s[h]);return s},s.dcurve=function(e){var t=this._time,n=t.length,a=i.le(t,e),o=this._scratch[0],s=this._state,u=this._velocity,c=this.dimension;if(a>=n-1)for(var l=s.length-1,d=(t[n-1],0);d<c;++d,--l)o[d]=u[l];else{l=c*(a+1)-1;var f=t[a],h=t[a+1]-f||1,p=this._scratch[1],m=this._scratch[2],g=this._scratch[3],v=this._scratch[4],b=!0;for(d=0;d<c;++d,--l)p[d]=s[l],g[d]=u[l]*h,m[d]=s[l+c],v[d]=u[l+c]*h,b=b&&p[d]===m[d]&&g[d]===v[d]&&0===g[d];if(b)for(d=0;d<c;++d)o[d]=0;else{r.derivative(p,g,m,v,(e-f)/h,o);for(d=0;d<c;++d)o[d]/=h}}return o},s.lastT=function(){var e=this._time;return e[e.length-1]},s.stable=function(){for(var e=this._velocity,t=e.length,n=this.dimension-1;n>=0;--n)if(e[--t])return!1;return!0},s.jump=function(e){var t=this.lastT(),n=this.dimension;if(!(e<t||arguments.length!==n+1)){var r=this._state,i=this._velocity,o=r.length-this.dimension,s=this.bounds,u=s[0],c=s[1];this._time.push(t,e);for(var l=0;l<2;++l)for(var d=0;d<n;++d)r.push(r[o++]),i.push(0);this._time.push(e);for(d=n;d>0;--d)r.push(a(u[d-1],c[d-1],arguments[d])),i.push(0)}},s.push=function(e){var t=this.lastT(),n=this.dimension;if(!(e<t||arguments.length!==n+1)){var r=this._state,i=this._velocity,o=r.length-this.dimension,s=e-t,u=this.bounds,c=u[0],l=u[1],d=s>1e-6?1/s:0;this._time.push(e);for(var f=n;f>0;--f){var h=a(c[f-1],l[f-1],arguments[f]);r.push(h),i.push((h-r[o++])*d)}}},s.set=function(e){var t=this.dimension;if(!(e<this.lastT()||arguments.length!==t+1)){var n=this._state,r=this._velocity,i=this.bounds,o=i[0],s=i[1];this._time.push(e);for(var u=t;u>0;--u)n.push(a(o[u-1],s[u-1],arguments[u])),r.push(0)}},s.move=function(e){var t=this.lastT(),n=this.dimension;if(!(e<=t||arguments.length!==n+1)){var r=this._state,i=this._velocity,o=r.length-this.dimension,s=this.bounds,u=s[0],c=s[1],l=e-t,d=l>1e-6?1/l:0;this._time.push(e);for(var f=n;f>0;--f){var h=arguments[f];r.push(a(u[f-1],c[f-1],r[o++]+h)),i.push(h*d)}}},s.idle=function(e){var t=this.lastT();if(!(e<t)){var n=this.dimension,r=this._state,i=this._velocity,o=r.length-n,s=this.bounds,u=s[0],c=s[1],l=e-t;this._time.push(e);for(var d=n-1;d>=0;--d)r.push(a(u[d],c[d],r[o]+l*i[o])),i.push(0),o+=1}}},jPIa:function(e,t,n){(function(t){e.exports=t.performance&&t.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}}).call(this,n("yLpj"))},"k0P+":function(e,t){e.exports=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],v=t[15],b=n*s-r*o,_=n*u-i*o,y=n*c-a*o,x=r*u-i*s,w=r*c-a*s,M=i*c-a*u,A=l*m-d*p,S=l*g-f*p,E=l*v-h*p,P=d*g-f*m,C=d*v-h*m,T=f*v-h*g,O=b*T-_*C+y*P+x*E-w*S+M*A;if(!O)return null;return O=1/O,e[0]=(s*T-u*C+c*P)*O,e[1]=(i*C-r*T-a*P)*O,e[2]=(m*M-g*w+v*x)*O,e[3]=(f*w-d*M-h*x)*O,e[4]=(u*E-o*T-c*S)*O,e[5]=(n*T-i*E+a*S)*O,e[6]=(g*y-p*M-v*_)*O,e[7]=(l*M-f*y+h*_)*O,e[8]=(o*C-s*E+c*A)*O,e[9]=(r*E-n*C-a*A)*O,e[10]=(p*w-m*y+v*b)*O,e[11]=(d*y-l*w-h*b)*O,e[12]=(s*S-o*P-u*A)*O,e[13]=(n*P-r*S+i*A)*O,e[14]=(m*_-p*x-g*b)*O,e[15]=(l*x-d*_+f*b)*O,e}},kTsV:function(e,t){e.exports=function(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a);return e}},kbhw:function(e,t,n){"use strict";e.exports=function(e,t){t||(t=e,e=window);var n=0,i=0,a=0,o={shift:!1,alt:!1,control:!1,meta:!1},s=!1;function u(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==o.alt,o.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==o.shift,o.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==o.control,o.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==o.meta,o.meta=!!e.metaKey),t}function c(e,s){var c=r.x(s),l=r.y(s);"buttons"in s&&(e=0|s.buttons),(e!==n||c!==i||l!==a||u(s))&&(n=0|e,i=c||0,a=l||0,t&&t(n,i,a,o))}function l(e){c(0,e)}function d(){(n||i||a||o.shift||o.alt||o.meta||o.control)&&(i=a=0,n=0,o.shift=o.alt=o.control=o.meta=!1,t&&t(0,0,0,o))}function f(e){u(e)&&t&&t(n,i,a,o)}function h(e){0===r.buttons(e)?c(0,e):c(n,e)}function p(e){c(n|r.buttons(e),e)}function m(e){c(n&~r.buttons(e),e)}function g(){s||(s=!0,e.addEventListener("mousemove",h),e.addEventListener("mousedown",p),e.addEventListener("mouseup",m),e.addEventListener("mouseleave",l),e.addEventListener("mouseenter",l),e.addEventListener("mouseout",l),e.addEventListener("mouseover",l),e.addEventListener("blur",d),e.addEventListener("keyup",f),e.addEventListener("keydown",f),e.addEventListener("keypress",f),e!==window&&(window.addEventListener("blur",d),window.addEventListener("keyup",f),window.addEventListener("keydown",f),window.addEventListener("keypress",f)))}g();var v={element:e};return Object.defineProperties(v,{enabled:{get:function(){return s},set:function(t){t?g():function(){if(!s)return;s=!1,e.removeEventListener("mousemove",h),e.removeEventListener("mousedown",p),e.removeEventListener("mouseup",m),e.removeEventListener("mouseleave",l),e.removeEventListener("mouseenter",l),e.removeEventListener("mouseout",l),e.removeEventListener("mouseover",l),e.removeEventListener("blur",d),e.removeEventListener("keyup",f),e.removeEventListener("keydown",f),e.removeEventListener("keypress",f),e!==window&&(window.removeEventListener("blur",d),window.removeEventListener("keyup",f),window.removeEventListener("keydown",f),window.removeEventListener("keypress",f))}()},enumerable:!0},buttons:{get:function(){return n},enumerable:!0},x:{get:function(){return i},enumerable:!0},y:{get:function(){return a},enumerable:!0},mods:{get:function(){return o},enumerable:!0}}),v};var r=n("XPkA")},mWlC:function(e,t){e.exports=function(e,t,n,r){var i,a,o,s,u,c,l,d,f,h,p,m,g,v,b,_,y,x,w,M,A,S,E,P,C=r[0],T=r[1],O=r[2],k=Math.sqrt(C*C+T*T+O*O);if(Math.abs(k)<1e-6)return null;C*=k=1/k,T*=k,O*=k,i=Math.sin(n),a=Math.cos(n),o=1-a,s=t[0],u=t[1],c=t[2],l=t[3],d=t[4],f=t[5],h=t[6],p=t[7],m=t[8],g=t[9],v=t[10],b=t[11],_=C*C*o+a,y=T*C*o+O*i,x=O*C*o-T*i,w=C*T*o-O*i,M=T*T*o+a,A=O*T*o+C*i,S=C*O*o+T*i,E=T*O*o-C*i,P=O*O*o+a,e[0]=s*_+d*y+m*x,e[1]=u*_+f*y+g*x,e[2]=c*_+h*y+v*x,e[3]=l*_+p*y+b*x,e[4]=s*w+d*M+m*A,e[5]=u*w+f*M+g*A,e[6]=c*w+h*M+v*A,e[7]=l*w+p*M+b*A,e[8]=s*S+d*E+m*P,e[9]=u*S+f*E+g*P,e[10]=c*S+h*E+v*P,e[11]=l*S+p*E+b*P,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e}},nD5K:function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// Build Hash Grid - figure out start/end indices of cells in sorted agent array\n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read_write> agentData : Agents;\n[[binding(3), group(0)]] var<storage, read_write> grid : Grid;\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n  // build Grid, an array of start/end indicies that indicate where\n  // each grid cell starts/ends on an array of agents sorted by cell\n\n  let idx = GlobalInvocationID.x;\n\n  if (idx >= u32(sim_params.numAgents) - 2u){\n    // the idx doesn't correspond to a valid agent\n    return;\n  }\n\n  // get the agent that corresponds to this index\n  var agentL = agentData.agents[idx];\n  var agentR = agentData.agents[idx + 1u];\n  \n  if (idx == 0u){\n    // if this is index 0, it has to be the start\n    // of the relevant cell\n    grid.cells[agentL.cell].start = idx;\n  }\n  if (idx == u32(sim_params.numAgents) - 1u){\n    // if this is the last index, it has to be the end\n    // of the relevant cell\n    grid.cells[agentR.cell].end = idx + 1u;\n  }\n\n  if (agentL.cell != agentR.cell){\n    // if the two contiguous agents have different\n    // cells, that means the left is the end of its block\n    // of cells and the right is the start of a new one.\n    // Note: searching this way, each cell's start or end\n    // is only edited by one thread, so we avoid race conditions.\n    if (agentL.cell != -1){\n      grid.cells[agentL.cell].end = idx;\n    }\n    if (agentR.cell != -1){\n      grid.cells[agentR.cell].start = idx + 1u;\n    }\n  }\n}\n"},nKJB:function(e,t){e.exports=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},o5ol:function(e,t,n){"use strict";e.exports=function(e,t,n,r,i,a,o,s,u,c){var l=t+a+c;if(d>0){var d=Math.sqrt(l+1);e[0]=.5*(o-u)/d,e[1]=.5*(s-r)/d,e[2]=.5*(n-a)/d,e[3]=.5*d}else{var f=Math.max(t,a,c);d=Math.sqrt(2*f-l+1);t>=f?(e[0]=.5*d,e[1]=.5*(i+n)/d,e[2]=.5*(s+r)/d,e[3]=.5*(o-u)/d):a>=f?(e[0]=.5*(n+i)/d,e[1]=.5*d,e[2]=.5*(u+o)/d,e[3]=.5*(s-r)/d):(e[0]=.5*(r+s)/d,e[1]=.5*(o+u)/d,e[2]=.5*d,e[3]=.5*(n-i)/d)}return e}},pd01:function(e,t,n){"use strict";var r=n("uU6E");e.exports=function(e,t,n){"function"===typeof e&&(n=!!t,t=e,e=window);var i=r("ex",e),a=function(e){n&&e.preventDefault();var r=e.deltaX||0,a=e.deltaY||0,o=e.deltaZ||0,s=1;switch(e.deltaMode){case 1:s=i;break;case 2:s=window.innerHeight}if(a*=s,o*=s,(r*=s)||a||o)return t(r,a,o,e)};return e.addEventListener("wheel",a),a}},rePB:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return r}))},sckk:function(e,t){e.exports=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],h=e[12],p=e[13],m=e[14],g=e[15];return(t*o-n*a)*(d*g-f*m)-(t*s-r*a)*(l*g-f*p)+(t*u-i*a)*(l*m-d*p)+(n*s-r*o)*(c*g-f*h)-(n*u-i*o)*(c*m-d*h)+(r*u-i*s)*(c*p-l*h)}},uU6E:function(e,t,n){"use strict";var r=n("TGkP");e.exports=s;var i=o("in",document.body);function a(e,t){var n=r(getComputedStyle(e).getPropertyValue(t));return n[0]*s(n[1],e)}function o(e,t){var n=document.createElement("div");n.style.height="128"+e,t.appendChild(n);var r=a(n,"height")/128;return t.removeChild(n),r}function s(e,t){if(!e)return null;switch(t=t||document.body,e=(e+""||"px").trim().toLowerCase(),t!==window&&t!==document||(t=document.body),e){case"%":return t.clientHeight/100;case"ch":case"ex":return o(e,t);case"em":return a(t,"font-size");case"rem":return a(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return i;case"cm":return i/2.54;case"mm":return i/25.4;case"pt":return i/72;case"pc":return i/6;case"px":return 1}var n=r(e);if(!isNaN(n[0])&&n[1]){var u=s(n[1],t);return"number"===typeof u?n[0]*u:null}return null}},vTHW:function(e,t,n){var r={identity:n("/sWY"),translate:n("b1F2"),multiply:n("FBcx"),create:n("3Mjd"),scale:n("nKJB"),fromRotationTranslation:n("4DRx")},i=(r.create(),r.create());e.exports=function(e,t,n,a,o,s){return r.identity(e),r.fromRotationTranslation(e,s,t),e[3]=o[0],e[7]=o[1],e[11]=o[2],e[15]=o[3],r.identity(i),0!==a[2]&&(i[9]=a[2],r.multiply(e,e,i)),0!==a[1]&&(i[9]=0,i[8]=a[1],r.multiply(e,e,i)),0!==a[0]&&(i[8]=0,i[4]=a[0],r.multiply(e,e,i)),r.scale(e,e,n),e}},vUjE:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n("1OyB"),i=n("vuIU"),a=n("rePB"),o=56,s=32;for(var u=new Float32Array([1,-18,1,1,1,1,1,1,-1,-1,0,-1,0,0,-1,-18,1,1,1,1,1,1,-1,-1,0,-1,0,0,-1,-18,-1,1,1,1,1,1,-1,-1,0,-1,0,0,1,-18,-1,1,1,0,0,1,-1,-1,0,-1,0,0,1,-18,1,1,1,0,1,1,-1,-1,0,-1,0,0,-1,-18,-1,1,0,0,0,1,-1,-1,0,-1,0,0,1,2,1,1,1,1,1,1,0,0,0,0,-1,0,1,-18,1,1,1,0,1,1,0,0,0,0,-1,0,1,-18,-1,1,1,0,0,1,0,0,0,0,-1,0,1,2,-1,1,1,1,0,1,0,0,0,0,-1,0,1,2,1,1,1,1,1,1,0,0,0,0,-1,0,1,-18,-1,1,1,0,0,1,0,0,0,0,-1,0,-1,2,1,1,0,1,1,1,1,1,0,1,0,0,1,2,1,1,1,1,1,1,0,1,0,1,0,0,1,2,-1,1,1,1,0,1,0,0,0,1,0,0,-1,2,-1,1,0,1,0,1,1,0,0,1,0,0,-1,2,1,1,0,1,1,1,1,1,0,1,0,0,1,2,-1,1,1,1,0,1,0,0,0,1,0,0,-1,-18,1,1,0,0,1,1,0,0,0,0,1,0,-1,2,1,1,0,1,1,1,0,0,0,0,1,0,-1,2,-1,1,0,1,0,1,0,0,0,0,1,0,-1,-18,-1,1,0,0,0,1,0,0,0,0,1,0,-1,-18,1,1,0,0,1,1,0,0,0,0,1,0,-1,2,-1,1,0,1,0,1,0,0,0,0,1,0,1,2,1,1,1,1,1,1,0,0,-1,0,0,0,-1,2,1,1,0,1,1,1,0,0,-1,0,0,0,-1,-18,1,1,0,0,1,1,0,0,-1,0,0,0,-1,-18,1,1,0,0,1,1,0,0,-1,0,0,0,1,-18,1,1,1,0,1,1,0,0,-1,0,0,0,1,2,1,1,1,1,1,1,0,0,-1,0,0,0,1,-18,-1,1,1,0,0,1,0,0,1,0,0,0,-1,-18,-1,1,0,0,0,1,0,0,1,0,0,0,-1,2,-1,1,0,1,0,1,0,0,1,0,0,0,1,2,-1,1,1,1,0,1,0,0,1,0,0,0,1,-18,-1,1,1,0,0,1,0,0,1,0,0,0,-1,2,-1,1,0,1,0,1,0,0,1,0,0,0]),c=n("1uVF"),l=n("7rvo"),d=n("0xYO"),f=new(n("Womt").bb)(1,16,16),h=f.attributes.position.array,p=f.attributes.normal.array,m=f.index.count,g=[],v=f.index.array,b=0;b<v.length;b++){var _=v[b];g[8*b+0]=h[3*_+0],g[8*b+1]=h[3*_+1],g[8*b+2]=h[3*_+2],g[8*b+3]=1,g[8*b+4]=p[3*_+0],g[8*b+5]=p[3*_+1],g[8*b+6]=p[3*_+2],g[8*b+7]=0}var y=function(){function e(t,n,i,o,s,u,c,l,d){Object(r.a)(this,e),Object(a.a)(this,"device",void 0),Object(a.a)(this,"platformVertexBuffer",void 0),Object(a.a)(this,"prototypeVertexBuffer",void 0),Object(a.a)(this,"obstacleVertexBuffer",void 0),Object(a.a)(this,"meshVertexBuffer",void 0),Object(a.a)(this,"goalVertBuffer",void 0),Object(a.a)(this,"platformPipeline",void 0),Object(a.a)(this,"crowdPipeline",void 0),Object(a.a)(this,"obstaclesPipeline",void 0),Object(a.a)(this,"goalPipeline",void 0),Object(a.a)(this,"commonUniformBuffer",void 0),Object(a.a)(this,"platformUniformBuffer",void 0),Object(a.a)(this,"crowdUniformBuffer",void 0),Object(a.a)(this,"obstaclesUniformBuffer",void 0),Object(a.a)(this,"goalUniformBuffer",void 0),Object(a.a)(this,"platformBindGroup",void 0),Object(a.a)(this,"crowdBindGroup",void 0),Object(a.a)(this,"obstaclesBindGroup",void 0),Object(a.a)(this,"goalBindGroup",void 0),Object(a.a)(this,"renderPassDescriptor",void 0),Object(a.a)(this,"mesh",void 0),this.device=t,this.mesh=u,this.initBuffers(n,d),this.buildPipelines(i,s),this.setBindGroups(c,l),this.setRenderPassDescriptor(o)}return Object(i.a)(e,[{key:"initBuffers",value:function(e,t){this.resizeGrid(e),this.goalVertBuffer=x(this.device,new Float32Array(g)),this.platformVertexBuffer=x(this.device,u),this.prototypeVertexBuffer=x(this.device,c.d),this.obstacleVertexBuffer=x(this.device,c.d),this.meshVertexBuffer=x(this.device,this.mesh.vertexArray)}},{key:"buildPipelines",value:function(e,t){this.platformPipeline=M(this.device,l.a,"vs_main","fs_platform",o,0,s,40,e,"triangle-list","back"),this.goalPipeline=A(this.device,l.a,"vs_goal","fs_goal",24,0,32,0,16,e,"line-list","none"),this.crowdPipeline=S(this.device,d.a,t.agentInstanceSize,t.agentPositionOffset,t.agentColorOffset,t.agentVelocityOffset,this.mesh.normalOffset,this.mesh.itemSize,this.mesh.posOffset,this.mesh.uvOffset,this.mesh.colorOffset,e),this.obstaclesPipeline=E(this.device,"////////////////////////////////////////////////////////////////////////////////\n// Obstacles Rendering\n////////////////////////////////////////////////////////////////////////////////\n\n////////////////////////////////////////////////////////////////////////////////\n// Vertex shader\n////////////////////////////////////////////////////////////////////////////////\n[[block]] struct RenderParams {\n  modelViewProjectionMatrix : mat4x4<f32>;\n};\n[[binding(0), group(0)]] var<uniform> render_params : RenderParams;\n\nstruct VertexInput {\n  [[location(0)]] position : vec3<f32>;  // obstacle position (world space)\n  [[location(1)]] rotation : f32;\n  [[location(2)]] scale    : vec3<f32>;\n  [[location(3)]] mesh_pos : vec4<f32>;  // mesh vertex position (model space)\n  [[location(4)]] mesh_uv  : vec2<f32>;  // mesh vertex uv\n  [[location(5)]] mesh_nor : vec4<f32>;\n};\n\nstruct VertexOutput {\n  [[builtin(position)]] position : vec4<f32>;\n  [[location(0)]]       color    : vec4<f32>;\n  [[location(1)]]       normal   : vec4<f32>;\n};\n\n[[stage(vertex)]]\nfn vs_main(in : VertexInput) -> VertexOutput {\n\n  let c = cos(in.rotation);\n  let s = sin(in.rotation);\n  var model = mat4x4<f32>();\n  model[0] = vec4<f32>(in.scale.x*c, 0.0, -in.scale.x*s, 0.0);\n  model[1] = vec4<f32>(0.0, in.scale.y, 0.0, 0.0);\n  model[2] = vec4<f32>(in.scale.z*s, 0.0, in.scale.z*c, 0.0);\n  model[3] = vec4<f32>(in.position, 1.0);\n\n  var rot = mat4x4<f32>();\n  rot[0] = vec4<f32>(c, 0.0, s, 0.0);\n  rot[1] = vec4<f32>(0.0, 1.0, 0.0, 0.0);\n  rot[2] = vec4<f32>(-s, 0.0, c, 0.0);\n  rot[3] = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n\n  var out : VertexOutput;  \n  out.position = render_params.modelViewProjectionMatrix * model * in.mesh_pos;\n  out.color = vec4<f32>(0.1);\n  out.normal = normalize(rot * in.mesh_nor);\n  return out;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Fragment shader\n////////////////////////////////////////////////////////////////////////////////\n[[stage(fragment)]]\nfn fs_main(in : VertexOutput) -> [[location(0)]] vec4<f32> {\n  var lightDir = vec4<f32>(-1.0, 0.5, -1.0, 0.0);\n  var lambertTerm = dot(normalize(lightDir), normalize(in.normal));\n  var lightColor = vec4<f32>(1.0, 1.0, 1.0, 1.0);\n  return vec4<f32>(0.8, 0.8, 0.8, 1.0) + lightColor * lambertTerm * 0.2;\n}\n",t.obstacleInstanceSize,0,c.f,c.b,c.c,c.a,e)}},{key:"setBindGroups",value:function(e,t){this.platformUniformBuffer=C(this.device,72),this.crowdUniformBuffer=C(this.device,80),this.obstaclesUniformBuffer=C(this.device,64),this.goalUniformBuffer=C(this.device,72),this.platformBindGroup=O(this.device,this.platformPipeline,this.platformUniformBuffer,e,t),this.crowdBindGroup=T(this.device,this.crowdPipeline,this.crowdUniformBuffer),this.obstaclesBindGroup=T(this.device,this.obstaclesPipeline,this.obstaclesUniformBuffer),this.goalBindGroup=T(this.device,this.goalPipeline,this.goalUniformBuffer)}},{key:"setRenderPassDescriptor",value:function(e){var t=P(this.device,e);this.renderPassDescriptor={colorAttachments:[{view:void 0,loadValue:{r:.89,g:.92,b:1,a:1},storeOp:"store"}],depthStencilAttachment:{view:t.createView(),depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}}}},{key:"resizeGrid",value:function(e){u[176]=e/100,u[177]=e/100,u[191]=e/100,u[218]=e/100,u[232]=e/100,u[233]=e/100,this.platformVertexBuffer=x(this.device,u)}},{key:"drawPlatform",value:function(e,t,n,r){var i=new Float32Array([r?1:0]);e.queue.writeBuffer(this.platformUniformBuffer,0,t.buffer,t.byteOffset,t.byteLength),e.queue.writeBuffer(this.platformUniformBuffer,t.byteLength,i),n.setPipeline(this.platformPipeline),n.setBindGroup(0,this.platformBindGroup),n.setVertexBuffer(0,this.platformVertexBuffer),n.draw(36,1,0,0)}},{key:"drawCrowd",value:function(e,t,n,r,i,a){e.queue.writeBuffer(this.crowdUniformBuffer,0,t.buffer,t.byteOffset,t.byteLength);var o=a;e.queue.writeBuffer(this.crowdUniformBuffer,t.byteLength,o),e.queue.writeBuffer(this.crowdUniformBuffer,t.byteLength+o.byteLength,new Float32Array([this.mesh.scale])),n.setPipeline(this.crowdPipeline),n.setBindGroup(0,this.crowdBindGroup),n.setVertexBuffer(0,r),n.setVertexBuffer(1,this.meshVertexBuffer),n.draw(this.mesh.vertexCount,i,0,0)}},{key:"drawObstacles",value:function(e,t,n,r,i){e.queue.writeBuffer(this.obstaclesUniformBuffer,0,t.buffer,t.byteOffset,t.byteLength),n.setPipeline(this.obstaclesPipeline),n.setBindGroup(0,this.obstaclesBindGroup),n.setVertexBuffer(0,r),n.setVertexBuffer(1,this.obstacleVertexBuffer),n.draw(c.e,i,0,0)}},{key:"drawGoals",value:function(e,t,n,r,i,a){e.queue.writeBuffer(this.goalUniformBuffer,0,t.buffer,t.byteOffset,t.byteLength),e.queue.writeBuffer(this.goalUniformBuffer,t.byteLength+4,new Float32Array([a])),n.setPipeline(this.goalPipeline),n.setBindGroup(0,this.goalBindGroup),n.setVertexBuffer(0,r),n.setVertexBuffer(1,this.goalVertBuffer),n.draw(m,i,0,0)}}]),e}(),x=function(e,t){var n=e.createBuffer({size:t.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});return new Float32Array(n.getMappedRange()).set(t),n.unmap(),n},w=function(e,t,n,r,i,a,o,s,u){return{vertex:{module:e.createShaderModule({code:t}),entryPoint:n,buffers:i},fragment:{module:e.createShaderModule({code:t}),entryPoint:r,targets:[{format:a}]},primitive:{topology:o,cullMode:s},depthStencil:{depthWriteEnabled:u,depthCompare:"less",format:"depth24plus"}}},M=function(e,t,n,r,i,a,o,s,u,c,l){var d=[{arrayStride:i,attributes:[{shaderLocation:0,offset:a,format:"float32x4"},{shaderLocation:1,offset:o,format:"float32x2"},{shaderLocation:2,offset:40,format:"float32x4"}]}];return e.createRenderPipeline(w(e,t,n,r,d,u,c,l,!0))},A=function(e,t,n,r,i,a,o,s,u,c,l,d){var f=[{arrayStride:i,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float32x4"}]},{arrayStride:o,attributes:[{shaderLocation:1,offset:s,format:"float32x4"},{shaderLocation:2,offset:u,format:"float32x4"}]}];return e.createRenderPipeline(w(e,t,n,r,f,c,l,"back",!1))},S=function(e,t,n,r,i,a,o,s,u,c,l,d){var f=w(e,t,"vs_main","fs_main",[{arrayStride:n,stepMode:"instance",attributes:[{shaderLocation:0,offset:r,format:"float32x3"},{shaderLocation:1,offset:i,format:"float32x4"},{shaderLocation:2,offset:a,format:"float32x3"}]},{arrayStride:s,attributes:[{shaderLocation:3,offset:u,format:"float32x4"},{shaderLocation:4,offset:c,format:"float32x2"},{shaderLocation:5,offset:o,format:"float32x4"},{shaderLocation:6,offset:l,format:"float32x3"}]}],d,"triangle-list","back",!0);return f.primitive.frontFace="cw",e.createRenderPipeline(f)},E=function(e,t,n,r,i,a,o,s,u){var c=[{arrayStride:n,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float32x3"},{shaderLocation:1,offset:12,format:"float32"},{shaderLocation:2,offset:16,format:"float32x3"}]},{arrayStride:i,attributes:[{shaderLocation:3,offset:a,format:"float32x4"},{shaderLocation:4,offset:o,format:"float32x2"},{shaderLocation:5,offset:s,format:"float32x4"}]}];return e.createRenderPipeline(w(e,t,"vs_main","fs_main",c,u,"triangle-list","back",!0))},P=function(e,t){return e.createTexture({size:t,format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT})},C=function(e,t){var n=t;return e.createBuffer({size:n,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})},T=function(e,t,n){return e.createBindGroup({layout:t.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}}]})},O=function(e,t,n,r,i){return e.createBindGroup({layout:t.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:n}},{binding:1,resource:i},{binding:2,resource:r.createView()}]})}},vuIU:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},wqbC:function(e,t,n){"use strict";(function(e,r){var i,a,o,s=n("o0o1"),u=n.n(s),c=n("HaE+"),l=n("IOcx"),d=n("8i9l"),f=n("4knM"),h=n("gnl7"),p=n("vUjE"),m=n("7rvo"),g=n("0xYO"),v=n("FOf1"),b=n("Z2ew"),_=n("nD5K"),y=n("zfDy"),x=n("83uV"),w=n("4NOg"),M=n("gY+q"),A=n("d3Ek"),S=n("WrN2"),E=n("1uVF");function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;(i=new f.a(l.c.fromValues(e,t,n),l.c.fromValues(0,0,0))).setAspectRatio(a),i.updateProjectionMatrix()}function C(e,t,n){return"\n  [[binding(1), group(0)]] var<storage, read_write> agentData : Agents;\n\n  fn swap(idx1 : u32, idx2 : u32) {\n    var tmp = agentData.agents[idx1];\n    agentData.agents[idx1] = agentData.agents[idx2];\n    agentData.agents[idx2] = tmp; \n  }\n\n  fn agentlt(idx1 : u32, idx2 : u32) -> bool {\n    return agentData.agents[idx1].cell < agentData.agents[idx2].cell;\n  }\n\n  fn agentgt(idx1 : u32, idx2 : u32) -> bool {\n    return agentData.agents[idx1].cell > agentData.agents[idx2].cell;\n  }\n\n  [[stage(compute), workgroup_size(256)]]\n  fn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n    let idx = GlobalInvocationID.x ;\n    \n    var j : u32 = ".concat(n,"u;\n    var k : u32 = ").concat(t,"u;\n    var l = idx ^ j; \n    if (l > idx){\n      if (  (idx & k) == 0u && agentgt(idx,l) || (idx & k) != 0u && agentlt(idx, l)){\n        swap(idx, l);\n      }\n    }\n  }").replace("/s+/g"," ").trim()}function T(e,t,n,r){n.length=0;for(var i=2;i<=t;i*=2)for(var a=i/2;a>0;a=Math.floor(a/2))n.push(e.createComputePipeline({layout:e.createPipelineLayout({bindGroupLayouts:[r.bindGroupLayout]}),compute:{module:e.createShaderModule({code:M.a+C(0,i,a)}),entryPoint:"main"}}))}var O=function(){var e=Object(c.a)(u.a.mark((function e(t){var r,s,c,d,m,g,C,O,k,R,B,L,j,I,D,G,U,V,F,N,H,z,W,q,K,Y,X,J,Q,Z,$,ee,te,ne,re,ie,ae,oe,se,ue,ce,le,de;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return de=function(){if(le++,c.begin(),r.current){if(m!=d.gridWidth&&(z.resizeGrid(d.gridWidth),o=!0,O.gridWidth=d.gridWidth,m=d.gridWidth),j!=L.model)if(X=!1,j=L.model,"Cube"==L.model){var e=new A.a(Array.from(E.d),E.e);e.scale=.2,z=new p.a(G,d.gridWidth,N,F,H,e,W,Y,O.showGoals),X=!0}else{var t=S.a[L.model];Object(A.b)(t.filename,G).then((function(e){e.scale=t.scale,z=new p.a(G,d.gridWidth,N,F,H,e,W,Y,O.showGoals),X=!0}))}if(i.update(),k!=O.numAgents){var n=Math.pow(2,Math.round(Math.log2(O.numAgents)));O.numAgents=n,k=O.numAgents,o=!0}if(R!=O.testScene){switch(R=O.testScene,O.testScene){case h.b.PROXIMAL:P(5,10,5),O.numAgents=64,H.numValidAgents=64,O.numObstacles=0,se=30,d.resetCamera=function(){return P(5,10,5)};break;case h.b.BOTTLENECK:P(20,20,20),O.numAgents=512,H.numValidAgents=512,O.numObstacles=2,se=70,d.resetCamera=function(){return P(50,50,50)};break;case h.b.DENSE:P(50,50,50),O.numAgents=32768,H.numValidAgents=32768,O.numObstacles=0,se=100,d.resetCamera=function(){return P(50,50,50)};break;case h.b.SPARSE:P(50,50,50),O.numAgents=4096,H.numValidAgents=4096,O.numObstacles=0,se=100,d.resetCamera=function(){return P(50,50,50)};break;case h.b.OBSTACLES:P(50,50,50),O.numAgents=1024,H.numValidAgents=1024,O.numObstacles=5,se=50,d.resetCamera=function(){return P(50,50,50)};break;case h.b.CIRCLE:P(5,20,5),O.numAgents=64,H.numValidAgents=64,O.numObstacles=0,se=20,d.resetCamera=function(){return P(5,20,5)}}o=!0}o&&(H.testScene=O.testScene,H.gridWidth=O.gridWidth,H.numObstacles=Math.max(O.numObstacles,1),H.initBuffers(),ae=H.getBindGroup(!1),oe=H.getBindGroup(!0),T(G,H.numAgents,te,H),o=!1);var a=G.createCommandEncoder(),s=ae;if(O.simulate){H.writeSimParams(O);for(var u=a.beginComputePass(),f=0;f<ee.length;f++)u.setPipeline(ee[f]),u.setBindGroup(0,s),u.dispatch(Math.ceil(H.numAgents/64));for(var g=0;g<te.length;g++)u.setPipeline(te[g]),u.setBindGroup(0,s),u.dispatch(Math.ceil(H.numAgents/256));for(var v=0;v<2;v++)u.setPipeline(ne[v]),u.setBindGroup(0,s),u.dispatch(Math.ceil(H.numAgents/64));u.endPass(),G.queue.submit([a.finish()]),s=oe;for(var b=0;b<6;b++)a=G.createCommandEncoder(),H.setIteration(b+1),(u=a.beginComputePass()).setPipeline(ne[2]),u.setBindGroup(0,s),u.dispatch(Math.ceil(H.numAgents/64)),u.endPass(),G.queue.submit([a.finish()]),s==ae?s=oe:s==oe&&(s=ae);u=(a=G.createCommandEncoder()).beginComputePass();for(var _=3;_<ne.length;_++)u.setPipeline(ne[_]),u.setBindGroup(0,s),u.dispatch(Math.ceil(H.numAgents/64));u.endPass(),G.queue.submit([a.finish()])}if(X){var y=G.createCommandEncoder(),x=ue();z.renderPassDescriptor.colorAttachments[0].view=U.getCurrentTexture().createView();var w=y.beginRenderPass(z.renderPassDescriptor);z.drawPlatform(G,x,w,d.gridOn);var M=ce(),C=l.c.fromValues(i.controls.eye[0],i.controls.eye[1],i.controls.eye[2]),B=s==oe?H.agents1Buffer:H.agents2Buffer;z.drawCrowd(G,M,w,B,H.numAgents,C),O.numObstacles>0&&z.drawObstacles(G,M,w,H.obstaclesBuffer,H.numObstacles),H.numGoals>0&&O.showGoals&&z.drawGoals(G,M,w,H.goalsBuffer,H.numGoals,le),w.endPass(),G.queue.submit([y.finish()])}requestAnimationFrame(de),c.end()}},ce=function(){var e=l.a.create();return l.a.multiply(e,i.projectionMatrix,i.viewMatrix),e},ue=function(){var e=l.a.create();l.a.identity(e),l.a.scale(e,e,l.c.fromValues(se,.1,se));var t=l.a.create();return l.a.multiply(t,i.viewMatrix,e),l.a.multiply(t,i.projectionMatrix,t),t},r=t.canvasRef,s=t.gui,c=t.stats,i=new f.a(l.c.fromValues(50,50,50),l.c.fromValues(0,0,0)),a=r.current.width/r.current.height,i.setAspectRatio(a),i.updateProjectionMatrix(),m=(d={gridWidth:200,resetCamera:P,gridOn:!0}).gridWidth,o=!0,(g=s.addFolder("Grid")).add(d,"gridWidth",1,5e3,1),g.add(d,"gridOn"),g.open(),(C=s.addFolder("Camera")).add(d,"resetCamera"),C.open(),O={simulate:!0,deltaTime:.02,numAgents:1024,numObstacles:1,showGoals:!0,avoidance:!1,gridWidth:d.gridWidth,testScene:h.b.PROXIMAL,resetSimulation:function(){o=!0}},k=O.numAgents,R=h.b.DENSE,(B=s.addFolder("Simulation")).add(O,"simulate"),B.add(O,"deltaTime",1e-4,1,1e-4),B.add(O,"numAgents",16,4e4,2).listen(),B.add(O,"showGoals"),B.add(O,"avoidance"),B.add(O,"testScene",Object.values(h.b)),B.add(O,"resetSimulation"),B.open(),L={model:"Duck"},j="Duck",(I=Array.from(Object.keys(S.a))).push("Cube"),s.add(L,"model",I),e.next=37,navigator.gpu.requestAdapter();case 37:return D=e.sent,e.next=40,D.requestDevice();case 40:if(G=e.sent,null!==r.current){e.next=43;break}return e.abrupt("return");case 43:return U=r.current.getContext("webgpu"),V=window.devicePixelRatio||1,F=[r.current.clientWidth*V,r.current.clientHeight*V],N=U.getPreferredFormat(D),U.configure({device:G,format:N,size:F}),H=new h.a(G,O.testScene,O.numAgents,O.gridWidth),(q=document.createElement("img")).src=n("UPBU"),e.next=53,q.decode();case 53:return e.next=55,createImageBitmap(q);case 55:for(K=e.sent,W=G.createTexture({size:[K.width,K.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),G.queue.copyExternalImageToTexture({source:K},{texture:W},[K.width,K.height]),Y=G.createSampler({magFilter:"linear",minFilter:"linear",addressModeU:"repeat",addressModeV:"repeat"}),X=!1,"Cube"==L.model?((J=new A.a(Array.from(E.d),E.e)).scale=.2,z=new p.a(G,d.gridWidth,N,F,H,J,W,Y,O.showGoals),X=!0):(Q=S.a[L.model],Object(A.b)(Q.filename,G).then((function(e){e.scale=Q.scale,z=new p.a(G,d.gridWidth,N,F,H,e,W,Y,O.showGoals),X=!0}))),Z=[M.a+v.a,M.a+b.a],$=[M.a+_.a,M.a+y.a,M.a+x.a,M.a+w.a],ee=[],te=[],ne=[],re=0;re<Z.length;re++)ee.push(G.createComputePipeline({layout:G.createPipelineLayout({bindGroupLayouts:[H.bindGroupLayout]}),compute:{module:G.createShaderModule({code:Z[re]}),entryPoint:"main"}}));for(T(G,H.numAgents,te,H),ie=0;ie<$.length;ie++)ne.push(G.createComputePipeline({layout:G.createPipelineLayout({bindGroupLayouts:[H.bindGroupLayout]}),compute:{module:G.createShaderModule({code:$[ie]}),entryPoint:"main"}}));ae=H.getBindGroup(!1),oe=H.getBindGroup(!0),se=50,le=0,requestAnimationFrame(de);case 74:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.a=function(){return Object(d.a)({name:"Crowd Simulation",description:"This is a WebGPU Crowd Simulation.",init:O,gui:!0,stats:!0,sources:[{name:e.substr(r.length+1),contents:"import { mat4, vec3, vec4 } from 'gl-matrix';\nimport { makeSample, SampleInit } from '../../components/SampleLayout';\nimport Camera from \"./Camera\";\n\nimport { TestScene, ComputeBufferManager } from './crowdUtils';\nimport { RenderBufferManager } from './renderUtils';\n\nimport renderWGSL from '../../shaders/background.render.wgsl';\nimport crowdWGSL from '../../shaders/crowd.render.wgsl';\nimport explicitIntegrationWGSL from '../../shaders/explicitIntegration.compute.wgsl';\nimport assignCellsWGSL from '../../shaders/assignCells.compute.wgsl';\nimport buildHashGrid from '../../shaders/buildHashGrid.compute.wgsl';\nimport contactSolveWGSL from '../../shaders/contactSolve.compute.wgsl';\nimport constraintSolveWGSL from '../../shaders/constraintSolve.compute.wgsl';\nimport finalizeVelocityWGSL from '../../shaders/finalizeVelocity.compute.wgsl';\nimport headerWGSL from '../../shaders/header.compute.wgsl';\n\nimport {loadModel, Mesh} from \"../../meshes/mesh\";\nimport { meshDictionary } from './meshDictionary';\nimport { cubeVertexArray, cubeVertexCount } from '../../meshes/cube';\n\nlet camera : Camera;\nlet aspect : number;\nlet resetSim : boolean;\n\n// Reset camera to original settings (gui function)\nfunction resetCameraFunc(x: number = 50, y: number = 50, z: number = 50) {\n  camera = new Camera(vec3.fromValues(x, y, z), vec3.fromValues(0, 0, 0));\n  camera.setAspectRatio(aspect);\n  camera.updateProjectionMatrix();\n}\n\nfunction getSortStepWGSL(numAgents : number, k : number, j : number, ){\n  // bitonic sort requires a device-wide join after every \"step\" to avoid\n  // race conditions. The least gross way I can think to do that is to create a new pipeline\n  // for each step.\n  const baseWGSL = `\n  [[binding(1), group(0)]] var<storage, read_write> agentData : Agents;\n\n  fn swap(idx1 : u32, idx2 : u32) {\n    var tmp = agentData.agents[idx1];\n    agentData.agents[idx1] = agentData.agents[idx2];\n    agentData.agents[idx2] = tmp; \n  }\n\n  fn agentlt(idx1 : u32, idx2 : u32) -> bool {\n    return agentData.agents[idx1].cell < agentData.agents[idx2].cell;\n  }\n\n  fn agentgt(idx1 : u32, idx2 : u32) -> bool {\n    return agentData.agents[idx1].cell > agentData.agents[idx2].cell;\n  }\n\n  [[stage(compute), workgroup_size(256)]]\n  fn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n    let idx = GlobalInvocationID.x ;\n    \n    var j : u32 = ${j}u;\n    var k : u32 = ${k}u;\n    var l = idx ^ j; \n    if (l > idx){\n      if (  (idx & k) == 0u && agentgt(idx,l) || (idx & k) != 0u && agentlt(idx, l)){\n        swap(idx, l);\n      }\n    }\n  }`;\n\n  // minify the wgsl\n  return baseWGSL.replace('/\\s+/g', ' ').trim();\n}\n\n\nfunction fillSortPipelineList(device,\n                              numAgents : number, \n                              computePipelinesSort,\n                              compBuffManager){\n\n    // be sure the list is empty before pushing new pipelines\n    computePipelinesSort.length = 0;\n\n    // set up sort pipelines\n    for (let k = 2; k <= numAgents; k *= 2){ // k is doubled every iteration\n      for (let j = k/2; j > 0; j = Math.floor(j/2)){ // j is halved at every iteration, with truncation of fractional parts\n        computePipelinesSort.push(\n          device.createComputePipeline({\n            layout: device.createPipelineLayout({\n                bindGroupLayouts: [compBuffManager.bindGroupLayout]\n            }),\n            compute: {\n              module: device.createShaderModule({\n                code: headerWGSL + getSortStepWGSL(numAgents, k, j),\n              }),\n              entryPoint: 'main',\n            },\n          })\n        );\n      }\n    }\n}\n\nconst init: SampleInit = async ({ canvasRef, gui, stats }) => {\n\n  ///////////////////////////////////////////////////////////////////////\n  //                       Camera Setup                                //\n  ///////////////////////////////////////////////////////////////////////\n\n  camera = new Camera(vec3.fromValues(50, 50, 50), vec3.fromValues(0, 0, 0));\n  aspect = canvasRef.current.width / canvasRef.current.height;\n  //console.log(document.body.clientWidth);\n  camera.setAspectRatio(aspect);\n  camera.updateProjectionMatrix();\n\n  ////////////////////////////////////////////////////////////////////////\n  //                        GUI Setup                                   //\n  ////////////////////////////////////////////////////////////////////////\n  \n  const guiParams = {\n    gridWidth: 200,\n    resetCamera: resetCameraFunc,\n    gridOn: true\n  };\n\n  let prevGridWidth = guiParams.gridWidth;\n  resetSim = true;\n\n  const gridFolder = gui.addFolder(\"Grid\");\n  gridFolder.add(guiParams, 'gridWidth', 1, 5000, 1);\n  gridFolder.add(guiParams, 'gridOn');\n  gridFolder.open();\n  const camFolder = gui.addFolder(\"Camera\");\n  camFolder.add(guiParams, 'resetCamera');\n  camFolder.open();\n\n  const simulationParams = {\n    simulate: true,\n    deltaTime: 0.02,\n    numAgents: 1024,\n    numObstacles : 1,\n    showGoals: true,\n    avoidance: false,\n    gridWidth: guiParams.gridWidth,\n    testScene: TestScene.PROXIMAL,\n    resetSimulation: () => { resetSim = true; }\n  };\n\n  let prevNumAgents = simulationParams.numAgents;\n  let prevTestScene = TestScene.DENSE;\n  \n  const simFolder = gui.addFolder(\"Simulation\");\n  simFolder.add(simulationParams, 'simulate');\n  simFolder.add(simulationParams, 'deltaTime', 0.0001, 1.0, 0.0001);\n  simFolder.add(simulationParams, 'numAgents', 16, 40000, 2).listen();  // max 40,000 so that it's easier to change values\n  simFolder.add(simulationParams, 'showGoals');\n  simFolder.add(simulationParams, 'avoidance');\n  simFolder.add(simulationParams, 'testScene', Object.values(TestScene));\n  simFolder.add(simulationParams, 'resetSimulation');\n  simFolder.open();\n\n  const modelParams = {\n    model: 'Duck'\n  }\n  let prevModel = 'Duck';\n  const models = Array.from(Object.keys(meshDictionary));\n  models.push('Cube');\n  gui.add(modelParams, 'model', models);\n\n\n  /////////////////////////////////////////////////////////////////////////\n  //                     Initial Context Setup                           //\n  /////////////////////////////////////////////////////////////////////////\n\n  const adapter = await navigator.gpu.requestAdapter();\n  const device = await adapter.requestDevice();\n\n  if (canvasRef.current === null) return;\n  const context = canvasRef.current.getContext('webgpu');\n\n  const devicePixelRatio = window.devicePixelRatio || 1;\n  const presentationSize = [\n    canvasRef.current.clientWidth * devicePixelRatio,\n    canvasRef.current.clientHeight * devicePixelRatio,\n  ];\n  const presentationFormat = context.getPreferredFormat(adapter);\n\n  context.configure({\n    device,\n    format: presentationFormat,\n    size: presentationSize,\n  });\n\n  /////////////////////////////////////////////////////////////////////////\n  //                     Compute Buffer Setup                            //\n  /////////////////////////////////////////////////////////////////////////\n  const compBuffManager = new ComputeBufferManager(device,\n                                                 simulationParams.testScene,\n                                                 simulationParams.numAgents,\n                                                 simulationParams.gridWidth);\n\n  //////////////////////////////////////////////////////////////////////////\n  //                Render Buffer and Pipeline Setup                      //\n  //////////////////////////////////////////////////////////////////////////\n  let renderBuffManager : RenderBufferManager;\n\n  let gridTexture: GPUTexture;\n  {\n    const img = document.createElement('img');\n    img.src = require('../../../assets/img/grid.png');\n    await img.decode();\n    const imageBitmap = await createImageBitmap(img);\n\n    gridTexture = device.createTexture({\n      size: [imageBitmap.width, imageBitmap.height, 1],\n      format: 'rgba8unorm',\n      usage:\n        GPUTextureUsage.TEXTURE_BINDING |\n        GPUTextureUsage.COPY_DST |\n        GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    device.queue.copyExternalImageToTexture(\n      { source: imageBitmap },\n      { texture: gridTexture },\n      [imageBitmap.width, imageBitmap.height]\n    );\n  }\n  // Create a sampler with linear filtering for smooth interpolation.\n  const sampler = device.createSampler({\n    magFilter: 'linear',\n    minFilter: 'linear',\n    addressModeU: 'repeat', // make grid texture tileable so it's resizable\n    addressModeV: 'repeat'\n  });\n\n  let bufManagerExists = false;\n  if (modelParams.model == 'Cube'){\n    const mesh = new Mesh(Array.from(cubeVertexArray), cubeVertexCount);\n    mesh.scale = 0.2;\n    renderBuffManager = new RenderBufferManager(device, guiParams.gridWidth, \n      presentationFormat, presentationSize,\n      compBuffManager, mesh, gridTexture, sampler, simulationParams.showGoals);\n    bufManagerExists = true;\n  }\n  else{\n    const modelData = meshDictionary[modelParams.model];\n    loadModel(modelData.filename, device).then((mesh : Mesh) => {\n      mesh.scale = modelData.scale;\n      renderBuffManager = new RenderBufferManager(device, guiParams.gridWidth, \n        presentationFormat, presentationSize,\n        compBuffManager, mesh, gridTexture, sampler, simulationParams.showGoals);\n      \n      bufManagerExists = true;\n    });\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Create Compute Pipelines\n  //////////////////////////////////////////////////////////////////////////////\n  {\n    const computeShadersPreSort = [\n      headerWGSL + explicitIntegrationWGSL, \n      headerWGSL + assignCellsWGSL,\n    ];\n    const computeShadersPostSort = [\n      headerWGSL + buildHashGrid,\n      headerWGSL + contactSolveWGSL, \n      headerWGSL + constraintSolveWGSL, \n      headerWGSL + finalizeVelocityWGSL\n    ];\n    var computePipelinesPreSort = [];\n    var computePipelinesSort = [];\n    var computePipelinesPostSort = [];\n\n    // set up pre-sort pipelines\n    for(let i = 0; i < computeShadersPreSort.length; i++){\n      computePipelinesPreSort.push( \n          device.createComputePipeline({\n          layout: device.createPipelineLayout({\n              bindGroupLayouts: [compBuffManager.bindGroupLayout]\n          }),\n          compute: {\n            module: device.createShaderModule({\n              code: computeShadersPreSort[i],\n            }),\n            entryPoint: 'main',\n          },\n        })\n      );\n    }\n\n    // set up sort pipelines\n    fillSortPipelineList(device, \n                         compBuffManager.numAgents, \n                         computePipelinesSort, \n                         compBuffManager);\n\n    // set up post sort pipelines\n    for(let i = 0; i < computeShadersPostSort.length; i++){\n      computePipelinesPostSort.push( \n          device.createComputePipeline({\n          layout: device.createPipelineLayout({\n              bindGroupLayouts: [compBuffManager.bindGroupLayout]\n          }),\n          compute: {\n            module: device.createShaderModule({\n              code: computeShadersPostSort[i],\n            }),\n            entryPoint: 'main',\n          },\n        })\n      );\n    }\n  }\n\n  // get compute bind group\n  var computeBindGroup1 = compBuffManager.getBindGroup(false);\n  var computeBindGroup2 = compBuffManager.getBindGroup(true);\n\n  var platformWidth = 50;\n\n  function getTransformationMatrix() {\n    const modelMatrix = mat4.create();\n    mat4.identity(modelMatrix);\n    mat4.scale(modelMatrix, modelMatrix, vec3.fromValues(platformWidth, 0.1, platformWidth));\n\n    const modelViewProjectionMatrix = mat4.create();\n    mat4.multiply(modelViewProjectionMatrix, camera.viewMatrix, modelMatrix);\n    mat4.multiply(modelViewProjectionMatrix, camera.projectionMatrix, modelViewProjectionMatrix);\n    return modelViewProjectionMatrix as Float32Array;\n  }\n\n  function getViewProjection() {\n    const modelViewProjectionMatrix = mat4.create();\n\n    mat4.multiply(modelViewProjectionMatrix, camera.projectionMatrix, camera.viewMatrix);\n    return modelViewProjectionMatrix as Float32Array;\n  }\n  \n  var time = 0;\n  \n  function frame() {\n    time++;\n    stats.begin();\n    // Sample is no longer the active page.\n    if (!canvasRef.current) return;\n\n    // Compute new grid lines if there's a change in the gui\n    if (prevGridWidth != guiParams.gridWidth) {\n      renderBuffManager.resizeGrid(guiParams.gridWidth);\n      resetSim = true;\n      simulationParams.gridWidth = guiParams.gridWidth;\n      prevGridWidth = guiParams.gridWidth;\n    }\n\n    if (prevModel != modelParams.model) {\n      bufManagerExists = false;\n      prevModel = modelParams.model;\n      if (modelParams.model == 'Cube'){\n        const mesh = new Mesh(Array.from(cubeVertexArray), cubeVertexCount);\n        mesh.scale = 0.2;\n        renderBuffManager = new RenderBufferManager(device, guiParams.gridWidth, \n          presentationFormat, presentationSize,\n          compBuffManager, mesh, gridTexture, sampler, simulationParams.showGoals);\n        bufManagerExists = true;\n      } else {\n      var modelData = meshDictionary[modelParams.model];\n      loadModel(modelData.filename, device).then((mesh : Mesh) => {\n        mesh.scale = modelData.scale;\n        renderBuffManager = new RenderBufferManager(device, guiParams.gridWidth, \n          presentationFormat, presentationSize,\n          compBuffManager, mesh, gridTexture, sampler, simulationParams.showGoals);\n    \n        bufManagerExists = true;\n      });\n    }\n    }\n\n    camera.update();\n\n    //------------------ Compute Calls ------------------------ //\n    {\n      if (prevNumAgents != simulationParams.numAgents) {\n        // if test scene is proximal, user can change num agents\n        //if (simulationParams.testScene == TestScene.PROXIMAL){\n          // round numAgents so that it is an exponent of 2 (hash grid requires this)\n          let pow2Agents = Math.pow(2, Math.round(Math.log2(simulationParams.numAgents)));\n          simulationParams.numAgents = pow2Agents;\n          // NOTE: we also reset the sim if the grid width changes\n          // which is checked just above this\n          prevNumAgents = simulationParams.numAgents;\n          // tell compute buffer manager we have a dif number of agents\n          //compBuffManager.numValidAgents = simulationParams.numAgents;\n          // set reset sim to true so that simulation starts over\n          // and agents are redistributed\n          resetSim = true;\n        //}\n      }\n\n      if (prevTestScene != simulationParams.testScene) {\n        prevTestScene = simulationParams.testScene;\n        switch(simulationParams.testScene) {\n          case TestScene.PROXIMAL:\n            resetCameraFunc(5,10,5);\n            simulationParams.numAgents = 1<<6;\n            compBuffManager.numValidAgents = 1<<6;\n            simulationParams.numObstacles = 0;\n            platformWidth = 30;\n            guiParams.resetCamera = () => resetCameraFunc(5, 10, 5);\n            break;\n          case TestScene.BOTTLENECK:\n            resetCameraFunc(20,20,20);\n            simulationParams.numAgents = 1<<9;\n            compBuffManager.numValidAgents = 1<<9;\n            simulationParams.numObstacles = 2;\n            platformWidth = 70;\n            guiParams.resetCamera = () => resetCameraFunc(50, 50, 50);\n            break;\n          case TestScene.DENSE:\n            resetCameraFunc(50,50,50);\n            simulationParams.numAgents = 1<<15;\n            compBuffManager.numValidAgents = 1<<15;\n            simulationParams.numObstacles = 0;\n            platformWidth = 100;\n            guiParams.resetCamera = () => resetCameraFunc(50, 50, 50);\n            break;\n          case TestScene.SPARSE:\n            resetCameraFunc(50,50,50);\n            simulationParams.numAgents = 1<<12;\n            compBuffManager.numValidAgents = 1<<12;\n            simulationParams.numObstacles = 0;\n            platformWidth = 100;\n            guiParams.resetCamera = () => resetCameraFunc(50, 50, 50);\n            break;\n          case TestScene.OBSTACLES:\n            resetCameraFunc(50,50,50);\n            simulationParams.numAgents = 1<<10;\n            compBuffManager.numValidAgents = 1<<10;\n            simulationParams.numObstacles = 5;\n            platformWidth = 50;\n            guiParams.resetCamera = () => resetCameraFunc(50, 50, 50);\n            break;\n          case TestScene.CIRCLE:\n            resetCameraFunc(5,20,5);\n            simulationParams.numAgents = 1<<6;\n            compBuffManager.numValidAgents = 1<<6;\n            simulationParams.numObstacles = 0;\n            platformWidth = 20;\n            guiParams.resetCamera = () => resetCameraFunc(5, 20, 5);\n            break;\n        }\n        resetSim = true;\n      }\n\n      // recompute agent buffer if resetSim button pressed\n      if (resetSim) {\n        compBuffManager.testScene = simulationParams.testScene;\n        //compBuffManager.numValidAgents = simulationParams.numAgents;\n        compBuffManager.gridWidth = simulationParams.gridWidth;\n\n        // NOTE: Can't have 0 binding size so we just set to 1 dummy if no obstacles\n        compBuffManager.numObstacles = Math.max(simulationParams.numObstacles, 1);\n\n        // reinitilize buffers based on the new number of agents\n        compBuffManager.initBuffers();\n\n        computeBindGroup1 = compBuffManager.getBindGroup(false);  // READ agents1 WRITE agents2\n        computeBindGroup2 = compBuffManager.getBindGroup(true);   // READ agents2 WRITE agents1\n        \n        // the number of steps in the sort pipeline is proportional\n        // to log2 the number of agents, so reinitiliaze it\n        fillSortPipelineList(device, \n                            compBuffManager.numAgents, \n                            computePipelinesSort, \n                            compBuffManager);\n        resetSim = false;\n      }\n\n      var computeCommand = device.createCommandEncoder();\n      var computeBindGroup = computeBindGroup1;\n\n      if (simulationParams.simulate) {\n      // write the parameters to the Uniform buffer for our compute shaders\n      compBuffManager.writeSimParams(simulationParams);\n\n      // execute each compute shader in the order they were pushed onto\n      // the computePipelines array\n      var passEncoder = computeCommand.beginComputePass();\n      //// ----- Compute Pass Before Sort -----\n      for (let i = 0; i < computePipelinesPreSort.length; i++){\n        passEncoder.setPipeline(computePipelinesPreSort[i]);\n        passEncoder.setBindGroup(0, computeBindGroup);\n        // kick off the compute shader\n        passEncoder.dispatch(Math.ceil(compBuffManager.numAgents / 64));\n      }\n\n      // ----- Compute Pass Sort -----\n      for (let i = 0; i < computePipelinesSort.length; i++){\n        passEncoder.setPipeline(computePipelinesSort[i]);\n        passEncoder.setBindGroup(0, computeBindGroup);\n        // kick off the compute shader\n        passEncoder.dispatch(Math.ceil(compBuffManager.numAgents / 256));\n      }\n      \n      // ----- Compute Pass Post Sort 1 -----\n      const constraintShaderIdx = 2;\n      for (let i = 0; i < constraintShaderIdx; i++){\n        passEncoder.setPipeline(computePipelinesPostSort[i]);\n        passEncoder.setBindGroup(0, computeBindGroup);\n        // kick off the compute shader\n        passEncoder.dispatch(Math.ceil(compBuffManager.numAgents / 64));\n      }\n      passEncoder.endPass();\n\n      device.queue.submit([computeCommand.finish()]);\n    \n      \n      // Stability/Contact solve will write to different buffer\n      computeBindGroup = computeBindGroup2;\n\n      // ----- Compute Pass Constraint Solve -----\n      // Since WebGPU does not support push constants, need to add write buffer to queue\n      // SEE: https://github.com/gpuweb/gpuweb/issues/762#issuecomment-625622428\n      for (let i = 0; i < 6; i++) {\n        computeCommand = device.createCommandEncoder();\n        compBuffManager.setIteration(i+1);  // Set iteration number for compute shader\n        passEncoder = computeCommand.beginComputePass();\n        passEncoder.setPipeline(computePipelinesPostSort[constraintShaderIdx]);\n        passEncoder.setBindGroup(0, computeBindGroup);\n        passEncoder.dispatch(Math.ceil(compBuffManager.numAgents / 64));\n        passEncoder.endPass();\n        device.queue.submit([computeCommand.finish()]);\n\n        // ping-pong buffers\n        if(computeBindGroup == computeBindGroup1)\n          computeBindGroup = computeBindGroup2;\n        else if(computeBindGroup == computeBindGroup2)\n          computeBindGroup = computeBindGroup1;\n      }      \n\n      // ----- Compute Pass Post Sort 2 -----\n      computeCommand = device.createCommandEncoder();\n      passEncoder = computeCommand.beginComputePass();\n      for (let i = constraintShaderIdx+1; i < computePipelinesPostSort.length; i++){\n        passEncoder.setPipeline(computePipelinesPostSort[i]);\n        passEncoder.setBindGroup(0, computeBindGroup);\n        // kick off the compute shader\n        passEncoder.dispatch(Math.ceil(compBuffManager.numAgents / 64));\n      }\n      passEncoder.endPass();\n\n      device.queue.submit([computeCommand.finish()])\n    }\n    }\n\n    // ------------------ Render Calls ------------------------- //\n    if (bufManagerExists) {\n      const renderCommand = device.createCommandEncoder();\n      const transformationMatrix = getTransformationMatrix();\n\n      renderBuffManager.renderPassDescriptor.colorAttachments[0].view = context\n        .getCurrentTexture()\n        .createView();\n      \n      const passEncoder = renderCommand.beginRenderPass(renderBuffManager.renderPassDescriptor);\n\n      // ----------------------- Draw ------------------------- //\n      renderBuffManager.drawPlatform(device, transformationMatrix, passEncoder, guiParams.gridOn);\n\n      const vp = getViewProjection();\n      const camPos = vec3.fromValues(camera.controls.eye[0], camera.controls.eye[1], camera.controls.eye[2]) ;\n      const agentsBuffer : GPUBuffer = computeBindGroup == computeBindGroup2 ? compBuffManager.agents1Buffer : compBuffManager.agents2Buffer;\n      renderBuffManager.drawCrowd(device, vp, passEncoder, agentsBuffer, compBuffManager.numAgents, camPos);\n\n      if (simulationParams.numObstacles > 0)\n        renderBuffManager.drawObstacles(device, vp, passEncoder, compBuffManager.obstaclesBuffer, compBuffManager.numObstacles);\n\n      if (compBuffManager.numGoals > 0 && simulationParams.showGoals){\n        renderBuffManager.drawGoals(device, vp, passEncoder, compBuffManager.goalsBuffer, compBuffManager.numGoals, time);\n      }\n\n      passEncoder.endPass();\n      device.queue.submit([renderCommand.finish()]);\n    }\n\n    requestAnimationFrame(frame);\n    stats.end();\n  }\n  requestAnimationFrame(frame);\n};\n\nconst Crowd: () => JSX.Element = () =>\n  makeSample({\n    name: 'Crowd Simulation',\n    description:\n      'This is a WebGPU Crowd Simulation.',\n    init,\n    gui: true,\n    stats: true,\n    sources: [\n      {\n        name: __filename.substr(__dirname.length + 1),\n        contents: __SOURCE__,\n      },\n      {\n        name: '../../shaders/background.render.wgsl',\n        contents: renderWGSL,\n        editable: true,\n      },\n      {\n        name: '../../shaders/crowd.render.wgsl',\n        contents: crowdWGSL,\n        editable: true,\n      },\n      {\n        name: '../../meshes/platform.ts',\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\n        contents: require('!!raw-loader!../../meshes/platform.ts').default,\n      },\n      {\n        name: '../../meshes/cube.ts',\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\n        contents: require('!!raw-loader!../../meshes/cube.ts').default,\n      },\n      {\n        name: '../../meshes/mesh.ts',\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\n        contents: require('!!raw-loader!../../meshes/mesh.ts').default,\n      },\n    ],\n    filename: __filename,\n  });\n\nexport default Crowd;\n"},{name:"../../shaders/background.render.wgsl",contents:m.a,editable:!0},{name:"../../shaders/crowd.render.wgsl",contents:g.a,editable:!0},{name:"../../meshes/platform.ts",contents:n("ZWaE").default},{name:"../../meshes/cube.ts",contents:n("MYnn").default},{name:"../../meshes/mesh.ts",contents:n("AtRM").default}],filename:e})}}).call(this,"src/sample/crowd/main.ts","src/sample/crowd")},yLpj:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},zHcz:function(e,t,n){"use strict";function r(e,t,n,r,i){for(var a=i+1;r<=i;){var o=r+i>>>1,s=e[o];(void 0!==n?n(s,t):s-t)>=0?(a=o,i=o-1):r=o+1}return a}function i(e,t,n,r,i){for(var a=i+1;r<=i;){var o=r+i>>>1,s=e[o];(void 0!==n?n(s,t):s-t)>0?(a=o,i=o-1):r=o+1}return a}function a(e,t,n,r,i){for(var a=r-1;r<=i;){var o=r+i>>>1,s=e[o];(void 0!==n?n(s,t):s-t)<0?(a=o,r=o+1):i=o-1}return a}function o(e,t,n,r,i){for(var a=r-1;r<=i;){var o=r+i>>>1,s=e[o];(void 0!==n?n(s,t):s-t)<=0?(a=o,r=o+1):i=o-1}return a}function s(e,t,n,r,i){for(;r<=i;){var a=r+i>>>1,o=e[a],s=void 0!==n?n(o,t):o-t;if(0===s)return a;s<=0?r=a+1:i=a-1}return-1}function u(e,t,n,r,i,a){return"function"===typeof n?a(e,t,n,void 0===r?0:0|r,void 0===i?e.length-1:0|i):a(e,t,void 0,void 0===n?0:0|n,void 0===r?e.length-1:0|r)}e.exports={ge:function(e,t,n,i,a){return u(e,t,n,i,a,r)},gt:function(e,t,n,r,a){return u(e,t,n,r,a,i)},lt:function(e,t,n,r,i){return u(e,t,n,r,i,a)},le:function(e,t,n,r,i){return u(e,t,n,r,i,o)},eq:function(e,t,n,r,i){return u(e,t,n,r,i,s)}}},zfDy:function(e,t,n){"use strict";t.a="////////////////////////////////////////////////////////////////////////////////\n// Stability Solve & Short Range Collision \n////////////////////////////////////////////////////////////////////////////////\n\n[[binding(0), group(0)]] var<uniform> sim_params : SimulationParams;\n[[binding(1), group(0)]] var<storage, read> agentData_r : Agents;\n[[binding(2), group(0)]] var<storage, write> agentData_w : Agents;\n[[binding(3), group(0)]] var<storage, read> grid : Grid;\n[[binding(4), group(0)]] var<storage, read> obstacleData : Obstacles;\n\n[[stage(compute), workgroup_size(64)]]\nfn main([[builtin(global_invocation_id)]] GlobalInvocationID : vec3<u32>) {\n  let idx = GlobalInvocationID.x;\n\n  var agent = agentData_r.agents[idx];\n  var totalDx = vec3<f32>(0.0, 0.0, 0.0);\n  var neighborCount = 0;\n\n  if (agent.cell < 0){\n    // ignore invalid cells\n    agent.c = vec4<f32>(1.0, 0.0, 0.0, 1.0);\n    agentData_w.agents[idx] = agent;\n    return;\n  }\n\n  let gridWidth = i32(sim_params.gridWidth);\n  let gridHeight = i32(sim_params.gridWidth);\n  // compute neighbors\n  \n  //// TODO don't hardcode 9 cells \n  let cellsToCheck = 9u;\n  var nearCellNums = array<i32, 9u>(\n    agent.cell + gridWidth - 1, agent.cell + gridWidth, agent.cell + gridWidth + 1,\n    agent.cell - 1, agent.cell, agent.cell+1, \n    agent.cell - gridWidth - 1, agent.cell - gridWidth, agent.cell - gridWidth + 1);\n\n  for (var c : u32 = 0u; c < cellsToCheck; c = c + 1u ){\n    let cellIdx = nearCellNums[c];\n    if (cellIdx < 0 || cellIdx >= gridWidth * gridHeight){\n      continue;\n    }\n    let cell : CellIndices = grid.cells[cellIdx];\n    for (var i : u32 = cell.start; i <= cell.end; i = i + 1u) {\n\n      if (idx == i) { \n        // ignore ourselves\n        continue; \n      }\n\n      let agent_j = agentData_r.agents[i];\n\n      var n = agent.xp - agent_j.xp;\n      let d = length(n);\n      if (d >= nearRadius){\n        continue;\n      }\n\n      let f = d - (agent.r + agent_j.r);\n      if (f < 0.0) {\n        // 4.2 Short Range Collision\n        n = normalize(n);\n        let w = agent.w / (agent.w + agent_j.w);\n        var dx = -w * k_shortrange * f * n;\n        totalDx = totalDx + dx;\n        neighborCount = neighborCount + 1;\n\n        if (friction) {\n          // 4.2 Friction Contact (See 6.1 of https://mmacklin.com/uppfrta_preprint.pdf)\n          // Add friction to slow down agents if collision is detected\n          \n          // Get corrected positions\n          var xi = agent.xp + dx;\n          var xj = agent_j.xp - dx;  // assumes mass are the same\n\n          var d_rel = (xi - agent.x) - (xj - agent_j.x);\n          dx = d_rel - dot(d_rel, n) * n;  // project to tangential component\n          var dx_norm = length(dx); \n          if(dx_norm >= mu_static * d) {\n            dx = min(mu_kinematic * d/dx_norm, 1.0) * dx;\n          }\n          dx = w * dx;\n\n          totalDx = totalDx + dx;\n          neighborCount = neighborCount + 1;\n        }\n      }\n    }\n\n    if (neighborCount > 0) {\n      totalDx = avgCoefficient * totalDx / f32(neighborCount); \n      \n      // Update position with correction\n      agent.x = agent.x + totalDx;\n      agent.xp = agent.xp + totalDx;\n    }\n  }\n\n\n  // 4.7 Obstacles Collision\n  totalDx = vec3<f32>(0.0);\n  neighborCount = 0;\n\n  for (var j : u32 = 0u; j < arrayLength(&obstacleData.obstacles); j = j + 1u){\n    obstacle_constraint(agent, obstacleData.obstacles[j], &neighborCount, &totalDx);\n  }\n\n  if (neighborCount > 0) {\n    totalDx = avgCoefficient * totalDx / f32(neighborCount); \n    agent.x = agent.x + totalDx;\n    agent.xp = agent.xp + totalDx;\n  }\n\n  // Store the new agent value\n  agentData_w.agents[idx] = agent;\n}\n"}}]);